<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="GreyCTF 2024" />
<meta property="og:locale" content="en" />
<meta name="description" content="No Sql Injection 1 2 3 4 5 6 I asked My friend Jason to build me a new e-commerce website. We just finished the login system and there&#39;s already bugs 🤦 Author: jro http://challs.nusgreyhats.org:33336 Phân tích qua thì bài này có các chức năng chính sau /api/register/1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 app.post(&#39;/api/register/1&#39;, async (req, res) =&gt; { try { let { username } = req.body; username = decode(username); const token = btoa(JSON.stringify({ name: username, admin: false })); console.log(token); await query(&quot;insert into tokens values (?)&quot;, [token]); res.json({ &quot;err&quot;: false, &quot;token&quot;: token }); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) /api/register/2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 app.post(&#39;/api/register/2&#39;, async (req, res) =&gt; { try { let { password, token } = req.body; password = decode(password); token = decode(token); const result = await query(&quot;select 1 from tokens where token = ?&quot;, [token]); console.log(result); if (result.length != 1) { return res.json({ err: &quot;Token not found!&quot; }); } await query(&quot;delete from tokens where token = ?&quot;, [token]); const { name, admin } = JSON.parse(atob(token)); console.log(JSON.parse(atob(token))) await query(&quot;insert into users (name, password, admin) values (?, ?, ?)&quot;, [name.toString(), password, admin === true]); res.json({ &quot;err&quot;: false }); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) /api/login 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 app.post(&#39;/api/login&#39;, async (req, res) =&gt; { try { let { password, username } = req.body; password = decode(password); username = decode(username); const result = await query(&quot;select admin from users where name = ? and password = ?&quot;, [username, password]); if (result.length != 1) { return res.json({ err: &quot;Username or password did not match&quot; }); } if(result[0].admin) { res.json({ &quot;err&quot;: false, &quot;msg&quot;: config.flag}); } else { res.json({ &quot;err&quot;: false, &quot;msg&quot;: &quot;You&#39;ve logged in successfully, but there&#39;s no flag here!&quot;}); } // Prevent too many records from filling up the database await query(&quot;delete from users where name = ? and password = ?&quot;, [username, password]); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) Giải thích các api endpoint /register/1 sẽ nhận username khi chúng ta post data, sau đóbằng cách thêm vào một key:value - admin:false vào và chuyển sang dạng json và base64 encode nó Sau đó backend sẽ thêm token này vào bảng tokens và gửi trả ta token như trên /register/2 sẽ nhận password và token (cả 2 đều đã bị base64) khi chúng ta post data, sau đó decode cả 2 và kiểm tra xem token đã có trong db chưa, nếu có thì parse nó thành json và lấy dữ liệu của các trường name, password, admin Sau đó backend sẽ xoá token này khỏi database và thêm các trường trên vào bảng users /login thì đơn giản chỉ là check xem account có phải là admin không có thì in ra flag, không thì không in gì cả Vậy trong này có cái gì tận dụng được để khai thác ? Thông thường so sánh của mysql là case-insensitive tức là ‘a’ == ‘A’ vậy bằng 1 cách nào đấy chúng ta có thể điều khiển cái token của chúng ta và khi parse nó thì nó sẽ ra data một cách khác thường Từ đó token thông thường là 1 {&quot;name&quot;:&quot;yuu&quot;,&quot;admin&quot;:false} Sau khi bị chúng ta chỉnh sửa và nó bị biến đổi thành 1 {&quot;name&quot;:&quot;yuu&quot;,&quot;admin&quot;:true} Vì chúng ta chỉ có thể kiểm soát được giá trị của username nên chúng ta phải làm sao đó để phá dấu &quot; để ảnh hưởng đến các đặc tính của JSON ở đây đó chính là chỉnh sửa in hoa, in thường của các ký tự đại diện cho dâu &quot; Sau khi phá được dấu &quot; và viết được admin = true thì chúng ta vẫn còn 1 việc nữa phần admin = false ở phía sau vẫn còn và sẽ ghi đè giá trị admin ở trước, lúc này chúng ta có thể tiếp tục phá giá trị của admin = false ở sau bằng cách chỉnh lại ký tự in hoa -&gt; thường của ký tự đại diện cho giá trị admin Và có 1 điều cần lưu ý là JSON.stringify khi parse các JSON object nếu các ký tự đó không thể decode qua UTF-8 hay UTF-16 thì nó sẽ trả về unicode code và escape nó ví dụ (JSON.stringify(&#39;\uDF06&#39;) -&gt; &#39;&quot;\\udf06&quot;&#39; ) Vậy chúng ta vừa corrupt cái base64 token và kiểm tra xem các ký tự đó có thể decode qua UTF-8 hay UTF-16 không Dưới đây là một cách mình tìm được 1 2 safe : b&#39;{&quot;name&quot;:&quot;yuu (\xac\x8aadmin\x8a:true-\xc2c\x8a3\xa2to&quot;,&quot;admin&quot;:false}&#39;, malicious: b&#39;{&quot;name&quot;:&quot;yuu &quot;,&quot;admin&quot;:true,&quot;c&quot;:&quot;to&quot;,&quot;admOn&quot;:false}&#39; 2 base64 của payload trên 1 2 safe: eyJuYW1lIjoieXV1ICisimFkbWluijp0cnVlLcJjijOidG8iLCJhZG1PbiI6ZmFsc2V9, malicious: eyJuYW1lIjoieXV1ICIsImFkbWluIjp0cnVlLCJjIjoidG8iLCJhZG1PbiI6ZmFsc2V9 Login bằng username ở trên (trong trường hợp payload của mình là yuu ) và password ta có flag" />
<meta property="og:description" content="No Sql Injection 1 2 3 4 5 6 I asked My friend Jason to build me a new e-commerce website. We just finished the login system and there&#39;s already bugs 🤦 Author: jro http://challs.nusgreyhats.org:33336 Phân tích qua thì bài này có các chức năng chính sau /api/register/1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 app.post(&#39;/api/register/1&#39;, async (req, res) =&gt; { try { let { username } = req.body; username = decode(username); const token = btoa(JSON.stringify({ name: username, admin: false })); console.log(token); await query(&quot;insert into tokens values (?)&quot;, [token]); res.json({ &quot;err&quot;: false, &quot;token&quot;: token }); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) /api/register/2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 app.post(&#39;/api/register/2&#39;, async (req, res) =&gt; { try { let { password, token } = req.body; password = decode(password); token = decode(token); const result = await query(&quot;select 1 from tokens where token = ?&quot;, [token]); console.log(result); if (result.length != 1) { return res.json({ err: &quot;Token not found!&quot; }); } await query(&quot;delete from tokens where token = ?&quot;, [token]); const { name, admin } = JSON.parse(atob(token)); console.log(JSON.parse(atob(token))) await query(&quot;insert into users (name, password, admin) values (?, ?, ?)&quot;, [name.toString(), password, admin === true]); res.json({ &quot;err&quot;: false }); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) /api/login 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 app.post(&#39;/api/login&#39;, async (req, res) =&gt; { try { let { password, username } = req.body; password = decode(password); username = decode(username); const result = await query(&quot;select admin from users where name = ? and password = ?&quot;, [username, password]); if (result.length != 1) { return res.json({ err: &quot;Username or password did not match&quot; }); } if(result[0].admin) { res.json({ &quot;err&quot;: false, &quot;msg&quot;: config.flag}); } else { res.json({ &quot;err&quot;: false, &quot;msg&quot;: &quot;You&#39;ve logged in successfully, but there&#39;s no flag here!&quot;}); } // Prevent too many records from filling up the database await query(&quot;delete from users where name = ? and password = ?&quot;, [username, password]); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) Giải thích các api endpoint /register/1 sẽ nhận username khi chúng ta post data, sau đóbằng cách thêm vào một key:value - admin:false vào và chuyển sang dạng json và base64 encode nó Sau đó backend sẽ thêm token này vào bảng tokens và gửi trả ta token như trên /register/2 sẽ nhận password và token (cả 2 đều đã bị base64) khi chúng ta post data, sau đó decode cả 2 và kiểm tra xem token đã có trong db chưa, nếu có thì parse nó thành json và lấy dữ liệu của các trường name, password, admin Sau đó backend sẽ xoá token này khỏi database và thêm các trường trên vào bảng users /login thì đơn giản chỉ là check xem account có phải là admin không có thì in ra flag, không thì không in gì cả Vậy trong này có cái gì tận dụng được để khai thác ? Thông thường so sánh của mysql là case-insensitive tức là ‘a’ == ‘A’ vậy bằng 1 cách nào đấy chúng ta có thể điều khiển cái token của chúng ta và khi parse nó thì nó sẽ ra data một cách khác thường Từ đó token thông thường là 1 {&quot;name&quot;:&quot;yuu&quot;,&quot;admin&quot;:false} Sau khi bị chúng ta chỉnh sửa và nó bị biến đổi thành 1 {&quot;name&quot;:&quot;yuu&quot;,&quot;admin&quot;:true} Vì chúng ta chỉ có thể kiểm soát được giá trị của username nên chúng ta phải làm sao đó để phá dấu &quot; để ảnh hưởng đến các đặc tính của JSON ở đây đó chính là chỉnh sửa in hoa, in thường của các ký tự đại diện cho dâu &quot; Sau khi phá được dấu &quot; và viết được admin = true thì chúng ta vẫn còn 1 việc nữa phần admin = false ở phía sau vẫn còn và sẽ ghi đè giá trị admin ở trước, lúc này chúng ta có thể tiếp tục phá giá trị của admin = false ở sau bằng cách chỉnh lại ký tự in hoa -&gt; thường của ký tự đại diện cho giá trị admin Và có 1 điều cần lưu ý là JSON.stringify khi parse các JSON object nếu các ký tự đó không thể decode qua UTF-8 hay UTF-16 thì nó sẽ trả về unicode code và escape nó ví dụ (JSON.stringify(&#39;\uDF06&#39;) -&gt; &#39;&quot;\\udf06&quot;&#39; ) Vậy chúng ta vừa corrupt cái base64 token và kiểm tra xem các ký tự đó có thể decode qua UTF-8 hay UTF-16 không Dưới đây là một cách mình tìm được 1 2 safe : b&#39;{&quot;name&quot;:&quot;yuu (\xac\x8aadmin\x8a:true-\xc2c\x8a3\xa2to&quot;,&quot;admin&quot;:false}&#39;, malicious: b&#39;{&quot;name&quot;:&quot;yuu &quot;,&quot;admin&quot;:true,&quot;c&quot;:&quot;to&quot;,&quot;admOn&quot;:false}&#39; 2 base64 của payload trên 1 2 safe: eyJuYW1lIjoieXV1ICisimFkbWluijp0cnVlLcJjijOidG8iLCJhZG1PbiI6ZmFsc2V9, malicious: eyJuYW1lIjoieXV1ICIsImFkbWluIjp0cnVlLCJjIjoidG8iLCJhZG1PbiI6ZmFsc2V9 Login bằng username ở trên (trong trường hợp payload của mình là yuu ) và password ta có flag" />
<link rel="canonical" href="http://localhost:4000/posts/GreyCTF/" />
<meta property="og:url" content="http://localhost:4000/posts/GreyCTF/" />
<meta property="og:site_name" content="Yuu’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-21T23:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="GreyCTF 2024" />
<meta name="twitter:site" content="@anzuukino" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-21T23:00:00+07:00","datePublished":"2024-04-21T23:00:00+07:00","description":"No Sql Injection 1 2 3 4 5 6 I asked My friend Jason to build me a new e-commerce website. We just finished the login system and there&#39;s already bugs 🤦 Author: jro http://challs.nusgreyhats.org:33336 Phân tích qua thì bài này có các chức năng chính sau /api/register/1 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 app.post(&#39;/api/register/1&#39;, async (req, res) =&gt; { try { let { username } = req.body; username = decode(username); const token = btoa(JSON.stringify({ name: username, admin: false })); console.log(token); await query(&quot;insert into tokens values (?)&quot;, [token]); res.json({ &quot;err&quot;: false, &quot;token&quot;: token }); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) /api/register/2 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 app.post(&#39;/api/register/2&#39;, async (req, res) =&gt; { try { let { password, token } = req.body; password = decode(password); token = decode(token); const result = await query(&quot;select 1 from tokens where token = ?&quot;, [token]); console.log(result); if (result.length != 1) { return res.json({ err: &quot;Token not found!&quot; }); } await query(&quot;delete from tokens where token = ?&quot;, [token]); const { name, admin } = JSON.parse(atob(token)); console.log(JSON.parse(atob(token))) await query(&quot;insert into users (name, password, admin) values (?, ?, ?)&quot;, [name.toString(), password, admin === true]); res.json({ &quot;err&quot;: false }); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) /api/login 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 app.post(&#39;/api/login&#39;, async (req, res) =&gt; { try { let { password, username } = req.body; password = decode(password); username = decode(username); const result = await query(&quot;select admin from users where name = ? and password = ?&quot;, [username, password]); if (result.length != 1) { return res.json({ err: &quot;Username or password did not match&quot; }); } if(result[0].admin) { res.json({ &quot;err&quot;: false, &quot;msg&quot;: config.flag}); } else { res.json({ &quot;err&quot;: false, &quot;msg&quot;: &quot;You&#39;ve logged in successfully, but there&#39;s no flag here!&quot;}); } // Prevent too many records from filling up the database await query(&quot;delete from users where name = ? and password = ?&quot;, [username, password]); } catch (err) { console.log(err); res.json({ &quot;err&quot;: true }); } }) Giải thích các api endpoint /register/1 sẽ nhận username khi chúng ta post data, sau đóbằng cách thêm vào một key:value - admin:false vào và chuyển sang dạng json và base64 encode nó Sau đó backend sẽ thêm token này vào bảng tokens và gửi trả ta token như trên /register/2 sẽ nhận password và token (cả 2 đều đã bị base64) khi chúng ta post data, sau đó decode cả 2 và kiểm tra xem token đã có trong db chưa, nếu có thì parse nó thành json và lấy dữ liệu của các trường name, password, admin Sau đó backend sẽ xoá token này khỏi database và thêm các trường trên vào bảng users /login thì đơn giản chỉ là check xem account có phải là admin không có thì in ra flag, không thì không in gì cả Vậy trong này có cái gì tận dụng được để khai thác ? Thông thường so sánh của mysql là case-insensitive tức là ‘a’ == ‘A’ vậy bằng 1 cách nào đấy chúng ta có thể điều khiển cái token của chúng ta và khi parse nó thì nó sẽ ra data một cách khác thường Từ đó token thông thường là 1 {&quot;name&quot;:&quot;yuu&quot;,&quot;admin&quot;:false} Sau khi bị chúng ta chỉnh sửa và nó bị biến đổi thành 1 {&quot;name&quot;:&quot;yuu&quot;,&quot;admin&quot;:true} Vì chúng ta chỉ có thể kiểm soát được giá trị của username nên chúng ta phải làm sao đó để phá dấu &quot; để ảnh hưởng đến các đặc tính của JSON ở đây đó chính là chỉnh sửa in hoa, in thường của các ký tự đại diện cho dâu &quot; Sau khi phá được dấu &quot; và viết được admin = true thì chúng ta vẫn còn 1 việc nữa phần admin = false ở phía sau vẫn còn và sẽ ghi đè giá trị admin ở trước, lúc này chúng ta có thể tiếp tục phá giá trị của admin = false ở sau bằng cách chỉnh lại ký tự in hoa -&gt; thường của ký tự đại diện cho giá trị admin Và có 1 điều cần lưu ý là JSON.stringify khi parse các JSON object nếu các ký tự đó không thể decode qua UTF-8 hay UTF-16 thì nó sẽ trả về unicode code và escape nó ví dụ (JSON.stringify(&#39;\\uDF06&#39;) -&gt; &#39;&quot;\\\\udf06&quot;&#39; ) Vậy chúng ta vừa corrupt cái base64 token và kiểm tra xem các ký tự đó có thể decode qua UTF-8 hay UTF-16 không Dưới đây là một cách mình tìm được 1 2 safe : b&#39;{&quot;name&quot;:&quot;yuu (\\xac\\x8aadmin\\x8a:true-\\xc2c\\x8a3\\xa2to&quot;,&quot;admin&quot;:false}&#39;, malicious: b&#39;{&quot;name&quot;:&quot;yuu &quot;,&quot;admin&quot;:true,&quot;c&quot;:&quot;to&quot;,&quot;admOn&quot;:false}&#39; 2 base64 của payload trên 1 2 safe: eyJuYW1lIjoieXV1ICisimFkbWluijp0cnVlLcJjijOidG8iLCJhZG1PbiI6ZmFsc2V9, malicious: eyJuYW1lIjoieXV1ICIsImFkbWluIjp0cnVlLCJjIjoidG8iLCJhZG1PbiI6ZmFsc2V9 Login bằng username ở trên (trong trường hợp payload của mình là yuu ) và password ta có flag","headline":"GreyCTF 2024","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/GreyCTF/"},"url":"http://localhost:4000/posts/GreyCTF/"}</script>
<!-- End Jekyll SEO tag -->


  <title>GreyCTF 2024 | Yuu's blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Yuu's blog">
<meta name="application-name" content="Yuu's blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    
      <link rel="preconnect" href="https://cdnjs.cloudflare.com" >
      <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>

  <!-- <style>
    body {
      background-image: url('/assets/background/background.jpg');
    }
    </style> -->

  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://pbs.twimg.com/profile_images/1771461862468579328/HqACG5Vs_400x400.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">Yuu's blog</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">I will write some CTF writeup here :v</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/anzuukino"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/anzuukino"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->

    
    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>GreyCTF 2024</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>GreyCTF 2024</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1713715200"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Apr 21, 2024
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/anzuukino">Yuu</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="842 words"
>
  <em>4 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <h2 id="no-sql-injection"><span class="me-2">No Sql Injection</span><a href="#no-sql-injection" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>I asked My friend Jason to build me a new e-commerce website. We just finished the login system and there's already bugs 🤦

Author: jro

http://challs.nusgreyhats.org:33336

</pre></td></tr></tbody></table></code></div></div>

<p>Phân tích qua thì bài này có các chức năng chính sau</p>

<ul>
  <li>/api/register/1</li>
</ul>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/register/1</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">username</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

        <span class="nx">username</span> <span class="o">=</span> <span class="nf">decode</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nf">btoa</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">({</span>
            <span class="na">name</span><span class="p">:</span> <span class="nx">username</span><span class="p">,</span>
            <span class="na">admin</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">}));</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>

        <span class="k">await</span> <span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">insert into tokens values (?)</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">token</span><span class="p">]);</span>

        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="dl">"</span><span class="s2">token</span><span class="dl">"</span><span class="p">:</span> <span class="nx">token</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>/api/register/2</li>
</ul>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/register/2</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">token</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="nx">password</span> <span class="o">=</span> <span class="nf">decode</span><span class="p">(</span><span class="nx">password</span><span class="p">);</span>
        <span class="nx">token</span> <span class="o">=</span> <span class="nf">decode</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">select 1 from tokens where token = ?</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">token</span><span class="p">]);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Token not found!</span><span class="dl">"</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">await</span> <span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">delete from tokens where token = ?</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">token</span><span class="p">]);</span>

        <span class="kd">const</span> <span class="p">{</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">admin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nf">atob</span><span class="p">(</span><span class="nx">token</span><span class="p">));</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nf">atob</span><span class="p">(</span><span class="nx">token</span><span class="p">)))</span>

        <span class="k">await</span> <span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">insert into users (name, password, admin) values (?, ?, ?)</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">name</span><span class="p">.</span><span class="nf">toString</span><span class="p">(),</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">admin</span> <span class="o">===</span> <span class="kc">true</span><span class="p">]);</span>

        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span> <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>
<ul>
  <li>/api/login</li>
</ul>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/login</span><span class="dl">'</span><span class="p">,</span> <span class="k">async </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="p">{</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">username</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
        <span class="nx">password</span> <span class="o">=</span> <span class="nf">decode</span><span class="p">(</span><span class="nx">password</span><span class="p">);</span>
        <span class="nx">username</span> <span class="o">=</span> <span class="nf">decode</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">select admin from users where name = ? and password = ?</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">]);</span>

        <span class="k">if </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Username or password did not match</span><span class="dl">"</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">admin</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msg</span><span class="dl">"</span><span class="p">:</span> <span class="nx">config</span><span class="p">.</span><span class="nx">flag</span><span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msg</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">You've logged in successfully, but there's no flag here!</span><span class="dl">"</span><span class="p">});</span>
        <span class="p">}</span>

        <span class="c1">// Prevent too many records from filling up the database</span>
        <span class="k">await</span> <span class="nf">query</span><span class="p">(</span><span class="dl">"</span><span class="s2">delete from users where name = ? and password = ?</span><span class="dl">"</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">,</span> <span class="nx">password</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="dl">"</span><span class="s2">err</span><span class="dl">"</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">})</span>

</pre></td></tr></tbody></table></code></div></div>

<p>Giải thích các api endpoint</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/register/1</code> sẽ nhận <code class="language-plaintext highlighter-rouge">username</code> khi chúng ta post data, sau đóbằng cách thêm vào một <code class="language-plaintext highlighter-rouge">key:value - admin:false</code> vào và chuyển sang dạng json và base64 encode nó</li>
</ul>

<p><a href="https://i.imgur.com/qZIVrvt.png" class="popup img-link  shimmer"><img src="https://i.imgur.com/qZIVrvt.png" alt="image" loading="lazy"></a></p>

<p>Sau đó backend sẽ thêm token này vào bảng <code class="language-plaintext highlighter-rouge">tokens</code> và gửi trả ta token như trên</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/register/2</code> sẽ nhận <code class="language-plaintext highlighter-rouge">password</code> và <code class="language-plaintext highlighter-rouge">token</code> (cả 2 đều đã bị base64) khi chúng ta post data, sau đó decode cả 2 và kiểm tra xem <code class="language-plaintext highlighter-rouge">token</code> đã có trong db chưa, nếu có thì parse nó thành json và lấy dữ liệu của các trường <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">password</code>, <code class="language-plaintext highlighter-rouge">admin</code></li>
</ul>

<p><a href="https://i.imgur.com/F1KftEI.png" class="popup img-link  shimmer"><img src="https://i.imgur.com/F1KftEI.png" alt="image" loading="lazy"></a></p>

<p>Sau đó backend sẽ xoá token này khỏi database và thêm các trường trên vào bảng <code class="language-plaintext highlighter-rouge">users</code></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">/login</code> thì đơn giản chỉ là check xem account có phải là admin không có thì in ra flag, không thì không in gì cả</li>
</ul>

<p>Vậy trong này có cái gì tận dụng được để khai thác ? Thông thường so sánh của mysql là case-insensitive tức là ‘a’ == ‘A’ vậy bằng 1 cách nào đấy chúng ta có thể điều khiển cái token của chúng ta và khi parse nó thì nó sẽ ra data một cách khác thường</p>

<p>Từ đó token thông thường là</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"yuu"</span><span class="p">,</span><span class="nl">"admin"</span><span class="p">:</span><span class="kc">false</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Sau khi bị chúng ta chỉnh sửa và nó bị biến đổi thành</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="s2">"yuu"</span><span class="p">,</span><span class="nl">"admin"</span><span class="p">:</span><span class="kc">true</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>Vì chúng ta chỉ có thể kiểm soát được giá trị của username nên chúng ta phải làm sao đó để phá dấu <code class="language-plaintext highlighter-rouge">"</code> để ảnh hưởng đến các đặc tính của JSON ở đây đó chính là chỉnh sửa in hoa, in thường của các ký tự đại diện cho dâu <code class="language-plaintext highlighter-rouge">"</code></p>

<p>Sau khi phá được dấu <code class="language-plaintext highlighter-rouge">"</code> và viết được <code class="language-plaintext highlighter-rouge">admin = true</code> thì chúng ta vẫn còn 1 việc nữa phần <code class="language-plaintext highlighter-rouge">admin = false</code> ở phía sau vẫn còn và sẽ ghi đè giá trị <code class="language-plaintext highlighter-rouge">admin</code> ở trước, lúc này chúng ta có thể tiếp tục phá giá trị của <code class="language-plaintext highlighter-rouge">admin = false</code> ở sau bằng cách chỉnh lại ký tự in hoa -&gt; thường của ký tự đại diện cho giá trị <code class="language-plaintext highlighter-rouge">admin</code></p>

<p>Và có 1 điều cần lưu ý là <code class="language-plaintext highlighter-rouge">JSON.stringify</code> khi parse các JSON object nếu các ký tự đó không thể decode qua <code class="language-plaintext highlighter-rouge">UTF-8</code> hay <code class="language-plaintext highlighter-rouge">UTF-16</code> thì nó sẽ trả về unicode code và escape nó ví dụ (<code class="language-plaintext highlighter-rouge">JSON.stringify('\uDF06')</code> -&gt; <code class="language-plaintext highlighter-rouge">'"\\udf06"'</code> )</p>

<p>Vậy chúng ta vừa corrupt cái base64 token và kiểm tra xem các ký tự đó có thể decode qua <code class="language-plaintext highlighter-rouge">UTF-8</code> hay <code class="language-plaintext highlighter-rouge">UTF-16</code> không</p>

<p>Dưới đây là một cách mình tìm được</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nx">safe</span> <span class="p">:</span> <span class="nx">b</span><span class="dl">'</span><span class="s1">{"name":"yuu (</span><span class="se">\</span><span class="s1">xac</span><span class="se">\</span><span class="s1">x8aadmin</span><span class="se">\</span><span class="s1">x8a:true-</span><span class="se">\</span><span class="s1">xc2c</span><span class="se">\</span><span class="s1">x8a3</span><span class="se">\</span><span class="s1">xa2to","admin":false}</span><span class="dl">'</span><span class="p">,</span>
<span class="nx">malicious</span><span class="p">:</span> <span class="nx">b</span><span class="dl">'</span><span class="s1">{"name":"yuu ","admin":true,"c":"to","admOn":false}</span><span class="dl">'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>2 base64 của payload trên</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nx">safe</span><span class="p">:</span> <span class="nx">eyJuYW1lIjoieXV1ICisimFkbWluijp0cnVlLcJjijOidG8iLCJhZG1PbiI6ZmFsc2V9</span><span class="p">,</span>
<span class="nx">malicious</span><span class="p">:</span> <span class="nx">eyJuYW1lIjoieXV1ICIsImFkbWluIjp0cnVlLCJjIjoidG8iLCJhZG1PbiI6ZmFsc2V9</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Login bằng <code class="language-plaintext highlighter-rouge">username</code> ở trên (trong trường hợp payload của mình là <code class="language-plaintext highlighter-rouge">yuu </code>) và password ta có flag</p>

<p><a href="https://i.imgur.com/pZyldot.png" class="popup img-link  shimmer"><img src="https://i.imgur.com/pZyldot.png" alt="image" loading="lazy"></a></p>


  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/ctf-writeup/">CTF Writeup</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/mysql/"
            class="post-tag no-text-decoration"
          >MYSQL</a>
        
          <a
            href="/tags/base64/"
            class="post-tag no-text-decoration"
          >Base64</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=GreyCTF%202024%20-%20Yuu's%20blog&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FGreyCTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=GreyCTF%202024%20-%20Yuu's%20blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FGreyCTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FGreyCTF%2F&text=GreyCTF%202024%20-%20Yuu's%20blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Wannagame-Freshman/">Wannagame Freshman CTF writeup</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/GreyCTF/">GreyCTF 2024</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/PicoCTF2024/">PicoCTF 2024</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/W1Playground/">W1 Playground Writeup</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/AsisCTF/">Asis CTF 2023 Writeup</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ssti/">SSTI</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api-testing/">API testing</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/base64/">Base64</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bypass-filter/">Bypass Filter</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mysql/">MYSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nosql/">NoSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php-webshell/">PHP Webshell</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/prototype-pollution/">Prototype Pollution</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/sql-injectiom/">SQL Injectiom</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/AsisCTF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1695571200"
  data-df="ll"
  
>
  Sep 24, 2023
</time>

              <h4 class="pt-0 my-2">Asis CTF 2023 Writeup</h4>
              <div class="text-muted">
                <p>Asis-CTF-2023-Writeup
Bài 1 hello:

  Tóm tắt đề thì đại khái là đề bảo chúng ta phải request một cái method get có parameter là x lên Web sao cho không có chữ next và chữ file là được, nhưng mà mu...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/Wannagame-Freshman/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1699718400"
  data-df="ll"
  
>
  Nov 11, 2023
</time>

              <h4 class="pt-0 my-2">Wannagame Freshman CTF writeup</h4>
              <div class="text-muted">
                <p>WannaWinFreshman-Writeup
Bài 1 Warmup PHP:



  Tóm tắt đề thì đại khái là đề bảo chúng ta phải POST data lên dưới dạng json có key là page và sau đó chương trình sẽ server sẽ decode ra và đọc file...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/PicoCTF2024/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1711555200"
  data-df="ll"
  
>
  Mar 27, 2024
</time>

              <h4 class="pt-0 my-2">PicoCTF 2024</h4>
              <div class="text-muted">
                <p>PicoCTF2024 đã kết thúc, giải này mình có khá nhiều nuối tiếc vì bài cuối web quá khó, dù không clear nhưng team Zafk1el tụi mình đã cố gắng hết sức. Tiện đây mình viết writeup một số bài đáng chú ...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/PicoCTF2024/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>PicoCTF 2024</p>
    </a>
  

  
    <a
      href="/posts/W1Playground/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>W1 Playground Writeup</p>
    </a>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2024</time>

    
      <a href="https://github.com/anzuukino">Yuu</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v6.5.5"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ssti/">SSTI</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api-testing/">API testing</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/base64/">Base64</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bypass-filter/">Bypass Filter</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mysql/">MYSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nosql/">NoSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php-webshell/">PHP Webshell</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php/">PHP</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/prototype-pollution/">Prototype Pollution</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/sql-injectiom/">SQL Injectiom</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  





    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

